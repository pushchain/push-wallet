import{d as wt,e as qr,g as ze,f as Ul,p as Rt,R as Ml,i as Ga,A as kl,L as Ya}from"./index--oNX4cA1.js";var Ja={},Dl=Object.defineProperty,jl=(t,e,s)=>e in t?Dl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_e=(t,e,s)=>(jl(t,typeof e!="symbol"?e+"":e,s),s),Qi={exports:{}},ks=typeof Reflect=="object"?Reflect:null,zn=ks&&typeof ks.apply=="function"?ks.apply:function(t,e,s){return Function.prototype.apply.call(t,e,s)},$r;ks&&typeof ks.ownKeys=="function"?$r=ks.ownKeys:Object.getOwnPropertySymbols?$r=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:$r=function(t){return Object.getOwnPropertyNames(t)};function zl(t){console&&console.warn&&console.warn(t)}var Qa=Number.isNaN||function(t){return t!==t};function Pe(){Pe.init.call(this)}Qi.exports=Pe;Qi.exports.once=Kl;Pe.EventEmitter=Pe;Pe.prototype._events=void 0;Pe.prototype._eventsCount=0;Pe.prototype._maxListeners=void 0;var qn=10;function ri(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Pe,"defaultMaxListeners",{enumerable:!0,get:function(){return qn},set:function(t){if(typeof t!="number"||t<0||Qa(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");qn=t}});Pe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Pe.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Qa(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Xa(t){return t._maxListeners===void 0?Pe.defaultMaxListeners:t._maxListeners}Pe.prototype.getMaxListeners=function(){return Xa(this)};Pe.prototype.emit=function(t){for(var e=[],s=1;s<arguments.length;s++)e.push(arguments[s]);var r=t==="error",i=this._events;if(i!==void 0)r=r&&i.error===void 0;else if(!r)return!1;if(r){var n;if(e.length>0&&(n=e[0]),n instanceof Error)throw n;var c=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw c.context=n,c}var a=i[t];if(a===void 0)return!1;if(typeof a=="function")zn(a,this,e);else for(var l=a.length,d=rc(a,l),s=0;s<l;++s)zn(d[s],this,e);return!0};function Za(t,e,s,r){var i,n,c;if(ri(s),n=t._events,n===void 0?(n=t._events=Object.create(null),t._eventsCount=0):(n.newListener!==void 0&&(t.emit("newListener",e,s.listener?s.listener:s),n=t._events),c=n[e]),c===void 0)c=n[e]=s,++t._eventsCount;else if(typeof c=="function"?c=n[e]=r?[s,c]:[c,s]:r?c.unshift(s):c.push(s),i=Xa(t),i>0&&c.length>i&&!c.warned){c.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=c.length,zl(a)}return t}Pe.prototype.addListener=function(t,e){return Za(this,t,e,!1)};Pe.prototype.on=Pe.prototype.addListener;Pe.prototype.prependListener=function(t,e){return Za(this,t,e,!0)};function ql(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ec(t,e,s){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:s},i=ql.bind(r);return i.listener=s,r.wrapFn=i,i}Pe.prototype.once=function(t,e){return ri(e),this.on(t,ec(this,t,e)),this};Pe.prototype.prependOnceListener=function(t,e){return ri(e),this.prependListener(t,ec(this,t,e)),this};Pe.prototype.removeListener=function(t,e){var s,r,i,n,c;if(ri(e),r=this._events,r===void 0)return this;if(s=r[t],s===void 0)return this;if(s===e||s.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,s.listener||e));else if(typeof s!="function"){for(i=-1,n=s.length-1;n>=0;n--)if(s[n]===e||s[n].listener===e){c=s[n].listener,i=n;break}if(i<0)return this;i===0?s.shift():$l(s,i),s.length===1&&(r[t]=s[0]),r.removeListener!==void 0&&this.emit("removeListener",t,c||e)}return this};Pe.prototype.off=Pe.prototype.removeListener;Pe.prototype.removeAllListeners=function(t){var e,s,r;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var i=Object.keys(s),n;for(r=0;r<i.length;++r)n=i[r],n!=="removeListener"&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=s[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this};function tc(t,e,s){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?s?[i.listener||i]:[i]:s?Vl(i):rc(i,i.length)}Pe.prototype.listeners=function(t){return tc(this,t,!0)};Pe.prototype.rawListeners=function(t){return tc(this,t,!1)};Pe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):sc.call(t,e)};Pe.prototype.listenerCount=sc;function sc(t){var e=this._events;if(e!==void 0){var s=e[t];if(typeof s=="function")return 1;if(s!==void 0)return s.length}return 0}Pe.prototype.eventNames=function(){return this._eventsCount>0?$r(this._events):[]};function rc(t,e){for(var s=new Array(e),r=0;r<e;++r)s[r]=t[r];return s}function $l(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Vl(t){for(var e=new Array(t.length),s=0;s<e.length;++s)e[s]=t[s].listener||t[s];return e}function Kl(t,e){return new Promise(function(s,r){function i(c){t.removeListener(e,n),r(c)}function n(){typeof t.removeListener=="function"&&t.removeListener("error",i),s([].slice.call(arguments))}ic(t,e,n,{once:!0}),e!=="error"&&Hl(t,i,{once:!0})})}function Hl(t,e,s){typeof t.on=="function"&&ic(t,"error",e,s)}function ic(t,e,s,r){if(typeof t.on=="function")r.once?t.once(e,s):t.on(e,s);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(n){r.once&&t.removeEventListener(e,i),s(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Ye=Qi.exports;const ii=Ya(Ye);var ni={},nc={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,s,r,i,n,c,a,l,d,g,m,A,N,I,x,k,F,S,O,y,v,p,o;(function(u){var D=typeof wt=="object"?wt:typeof self=="object"?self:typeof this=="object"?this:{};u(b(D,b(t.exports)));function b(T,U){return T!==D&&(typeof Object.create=="function"?Object.defineProperty(T,"__esModule",{value:!0}):T.__esModule=!0),function(z,w){return T[z]=U?U(z,w):w}}})(function(u){var D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,T){b.__proto__=T}||function(b,T){for(var U in T)T.hasOwnProperty(U)&&(b[U]=T[U])};e=function(b,T){D(b,T);function U(){this.constructor=b}b.prototype=T===null?Object.create(T):(U.prototype=T.prototype,new U)},s=Object.assign||function(b){for(var T,U=1,z=arguments.length;U<z;U++){T=arguments[U];for(var w in T)Object.prototype.hasOwnProperty.call(T,w)&&(b[w]=T[w])}return b},r=function(b,T){var U={};for(var z in b)Object.prototype.hasOwnProperty.call(b,z)&&T.indexOf(z)<0&&(U[z]=b[z]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,z=Object.getOwnPropertySymbols(b);w<z.length;w++)T.indexOf(z[w])<0&&Object.prototype.propertyIsEnumerable.call(b,z[w])&&(U[z[w]]=b[z[w]]);return U},i=function(b,T,U,z){var w=arguments.length,_=w<3?T:z===null?z=Object.getOwnPropertyDescriptor(T,U):z,V;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(b,T,U,z);else for(var $=b.length-1;$>=0;$--)(V=b[$])&&(_=(w<3?V(_):w>3?V(T,U,_):V(T,U))||_);return w>3&&_&&Object.defineProperty(T,U,_),_},n=function(b,T){return function(U,z){T(U,z,b)}},c=function(b,T){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(b,T)},a=function(b,T,U,z){function w(_){return _ instanceof U?_:new U(function(V){V(_)})}return new(U||(U=Promise))(function(_,V){function $(j){try{M(z.next(j))}catch(B){V(B)}}function q(j){try{M(z.throw(j))}catch(B){V(B)}}function M(j){j.done?_(j.value):w(j.value).then($,q)}M((z=z.apply(b,T||[])).next())})},l=function(b,T){var U={label:0,sent:function(){if(_[0]&1)throw _[1];return _[1]},trys:[],ops:[]},z,w,_,V;return V={next:$(0),throw:$(1),return:$(2)},typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function $(M){return function(j){return q([M,j])}}function q(M){if(z)throw new TypeError("Generator is already executing.");for(;U;)try{if(z=1,w&&(_=M[0]&2?w.return:M[0]?w.throw||((_=w.return)&&_.call(w),0):w.next)&&!(_=_.call(w,M[1])).done)return _;switch(w=0,_&&(M=[M[0]&2,_.value]),M[0]){case 0:case 1:_=M;break;case 4:return U.label++,{value:M[1],done:!1};case 5:U.label++,w=M[1],M=[0];continue;case 7:M=U.ops.pop(),U.trys.pop();continue;default:if(_=U.trys,!(_=_.length>0&&_[_.length-1])&&(M[0]===6||M[0]===2)){U=0;continue}if(M[0]===3&&(!_||M[1]>_[0]&&M[1]<_[3])){U.label=M[1];break}if(M[0]===6&&U.label<_[1]){U.label=_[1],_=M;break}if(_&&U.label<_[2]){U.label=_[2],U.ops.push(M);break}_[2]&&U.ops.pop(),U.trys.pop();continue}M=T.call(b,U)}catch(j){M=[6,j],w=0}finally{z=_=0}if(M[0]&5)throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}},o=function(b,T,U,z){z===void 0&&(z=U),b[z]=T[U]},d=function(b,T){for(var U in b)U!=="default"&&!T.hasOwnProperty(U)&&(T[U]=b[U])},g=function(b){var T=typeof Symbol=="function"&&Symbol.iterator,U=T&&b[T],z=0;if(U)return U.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&z>=b.length&&(b=void 0),{value:b&&b[z++],done:!b}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")},m=function(b,T){var U=typeof Symbol=="function"&&b[Symbol.iterator];if(!U)return b;var z=U.call(b),w,_=[],V;try{for(;(T===void 0||T-- >0)&&!(w=z.next()).done;)_.push(w.value)}catch($){V={error:$}}finally{try{w&&!w.done&&(U=z.return)&&U.call(z)}finally{if(V)throw V.error}}return _},A=function(){for(var b=[],T=0;T<arguments.length;T++)b=b.concat(m(arguments[T]));return b},N=function(){for(var b=0,T=0,U=arguments.length;T<U;T++)b+=arguments[T].length;for(var z=Array(b),w=0,T=0;T<U;T++)for(var _=arguments[T],V=0,$=_.length;V<$;V++,w++)z[w]=_[V];return z},I=function(b){return this instanceof I?(this.v=b,this):new I(b)},x=function(b,T,U){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var z=U.apply(b,T||[]),w,_=[];return w={},V("next"),V("throw"),V("return"),w[Symbol.asyncIterator]=function(){return this},w;function V(te){z[te]&&(w[te]=function(W){return new Promise(function(se,Q){_.push([te,W,se,Q])>1||$(te,W)})})}function $(te,W){try{q(z[te](W))}catch(se){B(_[0][3],se)}}function q(te){te.value instanceof I?Promise.resolve(te.value.v).then(M,j):B(_[0][2],te)}function M(te){$("next",te)}function j(te){$("throw",te)}function B(te,W){te(W),_.shift(),_.length&&$(_[0][0],_[0][1])}},k=function(b){var T,U;return T={},z("next"),z("throw",function(w){throw w}),z("return"),T[Symbol.iterator]=function(){return this},T;function z(w,_){T[w]=b[w]?function(V){return(U=!U)?{value:I(b[w](V)),done:w==="return"}:_?_(V):V}:_}},F=function(b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var T=b[Symbol.asyncIterator],U;return T?T.call(b):(b=typeof g=="function"?g(b):b[Symbol.iterator](),U={},z("next"),z("throw"),z("return"),U[Symbol.asyncIterator]=function(){return this},U);function z(_){U[_]=b[_]&&function(V){return new Promise(function($,q){V=b[_](V),w($,q,V.done,V.value)})}}function w(_,V,$,q){Promise.resolve(q).then(function(M){_({value:M,done:$})},V)}},S=function(b,T){return Object.defineProperty?Object.defineProperty(b,"raw",{value:T}):b.raw=T,b},O=function(b){if(b&&b.__esModule)return b;var T={};if(b!=null)for(var U in b)Object.hasOwnProperty.call(b,U)&&(T[U]=b[U]);return T.default=b,T},y=function(b){return b&&b.__esModule?b:{default:b}},v=function(b,T){if(!T.has(b))throw new TypeError("attempted to get private field on non-instance");return T.get(b)},p=function(b,T,U){if(!T.has(b))throw new TypeError("attempted to set private field on non-instance");return T.set(b,U),U},u("__extends",e),u("__assign",s),u("__rest",r),u("__decorate",i),u("__param",n),u("__metadata",c),u("__awaiter",a),u("__generator",l),u("__exportStar",d),u("__createBinding",o),u("__values",g),u("__read",m),u("__spread",A),u("__spreadArrays",N),u("__await",I),u("__asyncGenerator",x),u("__asyncDelegator",k),u("__asyncValues",F),u("__makeTemplateObject",S),u("__importStar",O),u("__importDefault",y),u("__classPrivateFieldGet",v),u("__classPrivateFieldSet",p)})})(nc);var Dt=nc.exports,gr={};Object.defineProperty(gr,"__esModule",{value:!0});function Fl(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}gr.safeJsonParse=Fl;function Bl(t){return typeof t=="string"?t:JSON.stringify(t,(e,s)=>typeof s>"u"?null:s)}gr.safeJsonStringify=Bl;var Mr={exports:{}},$n;function Wl(){return $n||($n=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(s){return this.hasOwnProperty(s)?String(this[s]):null},t.prototype.setItem=function(s,r){this[s]=String(r)},t.prototype.removeItem=function(s){delete this[s]},t.prototype.clear=function(){const s=this;Object.keys(s).forEach(function(r){s[r]=void 0,delete s[r]})},t.prototype.key=function(s){return s=s||0,Object.keys(this)[s]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof wt<"u"&&wt.localStorage?Mr.exports=wt.localStorage:typeof window<"u"&&window.localStorage?Mr.exports=window.localStorage:Mr.exports=new e}()),Mr.exports}var Vn={},Ws={},Kn;function Gl(){if(Kn)return Ws;Kn=1,Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.IKeyValueStorage=void 0;class t{}return Ws.IKeyValueStorage=t,Ws}var Gs={},Hn;function Yl(){if(Hn)return Gs;Hn=1,Object.defineProperty(Gs,"__esModule",{value:!0}),Gs.parseEntry=void 0;const t=gr;function e(s){var r;return[s[0],t.safeJsonParse((r=s[1])!==null&&r!==void 0?r:"")]}return Gs.parseEntry=e,Gs}var Fn;function Jl(){return Fn||(Fn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(Gl(),t),e.__exportStar(Yl(),t)}(Vn)),Vn}Object.defineProperty(ni,"__esModule",{value:!0});ni.KeyValueStorage=void 0;const Cs=Dt,Bn=gr,Ql=Cs.__importDefault(Wl()),Xl=Jl();class oc{constructor(){this.localStorage=Ql.default}getKeys(){return Cs.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Cs.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Xl.parseEntry)})}getItem(e){return Cs.__awaiter(this,void 0,void 0,function*(){const s=this.localStorage.getItem(e);if(s!==null)return Bn.safeJsonParse(s)})}setItem(e,s){return Cs.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,Bn.safeJsonStringify(s))})}removeItem(e){return Cs.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}ni.KeyValueStorage=oc;var ac=ni.default=oc,Jt={},Ys={},K={},Wn={},Js={},Gn;function Zl(){if(Gn)return Js;Gn=1,Object.defineProperty(Js,"__esModule",{value:!0}),Js.delay=void 0;function t(e){return new Promise(s=>{setTimeout(()=>{s(!0)},e)})}return Js.delay=t,Js}var bs={},Yn={},Ts={},Jn;function eu(){return Jn||(Jn=1,Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.ONE_THOUSAND=Ts.ONE_HUNDRED=void 0,Ts.ONE_HUNDRED=100,Ts.ONE_THOUSAND=1e3),Ts}var Qn={},Xn;function tu(){return Xn||(Xn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Qn)),Qn}var Zn;function cc(){return Zn||(Zn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(eu(),t),e.__exportStar(tu(),t)}(Yn)),Yn}var eo;function su(){if(eo)return bs;eo=1,Object.defineProperty(bs,"__esModule",{value:!0}),bs.fromMiliseconds=bs.toMiliseconds=void 0;const t=cc();function e(r){return r*t.ONE_THOUSAND}bs.toMiliseconds=e;function s(r){return Math.floor(r/t.ONE_THOUSAND)}return bs.fromMiliseconds=s,bs}var to;function ru(){return to||(to=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(Zl(),t),e.__exportStar(su(),t)}(Wn)),Wn}var As={},so;function iu(){if(so)return As;so=1,Object.defineProperty(As,"__esModule",{value:!0}),As.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(s){if(this.timestamps.has(s))throw new Error(`Watch already started for label: ${s}`);this.timestamps.set(s,{started:Date.now()})}stop(s){const r=this.get(s);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${s}`);const i=Date.now()-r.started;this.timestamps.set(s,{started:r.started,elapsed:i})}get(s){const r=this.timestamps.get(s);if(typeof r>"u")throw new Error(`No timestamp found for label: ${s}`);return r}elapsed(s){const r=this.get(s);return r.elapsed||Date.now()-r.started}}return As.Watch=t,As.default=t,As}var ro={},Qs={},io;function nu(){if(io)return Qs;io=1,Object.defineProperty(Qs,"__esModule",{value:!0}),Qs.IWatch=void 0;class t{}return Qs.IWatch=t,Qs}var no;function ou(){return no||(no=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Dt.__exportStar(nu(),t)}(ro)),ro}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(ru(),t),e.__exportStar(iu(),t),e.__exportStar(ou(),t),e.__exportStar(cc(),t)})(K);var oo={},Xs={};let Tt=class{};const au=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Tt},Symbol.toStringTag,{value:"Module"})),cu=Ga(au);var ao;function hu(){if(ao)return Xs;ao=1,Object.defineProperty(Xs,"__esModule",{value:!0}),Xs.IHeartBeat=void 0;const t=cu;class e extends t.IEvents{constructor(r){super()}}return Xs.IHeartBeat=e,Xs}var co;function hc(){return co||(co=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Dt.__exportStar(hu(),t)}(oo)),oo}var ho={},vs={},lo;function lu(){if(lo)return vs;lo=1,Object.defineProperty(vs,"__esModule",{value:!0}),vs.HEARTBEAT_EVENTS=vs.HEARTBEAT_INTERVAL=void 0;const t=K;return vs.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,vs.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},vs}var uo;function lc(){return uo||(uo=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Dt.__exportStar(lu(),t)}(ho)),ho}var po;function uu(){if(po)return Ys;po=1,Object.defineProperty(Ys,"__esModule",{value:!0}),Ys.HeartBeat=void 0;const t=Dt,e=Ye,s=K,r=hc(),i=lc();class n extends r.IHeartBeat{constructor(a){super(a),this.events=new e.EventEmitter,this.interval=i.HEARTBEAT_INTERVAL,this.interval=(a==null?void 0:a.interval)||i.HEARTBEAT_INTERVAL}static init(a){return t.__awaiter(this,void 0,void 0,function*(){const l=new n(a);return yield l.init(),l})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(a,l){this.events.on(a,l)}once(a,l){this.events.once(a,l)}off(a,l){this.events.off(a,l)}removeListener(a,l){this.events.removeListener(a,l)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),s.toMiliseconds(this.interval))})}pulse(){this.events.emit(i.HEARTBEAT_EVENTS.pulse)}}return Ys.HeartBeat=n,Ys}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(uu(),t),e.__exportStar(hc(),t),e.__exportStar(lc(),t)})(Jt);var ee={},wi,go;function pu(){if(go)return wi;go=1;function t(s){try{return JSON.stringify(s)}catch{return'"[Circular]"'}}wi=e;function e(s,r,i){var n=i&&i.stringify||t,c=1;if(typeof s=="object"&&s!==null){var a=r.length+c;if(a===1)return s;var l=new Array(a);l[0]=n(s);for(var d=1;d<a;d++)l[d]=n(r[d]);return l.join(" ")}if(typeof s!="string")return s;var g=r.length;if(g===0)return s;for(var m="",A=1-c,N=-1,I=s&&s.length||0,x=0;x<I;){if(s.charCodeAt(x)===37&&x+1<I){switch(N=N>-1?N:0,s.charCodeAt(x+1)){case 100:case 102:if(A>=g||r[A]==null)break;N<x&&(m+=s.slice(N,x)),m+=Number(r[A]),N=x+2,x++;break;case 105:if(A>=g||r[A]==null)break;N<x&&(m+=s.slice(N,x)),m+=Math.floor(Number(r[A])),N=x+2,x++;break;case 79:case 111:case 106:if(A>=g||r[A]===void 0)break;N<x&&(m+=s.slice(N,x));var k=typeof r[A];if(k==="string"){m+="'"+r[A]+"'",N=x+2,x++;break}if(k==="function"){m+=r[A].name||"<anonymous>",N=x+2,x++;break}m+=n(r[A]),N=x+2,x++;break;case 115:if(A>=g)break;N<x&&(m+=s.slice(N,x)),m+=String(r[A]),N=x+2,x++;break;case 37:N<x&&(m+=s.slice(N,x)),m+="%",N=x+2,x++,A--;break}++A}++x}return N===-1?s:(N<I&&(m+=s.slice(N)),m)}return wi}var bi,fo;function du(){if(fo)return bi;fo=1;const t=pu();bi=i;const e=v().console||{},s={mapHttpRequest:I,mapHttpResponse:I,wrapRequestSerializer:x,wrapResponseSerializer:x,wrapErrorSerializer:x,req:I,res:I,err:A};function r(p,o){return Array.isArray(p)?p.filter(function(u){return u!=="!stdSerializers.err"}):p===!0?Object.keys(o):!1}function i(p){p=p||{},p.browser=p.browser||{};const o=p.browser.transmit;if(o&&typeof o.send!="function")throw Error("pino: transmit option must have a send function");const u=p.browser.write||e;p.browser.write&&(p.browser.asObject=!0);const D=p.serializers||{},b=r(p.browser.serialize,D);let T=p.browser.serialize;Array.isArray(p.browser.serialize)&&p.browser.serialize.indexOf("!stdSerializers.err")>-1&&(T=!1);const U=["error","fatal","warn","info","debug","trace"];typeof u=="function"&&(u.error=u.fatal=u.warn=u.info=u.debug=u.trace=u),p.enabled===!1&&(p.level="silent");const z=p.level||"info",w=Object.create(u);w.log||(w.log=k),Object.defineProperty(w,"levelVal",{get:V}),Object.defineProperty(w,"level",{get:$,set:q});const _={transmit:o,serialize:b,asObject:p.browser.asObject,levels:U,timestamp:N(p)};w.levels=i.levels,w.level=z,w.setMaxListeners=w.getMaxListeners=w.emit=w.addListener=w.on=w.prependListener=w.once=w.prependOnceListener=w.removeListener=w.removeAllListeners=w.listeners=w.listenerCount=w.eventNames=w.write=w.flush=k,w.serializers=D,w._serialize=b,w._stdErrSerialize=T,w.child=M,o&&(w._logEvent=m());function V(){return this.level==="silent"?1/0:this.levels.values[this.level]}function $(){return this._level}function q(j){if(j!=="silent"&&!this.levels.values[j])throw Error("unknown level "+j);this._level=j,n(_,w,"error","log"),n(_,w,"fatal","error"),n(_,w,"warn","error"),n(_,w,"info","log"),n(_,w,"debug","log"),n(_,w,"trace","log")}function M(j,B){if(!j)throw new Error("missing bindings for child Pino");B=B||{},b&&j.serializers&&(B.serializers=j.serializers);const te=B.serializers;if(b&&te){var W=Object.assign({},D,te),se=p.browser.serialize===!0?Object.keys(W):b;delete j.serializers,l([j],se,W,this._stdErrSerialize)}function Q(re){this._childLevel=(re._childLevel|0)+1,this.error=d(re,j,"error"),this.fatal=d(re,j,"fatal"),this.warn=d(re,j,"warn"),this.info=d(re,j,"info"),this.debug=d(re,j,"debug"),this.trace=d(re,j,"trace"),W&&(this.serializers=W,this._serialize=se),o&&(this._logEvent=m([].concat(re._logEvent.bindings,j)))}return Q.prototype=this,new Q(this)}return w}i.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},i.stdSerializers=s,i.stdTimeFunctions=Object.assign({},{nullTime:F,epochTime:S,unixTime:O,isoTime:y});function n(p,o,u,D){const b=Object.getPrototypeOf(o);o[u]=o.levelVal>o.levels.values[u]?k:b[u]?b[u]:e[u]||e[D]||k,c(p,o,u)}function c(p,o,u){!p.transmit&&o[u]===k||(o[u]=function(D){return function(){const b=p.timestamp(),T=new Array(arguments.length),U=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var z=0;z<T.length;z++)T[z]=arguments[z];if(p.serialize&&!p.asObject&&l(T,this._serialize,this.serializers,this._stdErrSerialize),p.asObject?D.call(U,a(this,u,T,b)):D.apply(U,T),p.transmit){const w=p.transmit.level||o.level,_=i.levels.values[w],V=i.levels.values[u];if(V<_)return;g(this,{ts:b,methodLevel:u,methodValue:V,transmitLevel:w,transmitValue:i.levels.values[p.transmit.level||o.level],send:p.transmit.send,val:o.levelVal},T)}}}(o[u]))}function a(p,o,u,D){p._serialize&&l(u,p._serialize,p.serializers,p._stdErrSerialize);const b=u.slice();let T=b[0];const U={};D&&(U.time=D),U.level=i.levels.values[o];let z=(p._childLevel|0)+1;if(z<1&&(z=1),T!==null&&typeof T=="object"){for(;z--&&typeof b[0]=="object";)Object.assign(U,b.shift());T=b.length?t(b.shift(),b):void 0}else typeof T=="string"&&(T=t(b.shift(),b));return T!==void 0&&(U.msg=T),U}function l(p,o,u,D){for(const b in p)if(D&&p[b]instanceof Error)p[b]=i.stdSerializers.err(p[b]);else if(typeof p[b]=="object"&&!Array.isArray(p[b]))for(const T in p[b])o&&o.indexOf(T)>-1&&T in u&&(p[b][T]=u[T](p[b][T]))}function d(p,o,u){return function(){const D=new Array(1+arguments.length);D[0]=o;for(var b=1;b<D.length;b++)D[b]=arguments[b-1];return p[u].apply(this,D)}}function g(p,o,u){const D=o.send,b=o.ts,T=o.methodLevel,U=o.methodValue,z=o.val,w=p._logEvent.bindings;l(u,p._serialize||Object.keys(p.serializers),p.serializers,p._stdErrSerialize===void 0?!0:p._stdErrSerialize),p._logEvent.ts=b,p._logEvent.messages=u.filter(function(_){return w.indexOf(_)===-1}),p._logEvent.level.label=T,p._logEvent.level.value=U,D(T,p._logEvent,z),p._logEvent=m(w)}function m(p){return{ts:0,messages:[],bindings:p||[],level:{label:"",value:0}}}function A(p){const o={type:p.constructor.name,msg:p.message,stack:p.stack};for(const u in p)o[u]===void 0&&(o[u]=p[u]);return o}function N(p){return typeof p.timestamp=="function"?p.timestamp:p.timestamp===!1?F:S}function I(){return{}}function x(p){return p}function k(){}function F(){return!1}function S(){return Date.now()}function O(){return Math.round(Date.now()/1e3)}function y(){return new Date(Date.now()).toISOString()}function v(){function p(o){return typeof o<"u"&&o}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return p(self)||p(window)||p(this)||{}}}return bi}var Ls={},yo;function uc(){return yo||(yo=1,Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.PINO_CUSTOM_CONTEXT_KEY=Ls.PINO_LOGGER_DEFAULTS=void 0,Ls.PINO_LOGGER_DEFAULTS={level:"info"},Ls.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Ls}var mt={},mo;function gu(){if(mo)return mt;mo=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.generateChildLogger=mt.formatChildLoggerContext=mt.getLoggerContext=mt.setBrowserLoggerContext=mt.getBrowserLoggerContext=mt.getDefaultLoggerOptions=void 0;const t=uc();function e(a){return Object.assign(Object.assign({},a),{level:(a==null?void 0:a.level)||t.PINO_LOGGER_DEFAULTS.level})}mt.getDefaultLoggerOptions=e;function s(a,l=t.PINO_CUSTOM_CONTEXT_KEY){return a[l]||""}mt.getBrowserLoggerContext=s;function r(a,l,d=t.PINO_CUSTOM_CONTEXT_KEY){return a[d]=l,a}mt.setBrowserLoggerContext=r;function i(a,l=t.PINO_CUSTOM_CONTEXT_KEY){let d="";return typeof a.bindings>"u"?d=s(a,l):d=a.bindings().context||"",d}mt.getLoggerContext=i;function n(a,l,d=t.PINO_CUSTOM_CONTEXT_KEY){const g=i(a,d);return g.trim()?`${g}/${l}`:l}mt.formatChildLoggerContext=n;function c(a,l,d=t.PINO_CUSTOM_CONTEXT_KEY){const g=n(a,l,d),m=a.child({context:g});return r(m,g,d)}return mt.generateChildLogger=c,mt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=Dt,s=e.__importDefault(du());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return s.default}}),e.__exportStar(uc(),t),e.__exportStar(gu(),t)})(ee);let fu=class extends Tt{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}},yu=class extends Tt{constructor(t,e){super(),this.core=t,this.logger=e,this.records=new Map}},mu=class{constructor(t,e){this.logger=t,this.core=e}},wu=class extends Tt{constructor(t,e){super(),this.relayer=t,this.logger=e}},bu=class extends Tt{constructor(t){super()}},vu=class{constructor(t,e,s,r){this.core=t,this.logger=e,this.name=s}},_u=class extends Tt{constructor(t,e){super(),this.relayer=t,this.logger=e}},Eu=class extends Tt{constructor(t,e){super(),this.core=t,this.logger=e}},Su=class{constructor(t,e){this.projectId=t,this.logger=e}},Iu=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},Ou=class{constructor(t){this.client=t}};const Nu=t=>JSON.stringify(t,(e,s)=>typeof s=="bigint"?s.toString()+"n":s),Pu=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,s=t.replace(e,'$1"$2n"$3');return JSON.parse(s,(r,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Xi(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Pu(t)}catch{return t}}function oi(t){return typeof t=="string"?t:Nu(t)||""}var Zi={},ds={},ai={},ci={};Object.defineProperty(ci,"__esModule",{value:!0});ci.BrowserRandomSource=void 0;const wo=65536;class xu{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const s=new Uint8Array(e);for(let r=0;r<s.length;r+=wo)this._crypto.getRandomValues(s.subarray(r,r+Math.min(s.length-r,wo)));return s}}ci.BrowserRandomSource=xu;function Ru(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var hi={},At={};Object.defineProperty(At,"__esModule",{value:!0});function Tu(t){for(var e=0;e<t.length;e++)t[e]=0;return t}At.wipe=Tu;const Au={},Lu=Object.freeze(Object.defineProperty({__proto__:null,default:Au},Symbol.toStringTag,{value:"Module"})),Cu=Ga(Lu);Object.defineProperty(hi,"__esModule",{value:!0});hi.NodeRandomSource=void 0;const Uu=At;class Mu{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Ru<"u"){const e=Cu;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let s=this._crypto.randomBytes(e);if(s.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const r=new Uint8Array(e);for(let i=0;i<r.length;i++)r[i]=s[i];return(0,Uu.wipe)(s),r}}hi.NodeRandomSource=Mu;Object.defineProperty(ai,"__esModule",{value:!0});ai.SystemRandomSource=void 0;const ku=ci,Du=hi;class ju{constructor(){if(this.isAvailable=!1,this.name="",this._source=new ku.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Du.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}ai.SystemRandomSource=ju;var oe={},pc={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(a,l){var d=a>>>16&65535,g=a&65535,m=l>>>16&65535,A=l&65535;return g*A+(d*A+g*m<<16>>>0)|0}t.mul=Math.imul||e;function s(a,l){return a+l|0}t.add=s;function r(a,l){return a-l|0}t.sub=r;function i(a,l){return a<<l|a>>>32-l}t.rotl=i;function n(a,l){return a<<32-l|a>>>l}t.rotr=n;function c(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a}t.isInteger=Number.isInteger||c,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(a){return t.isInteger(a)&&a>=-t.MAX_SAFE_INTEGER&&a<=t.MAX_SAFE_INTEGER}})(pc);Object.defineProperty(oe,"__esModule",{value:!0});var dc=pc;function zu(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}oe.readInt16BE=zu;function qu(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}oe.readUint16BE=qu;function $u(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}oe.readInt16LE=$u;function Vu(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}oe.readUint16LE=Vu;function gc(t,e,s){return e===void 0&&(e=new Uint8Array(2)),s===void 0&&(s=0),e[s+0]=t>>>8,e[s+1]=t>>>0,e}oe.writeUint16BE=gc;oe.writeInt16BE=gc;function fc(t,e,s){return e===void 0&&(e=new Uint8Array(2)),s===void 0&&(s=0),e[s+0]=t>>>0,e[s+1]=t>>>8,e}oe.writeUint16LE=fc;oe.writeInt16LE=fc;function Ci(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}oe.readInt32BE=Ci;function Ui(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}oe.readUint32BE=Ui;function Mi(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}oe.readInt32LE=Mi;function ki(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}oe.readUint32LE=ki;function Wr(t,e,s){return e===void 0&&(e=new Uint8Array(4)),s===void 0&&(s=0),e[s+0]=t>>>24,e[s+1]=t>>>16,e[s+2]=t>>>8,e[s+3]=t>>>0,e}oe.writeUint32BE=Wr;oe.writeInt32BE=Wr;function Gr(t,e,s){return e===void 0&&(e=new Uint8Array(4)),s===void 0&&(s=0),e[s+0]=t>>>0,e[s+1]=t>>>8,e[s+2]=t>>>16,e[s+3]=t>>>24,e}oe.writeUint32LE=Gr;oe.writeInt32LE=Gr;function Ku(t,e){e===void 0&&(e=0);var s=Ci(t,e),r=Ci(t,e+4);return s*4294967296+r-(r>>31)*4294967296}oe.readInt64BE=Ku;function Hu(t,e){e===void 0&&(e=0);var s=Ui(t,e),r=Ui(t,e+4);return s*4294967296+r}oe.readUint64BE=Hu;function Fu(t,e){e===void 0&&(e=0);var s=Mi(t,e),r=Mi(t,e+4);return r*4294967296+s-(s>>31)*4294967296}oe.readInt64LE=Fu;function Bu(t,e){e===void 0&&(e=0);var s=ki(t,e),r=ki(t,e+4);return r*4294967296+s}oe.readUint64LE=Bu;function yc(t,e,s){return e===void 0&&(e=new Uint8Array(8)),s===void 0&&(s=0),Wr(t/4294967296>>>0,e,s),Wr(t>>>0,e,s+4),e}oe.writeUint64BE=yc;oe.writeInt64BE=yc;function mc(t,e,s){return e===void 0&&(e=new Uint8Array(8)),s===void 0&&(s=0),Gr(t>>>0,e,s),Gr(t/4294967296>>>0,e,s+4),e}oe.writeUint64LE=mc;oe.writeInt64LE=mc;function Wu(t,e,s){if(s===void 0&&(s=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-s)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,i=1,n=t/8+s-1;n>=s;n--)r+=e[n]*i,i*=256;return r}oe.readUintBE=Wu;function Gu(t,e,s){if(s===void 0&&(s=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-s)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,i=1,n=s;n<s+t/8;n++)r+=e[n]*i,i*=256;return r}oe.readUintLE=Gu;function Yu(t,e,s,r){if(s===void 0&&(s=new Uint8Array(t/8)),r===void 0&&(r=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!dc.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var i=1,n=t/8+r-1;n>=r;n--)s[n]=e/i&255,i*=256;return s}oe.writeUintBE=Yu;function Ju(t,e,s,r){if(s===void 0&&(s=new Uint8Array(t/8)),r===void 0&&(r=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!dc.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var i=1,n=r;n<r+t/8;n++)s[n]=e/i&255,i*=256;return s}oe.writeUintLE=Ju;function Qu(t,e){e===void 0&&(e=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.getFloat32(e)}oe.readFloat32BE=Qu;function Xu(t,e){e===void 0&&(e=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.getFloat32(e,!0)}oe.readFloat32LE=Xu;function Zu(t,e){e===void 0&&(e=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.getFloat64(e)}oe.readFloat64BE=Zu;function ep(t,e){e===void 0&&(e=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.getFloat64(e,!0)}oe.readFloat64LE=ep;function tp(t,e,s){e===void 0&&(e=new Uint8Array(4)),s===void 0&&(s=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(s,t),e}oe.writeFloat32BE=tp;function sp(t,e,s){e===void 0&&(e=new Uint8Array(4)),s===void 0&&(s=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(s,t,!0),e}oe.writeFloat32LE=sp;function rp(t,e,s){e===void 0&&(e=new Uint8Array(8)),s===void 0&&(s=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(s,t),e}oe.writeFloat64BE=rp;function ip(t,e,s){e===void 0&&(e=new Uint8Array(8)),s===void 0&&(s=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(s,t,!0),e}oe.writeFloat64LE=ip;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=ai,s=oe,r=At;t.defaultRandomSource=new e.SystemRandomSource;function i(d,g=t.defaultRandomSource){return g.randomBytes(d)}t.randomBytes=i;function n(d=t.defaultRandomSource){const g=i(4,d),m=(0,s.readUint32LE)(g);return(0,r.wipe)(g),m}t.randomUint32=n;const c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function a(d,g=c,m=t.defaultRandomSource){if(g.length<2)throw new Error("randomString charset is too short");if(g.length>256)throw new Error("randomString charset is too long");let A="";const N=g.length,I=256-256%N;for(;d>0;){const x=i(Math.ceil(d*256/I),m);for(let k=0;k<x.length&&d>0;k++){const F=x[k];F<I&&(A+=g.charAt(F%N),d--)}(0,r.wipe)(x)}return A}t.randomString=a;function l(d,g=c,m=t.defaultRandomSource){const A=Math.ceil(d/(Math.log(g.length)/Math.LN2));return a(A,g,m)}t.randomStringForEntropy=l})(ds);var wc={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=oe,s=At;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var r=function(){function a(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return a.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},a.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},a.prototype.clean=function(){s.wipe(this._buffer),s.wipe(this._tempHi),s.wipe(this._tempLo),this.reset()},a.prototype.update=function(l,d){if(d===void 0&&(d=l.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var g=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&d>0;)this._buffer[this._bufferLength++]=l[g++],d--;this._bufferLength===this.blockSize&&(n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(g=n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,l,g,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=l[g++],d--;return this},a.prototype.finish=function(l){if(!this._finished){var d=this._bytesHashed,g=this._bufferLength,m=d/536870912|0,A=d<<3,N=d%128<112?128:256;this._buffer[g]=128;for(var I=g+1;I<N-8;I++)this._buffer[I]=0;e.writeUint32BE(m,this._buffer,N-8),e.writeUint32BE(A,this._buffer,N-4),n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,N),this._finished=!0}for(var I=0;I<this.digestLength/8;I++)e.writeUint32BE(this._stateHi[I],l,I*8),e.writeUint32BE(this._stateLo[I],l,I*8+4);return this},a.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},a.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},a.prototype.restoreState=function(l){return this._stateHi.set(l.stateHi),this._stateLo.set(l.stateLo),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},a.prototype.cleanSavedState=function(l){s.wipe(l.stateHi),s.wipe(l.stateLo),l.buffer&&s.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},a}();t.SHA512=r;var i=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function n(a,l,d,g,m,A,N){for(var I=d[0],x=d[1],k=d[2],F=d[3],S=d[4],O=d[5],y=d[6],v=d[7],p=g[0],o=g[1],u=g[2],D=g[3],b=g[4],T=g[5],U=g[6],z=g[7],w,_,V,$,q,M,j,B;N>=128;){for(var te=0;te<16;te++){var W=8*te+A;a[te]=e.readUint32BE(m,W),l[te]=e.readUint32BE(m,W+4)}for(var te=0;te<80;te++){var se=I,Q=x,re=k,C=F,L=S,P=O,h=y,E=v,G=p,X=o,de=u,be=D,fe=b,Se=T,je=U,Ue=z;if(w=v,_=z,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=(S>>>14|b<<18)^(S>>>18|b<<14)^(b>>>9|S<<23),_=(b>>>14|S<<18)^(b>>>18|S<<14)^(S>>>9|b<<23),q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,w=S&O^~S&y,_=b&T^~b&U,q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,w=i[te*2],_=i[te*2+1],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,w=a[te%16],_=l[te%16],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,V=j&65535|B<<16,$=q&65535|M<<16,w=V,_=$,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=(I>>>28|p<<4)^(p>>>2|I<<30)^(p>>>7|I<<25),_=(p>>>28|I<<4)^(I>>>2|p<<30)^(I>>>7|p<<25),q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,w=I&x^I&k^x&k,_=p&o^p&u^o&u,q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,E=j&65535|B<<16,Ue=q&65535|M<<16,w=C,_=be,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=V,_=$,q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,C=j&65535|B<<16,be=q&65535|M<<16,x=se,k=Q,F=re,S=C,O=L,y=P,v=h,I=E,o=G,u=X,D=de,b=be,T=fe,U=Se,z=je,p=Ue,te%16===15)for(var W=0;W<16;W++)w=a[W],_=l[W],q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=a[(W+9)%16],_=l[(W+9)%16],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,V=a[(W+1)%16],$=l[(W+1)%16],w=(V>>>1|$<<31)^(V>>>8|$<<24)^V>>>7,_=($>>>1|V<<31)^($>>>8|V<<24)^($>>>7|V<<25),q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,V=a[(W+14)%16],$=l[(W+14)%16],w=(V>>>19|$<<13)^($>>>29|V<<3)^V>>>6,_=($>>>19|V<<13)^(V>>>29|$<<3)^($>>>6|V<<26),q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,a[W]=j&65535|B<<16,l[W]=q&65535|M<<16}w=I,_=p,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=d[0],_=g[0],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,d[0]=I=j&65535|B<<16,g[0]=p=q&65535|M<<16,w=x,_=o,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=d[1],_=g[1],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,d[1]=x=j&65535|B<<16,g[1]=o=q&65535|M<<16,w=k,_=u,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=d[2],_=g[2],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,d[2]=k=j&65535|B<<16,g[2]=u=q&65535|M<<16,w=F,_=D,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=d[3],_=g[3],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,d[3]=F=j&65535|B<<16,g[3]=D=q&65535|M<<16,w=S,_=b,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=d[4],_=g[4],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,d[4]=S=j&65535|B<<16,g[4]=b=q&65535|M<<16,w=O,_=T,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=d[5],_=g[5],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,d[5]=O=j&65535|B<<16,g[5]=T=q&65535|M<<16,w=y,_=U,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=d[6],_=g[6],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,d[6]=y=j&65535|B<<16,g[6]=U=q&65535|M<<16,w=v,_=z,q=_&65535,M=_>>>16,j=w&65535,B=w>>>16,w=d[7],_=g[7],q+=_&65535,M+=_>>>16,j+=w&65535,B+=w>>>16,M+=q>>>16,j+=M>>>16,B+=j>>>16,d[7]=v=j&65535|B<<16,g[7]=z=q&65535|M<<16,A+=128,N-=128}return A}function c(a){var l=new r;l.update(a);var d=l.digest();return l.clean(),d}t.hash=c})(wc);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=ds,s=wc,r=At;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function i(C){const L=new Float64Array(16);if(C)for(let P=0;P<C.length;P++)L[P]=C[P];return L}const n=new Uint8Array(32);n[0]=9;const c=i(),a=i([1]),l=i([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),d=i([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),g=i([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),m=i([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),A=i([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function N(C,L){for(let P=0;P<16;P++)C[P]=L[P]|0}function I(C){let L=1;for(let P=0;P<16;P++){let h=C[P]+L+65535;L=Math.floor(h/65536),C[P]=h-L*65536}C[0]+=L-1+37*(L-1)}function x(C,L,P){const h=~(P-1);for(let E=0;E<16;E++){const G=h&(C[E]^L[E]);C[E]^=G,L[E]^=G}}function k(C,L){const P=i(),h=i();for(let E=0;E<16;E++)h[E]=L[E];I(h),I(h),I(h);for(let E=0;E<2;E++){P[0]=h[0]-65517;for(let X=1;X<15;X++)P[X]=h[X]-65535-(P[X-1]>>16&1),P[X-1]&=65535;P[15]=h[15]-32767-(P[14]>>16&1);const G=P[15]>>16&1;P[14]&=65535,x(h,P,1-G)}for(let E=0;E<16;E++)C[2*E]=h[E]&255,C[2*E+1]=h[E]>>8}function F(C,L){let P=0;for(let h=0;h<32;h++)P|=C[h]^L[h];return(1&P-1>>>8)-1}function S(C,L){const P=new Uint8Array(32),h=new Uint8Array(32);return k(P,C),k(h,L),F(P,h)}function O(C){const L=new Uint8Array(32);return k(L,C),L[0]&1}function y(C,L){for(let P=0;P<16;P++)C[P]=L[2*P]+(L[2*P+1]<<8);C[15]&=32767}function v(C,L,P){for(let h=0;h<16;h++)C[h]=L[h]+P[h]}function p(C,L,P){for(let h=0;h<16;h++)C[h]=L[h]-P[h]}function o(C,L,P){let h,E,G=0,X=0,de=0,be=0,fe=0,Se=0,je=0,Ue=0,we=0,ye=0,ge=0,ue=0,le=0,he=0,ae=0,ie=0,pe=0,me=0,ne=0,ve=0,Ee=0,Oe=0,Ne=0,Ie=0,jt=0,$t=0,ns=0,Nt=0,fs=0,Hs=0,xr=0,qe=P[0],Me=P[1],$e=P[2],Ve=P[3],Ke=P[4],ke=P[5],Xe=P[6],Ze=P[7],et=P[8],tt=P[9],st=P[10],Je=P[11],He=P[12],Le=P[13],rt=P[14],it=P[15];h=L[0],G+=h*qe,X+=h*Me,de+=h*$e,be+=h*Ve,fe+=h*Ke,Se+=h*ke,je+=h*Xe,Ue+=h*Ze,we+=h*et,ye+=h*tt,ge+=h*st,ue+=h*Je,le+=h*He,he+=h*Le,ae+=h*rt,ie+=h*it,h=L[1],X+=h*qe,de+=h*Me,be+=h*$e,fe+=h*Ve,Se+=h*Ke,je+=h*ke,Ue+=h*Xe,we+=h*Ze,ye+=h*et,ge+=h*tt,ue+=h*st,le+=h*Je,he+=h*He,ae+=h*Le,ie+=h*rt,pe+=h*it,h=L[2],de+=h*qe,be+=h*Me,fe+=h*$e,Se+=h*Ve,je+=h*Ke,Ue+=h*ke,we+=h*Xe,ye+=h*Ze,ge+=h*et,ue+=h*tt,le+=h*st,he+=h*Je,ae+=h*He,ie+=h*Le,pe+=h*rt,me+=h*it,h=L[3],be+=h*qe,fe+=h*Me,Se+=h*$e,je+=h*Ve,Ue+=h*Ke,we+=h*ke,ye+=h*Xe,ge+=h*Ze,ue+=h*et,le+=h*tt,he+=h*st,ae+=h*Je,ie+=h*He,pe+=h*Le,me+=h*rt,ne+=h*it,h=L[4],fe+=h*qe,Se+=h*Me,je+=h*$e,Ue+=h*Ve,we+=h*Ke,ye+=h*ke,ge+=h*Xe,ue+=h*Ze,le+=h*et,he+=h*tt,ae+=h*st,ie+=h*Je,pe+=h*He,me+=h*Le,ne+=h*rt,ve+=h*it,h=L[5],Se+=h*qe,je+=h*Me,Ue+=h*$e,we+=h*Ve,ye+=h*Ke,ge+=h*ke,ue+=h*Xe,le+=h*Ze,he+=h*et,ae+=h*tt,ie+=h*st,pe+=h*Je,me+=h*He,ne+=h*Le,ve+=h*rt,Ee+=h*it,h=L[6],je+=h*qe,Ue+=h*Me,we+=h*$e,ye+=h*Ve,ge+=h*Ke,ue+=h*ke,le+=h*Xe,he+=h*Ze,ae+=h*et,ie+=h*tt,pe+=h*st,me+=h*Je,ne+=h*He,ve+=h*Le,Ee+=h*rt,Oe+=h*it,h=L[7],Ue+=h*qe,we+=h*Me,ye+=h*$e,ge+=h*Ve,ue+=h*Ke,le+=h*ke,he+=h*Xe,ae+=h*Ze,ie+=h*et,pe+=h*tt,me+=h*st,ne+=h*Je,ve+=h*He,Ee+=h*Le,Oe+=h*rt,Ne+=h*it,h=L[8],we+=h*qe,ye+=h*Me,ge+=h*$e,ue+=h*Ve,le+=h*Ke,he+=h*ke,ae+=h*Xe,ie+=h*Ze,pe+=h*et,me+=h*tt,ne+=h*st,ve+=h*Je,Ee+=h*He,Oe+=h*Le,Ne+=h*rt,Ie+=h*it,h=L[9],ye+=h*qe,ge+=h*Me,ue+=h*$e,le+=h*Ve,he+=h*Ke,ae+=h*ke,ie+=h*Xe,pe+=h*Ze,me+=h*et,ne+=h*tt,ve+=h*st,Ee+=h*Je,Oe+=h*He,Ne+=h*Le,Ie+=h*rt,jt+=h*it,h=L[10],ge+=h*qe,ue+=h*Me,le+=h*$e,he+=h*Ve,ae+=h*Ke,ie+=h*ke,pe+=h*Xe,me+=h*Ze,ne+=h*et,ve+=h*tt,Ee+=h*st,Oe+=h*Je,Ne+=h*He,Ie+=h*Le,jt+=h*rt,$t+=h*it,h=L[11],ue+=h*qe,le+=h*Me,he+=h*$e,ae+=h*Ve,ie+=h*Ke,pe+=h*ke,me+=h*Xe,ne+=h*Ze,ve+=h*et,Ee+=h*tt,Oe+=h*st,Ne+=h*Je,Ie+=h*He,jt+=h*Le,$t+=h*rt,ns+=h*it,h=L[12],le+=h*qe,he+=h*Me,ae+=h*$e,ie+=h*Ve,pe+=h*Ke,me+=h*ke,ne+=h*Xe,ve+=h*Ze,Ee+=h*et,Oe+=h*tt,Ne+=h*st,Ie+=h*Je,jt+=h*He,$t+=h*Le,ns+=h*rt,Nt+=h*it,h=L[13],he+=h*qe,ae+=h*Me,ie+=h*$e,pe+=h*Ve,me+=h*Ke,ne+=h*ke,ve+=h*Xe,Ee+=h*Ze,Oe+=h*et,Ne+=h*tt,Ie+=h*st,jt+=h*Je,$t+=h*He,ns+=h*Le,Nt+=h*rt,fs+=h*it,h=L[14],ae+=h*qe,ie+=h*Me,pe+=h*$e,me+=h*Ve,ne+=h*Ke,ve+=h*ke,Ee+=h*Xe,Oe+=h*Ze,Ne+=h*et,Ie+=h*tt,jt+=h*st,$t+=h*Je,ns+=h*He,Nt+=h*Le,fs+=h*rt,Hs+=h*it,h=L[15],ie+=h*qe,pe+=h*Me,me+=h*$e,ne+=h*Ve,ve+=h*Ke,Ee+=h*ke,Oe+=h*Xe,Ne+=h*Ze,Ie+=h*et,jt+=h*tt,$t+=h*st,ns+=h*Je,Nt+=h*He,fs+=h*Le,Hs+=h*rt,xr+=h*it,G+=38*pe,X+=38*me,de+=38*ne,be+=38*ve,fe+=38*Ee,Se+=38*Oe,je+=38*Ne,Ue+=38*Ie,we+=38*jt,ye+=38*$t,ge+=38*ns,ue+=38*Nt,le+=38*fs,he+=38*Hs,ae+=38*xr,E=1,h=G+E+65535,E=Math.floor(h/65536),G=h-E*65536,h=X+E+65535,E=Math.floor(h/65536),X=h-E*65536,h=de+E+65535,E=Math.floor(h/65536),de=h-E*65536,h=be+E+65535,E=Math.floor(h/65536),be=h-E*65536,h=fe+E+65535,E=Math.floor(h/65536),fe=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,h=je+E+65535,E=Math.floor(h/65536),je=h-E*65536,h=Ue+E+65535,E=Math.floor(h/65536),Ue=h-E*65536,h=we+E+65535,E=Math.floor(h/65536),we=h-E*65536,h=ye+E+65535,E=Math.floor(h/65536),ye=h-E*65536,h=ge+E+65535,E=Math.floor(h/65536),ge=h-E*65536,h=ue+E+65535,E=Math.floor(h/65536),ue=h-E*65536,h=le+E+65535,E=Math.floor(h/65536),le=h-E*65536,h=he+E+65535,E=Math.floor(h/65536),he=h-E*65536,h=ae+E+65535,E=Math.floor(h/65536),ae=h-E*65536,h=ie+E+65535,E=Math.floor(h/65536),ie=h-E*65536,G+=E-1+37*(E-1),E=1,h=G+E+65535,E=Math.floor(h/65536),G=h-E*65536,h=X+E+65535,E=Math.floor(h/65536),X=h-E*65536,h=de+E+65535,E=Math.floor(h/65536),de=h-E*65536,h=be+E+65535,E=Math.floor(h/65536),be=h-E*65536,h=fe+E+65535,E=Math.floor(h/65536),fe=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,h=je+E+65535,E=Math.floor(h/65536),je=h-E*65536,h=Ue+E+65535,E=Math.floor(h/65536),Ue=h-E*65536,h=we+E+65535,E=Math.floor(h/65536),we=h-E*65536,h=ye+E+65535,E=Math.floor(h/65536),ye=h-E*65536,h=ge+E+65535,E=Math.floor(h/65536),ge=h-E*65536,h=ue+E+65535,E=Math.floor(h/65536),ue=h-E*65536,h=le+E+65535,E=Math.floor(h/65536),le=h-E*65536,h=he+E+65535,E=Math.floor(h/65536),he=h-E*65536,h=ae+E+65535,E=Math.floor(h/65536),ae=h-E*65536,h=ie+E+65535,E=Math.floor(h/65536),ie=h-E*65536,G+=E-1+37*(E-1),C[0]=G,C[1]=X,C[2]=de,C[3]=be,C[4]=fe,C[5]=Se,C[6]=je,C[7]=Ue,C[8]=we,C[9]=ye,C[10]=ge,C[11]=ue,C[12]=le,C[13]=he,C[14]=ae,C[15]=ie}function u(C,L){o(C,L,L)}function D(C,L){const P=i();let h;for(h=0;h<16;h++)P[h]=L[h];for(h=253;h>=0;h--)u(P,P),h!==2&&h!==4&&o(P,P,L);for(h=0;h<16;h++)C[h]=P[h]}function b(C,L){const P=i();let h;for(h=0;h<16;h++)P[h]=L[h];for(h=250;h>=0;h--)u(P,P),h!==1&&o(P,P,L);for(h=0;h<16;h++)C[h]=P[h]}function T(C,L){const P=i(),h=i(),E=i(),G=i(),X=i(),de=i(),be=i(),fe=i(),Se=i();p(P,C[1],C[0]),p(Se,L[1],L[0]),o(P,P,Se),v(h,C[0],C[1]),v(Se,L[0],L[1]),o(h,h,Se),o(E,C[3],L[3]),o(E,E,d),o(G,C[2],L[2]),v(G,G,G),p(X,h,P),p(de,G,E),v(be,G,E),v(fe,h,P),o(C[0],X,de),o(C[1],fe,be),o(C[2],be,de),o(C[3],X,fe)}function U(C,L,P){for(let h=0;h<4;h++)x(C[h],L[h],P)}function z(C,L){const P=i(),h=i(),E=i();D(E,L[2]),o(P,L[0],E),o(h,L[1],E),k(C,h),C[31]^=O(P)<<7}function w(C,L,P){N(C[0],c),N(C[1],a),N(C[2],a),N(C[3],c);for(let h=255;h>=0;--h){const E=P[h/8|0]>>(h&7)&1;U(C,L,E),T(L,C),T(C,C),U(C,L,E)}}function _(C,L){const P=[i(),i(),i(),i()];N(P[0],g),N(P[1],m),N(P[2],a),o(P[3],g,m),w(C,P,L)}function V(C){if(C.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const L=(0,s.hash)(C);L[0]&=248,L[31]&=127,L[31]|=64;const P=new Uint8Array(32),h=[i(),i(),i(),i()];_(h,L),z(P,h);const E=new Uint8Array(64);return E.set(C),E.set(P,32),{publicKey:P,secretKey:E}}t.generateKeyPairFromSeed=V;function $(C){const L=(0,e.randomBytes)(32,C),P=V(L);return(0,r.wipe)(L),P}t.generateKeyPair=$;function q(C){if(C.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(C.subarray(32))}t.extractPublicKeyFromSecretKey=q;const M=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function j(C,L){let P,h,E,G;for(h=63;h>=32;--h){for(P=0,E=h-32,G=h-12;E<G;++E)L[E]+=P-16*L[h]*M[E-(h-32)],P=Math.floor((L[E]+128)/256),L[E]-=P*256;L[E]+=P,L[h]=0}for(P=0,E=0;E<32;E++)L[E]+=P-(L[31]>>4)*M[E],P=L[E]>>8,L[E]&=255;for(E=0;E<32;E++)L[E]-=P*M[E];for(h=0;h<32;h++)L[h+1]+=L[h]>>8,C[h]=L[h]&255}function B(C){const L=new Float64Array(64);for(let P=0;P<64;P++)L[P]=C[P];for(let P=0;P<64;P++)C[P]=0;j(C,L)}function te(C,L){const P=new Float64Array(64),h=[i(),i(),i(),i()],E=(0,s.hash)(C.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const G=new Uint8Array(64);G.set(E.subarray(32),32);const X=new s.SHA512;X.update(G.subarray(32)),X.update(L);const de=X.digest();X.clean(),B(de),_(h,de),z(G,h),X.reset(),X.update(G.subarray(0,32)),X.update(C.subarray(32)),X.update(L);const be=X.digest();B(be);for(let fe=0;fe<32;fe++)P[fe]=de[fe];for(let fe=0;fe<32;fe++)for(let Se=0;Se<32;Se++)P[fe+Se]+=be[fe]*E[Se];return j(G.subarray(32),P),G}t.sign=te;function W(C,L){const P=i(),h=i(),E=i(),G=i(),X=i(),de=i(),be=i();return N(C[2],a),y(C[1],L),u(E,C[1]),o(G,E,l),p(E,E,C[2]),v(G,C[2],G),u(X,G),u(de,X),o(be,de,X),o(P,be,E),o(P,P,G),b(P,P),o(P,P,E),o(P,P,G),o(P,P,G),o(C[0],P,G),u(h,C[0]),o(h,h,G),S(h,E)&&o(C[0],C[0],A),u(h,C[0]),o(h,h,G),S(h,E)?-1:(O(C[0])===L[31]>>7&&p(C[0],c,C[0]),o(C[3],C[0],C[1]),0)}function se(C,L,P){const h=new Uint8Array(32),E=[i(),i(),i(),i()],G=[i(),i(),i(),i()];if(P.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(W(G,C))return!1;const X=new s.SHA512;X.update(P.subarray(0,32)),X.update(C),X.update(L);const de=X.digest();return B(de),w(E,G,de),_(G,P.subarray(32)),T(E,G),z(h,E),!F(P,h)}t.verify=se;function Q(C){let L=[i(),i(),i(),i()];if(W(L,C))throw new Error("Ed25519: invalid public key");let P=i(),h=i(),E=L[1];v(P,a,E),p(h,a,E),D(h,h),o(P,P,h);let G=new Uint8Array(32);return k(G,P),G}t.convertPublicKeyToX25519=Q;function re(C){const L=(0,s.hash)(C.subarray(0,32));L[0]&=248,L[31]&=127,L[31]|=64;const P=new Uint8Array(L.subarray(0,32));return(0,r.wipe)(L),P}t.convertSecretKeyToX25519=re})(Zi);const np="EdDSA",op="JWT",bc=".",vc="base64url",ap="utf8",cp="utf8",hp=":",lp="did",up="key",bo="base58btc",pp="z",dp="K36",gp=32;function en(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function _c(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?en(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function pr(t,e){e||(e=t.reduce((i,n)=>i+n.length,0));const s=_c(e);let r=0;for(const i of t)s.set(i,r),r+=i.length;return en(s)}function fp(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),r=0;r<s.length;r++)s[r]=255;for(var i=0;i<t.length;i++){var n=t.charAt(i),c=n.charCodeAt(0);if(s[c]!==255)throw new TypeError(n+" is ambiguous");s[c]=i}var a=t.length,l=t.charAt(0),d=Math.log(a)/Math.log(256),g=Math.log(256)/Math.log(a);function m(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var x=0,k=0,F=0,S=I.length;F!==S&&I[F]===0;)F++,x++;for(var O=(S-F)*g+1>>>0,y=new Uint8Array(O);F!==S;){for(var v=I[F],p=0,o=O-1;(v!==0||p<k)&&o!==-1;o--,p++)v+=256*y[o]>>>0,y[o]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");k=p,F++}for(var u=O-k;u!==O&&y[u]===0;)u++;for(var D=l.repeat(x);u<O;++u)D+=t.charAt(y[u]);return D}function A(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var x=0;if(I[x]!==" "){for(var k=0,F=0;I[x]===l;)k++,x++;for(var S=(I.length-x)*d+1>>>0,O=new Uint8Array(S);I[x];){var y=s[I.charCodeAt(x)];if(y===255)return;for(var v=0,p=S-1;(y!==0||v<F)&&p!==-1;p--,v++)y+=a*O[p]>>>0,O[p]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");F=v,x++}if(I[x]!==" "){for(var o=S-F;o!==S&&O[o]===0;)o++;for(var u=new Uint8Array(k+(S-o)),D=k;o!==S;)u[D++]=O[o++];return u}}}function N(I){var x=A(I);if(x)return x;throw new Error(`Non-${e} character`)}return{encode:m,decodeUnsafe:A,decode:N}}var yp=fp,mp=yp;const wp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},bp=t=>new TextEncoder().encode(t),vp=t=>new TextDecoder().decode(t);class _p{constructor(e,s,r){this.name=e,this.prefix=s,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ep{constructor(e,s,r){if(this.name=e,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ec(this,e)}}class Sp{constructor(e){this.decoders=e}or(e){return Ec(this,e)}decode(e){const s=e[0],r=this.decoders[s];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ec=(t,e)=>new Sp({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Ip{constructor(e,s,r,i){this.name=e,this.prefix=s,this.baseEncode=r,this.baseDecode=i,this.encoder=new _p(e,s,r),this.decoder=new Ep(e,s,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const li=({name:t,prefix:e,encode:s,decode:r})=>new Ip(t,e,s,r),fr=({prefix:t,name:e,alphabet:s})=>{const{encode:r,decode:i}=mp(s,e);return li({prefix:t,name:e,encode:r,decode:n=>wp(i(n))})},Op=(t,e,s,r)=>{const i={};for(let g=0;g<e.length;++g)i[e[g]]=g;let n=t.length;for(;t[n-1]==="=";)--n;const c=new Uint8Array(n*s/8|0);let a=0,l=0,d=0;for(let g=0;g<n;++g){const m=i[t[g]];if(m===void 0)throw new SyntaxError(`Non-${r} character`);l=l<<s|m,a+=s,a>=8&&(a-=8,c[d++]=255&l>>a)}if(a>=s||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return c},Np=(t,e,s)=>{const r=e[e.length-1]==="=",i=(1<<s)-1;let n="",c=0,a=0;for(let l=0;l<t.length;++l)for(a=a<<8|t[l],c+=8;c>s;)c-=s,n+=e[i&a>>c];if(c&&(n+=e[i&a<<s-c]),r)for(;n.length*s&7;)n+="=";return n},ut=({name:t,prefix:e,bitsPerChar:s,alphabet:r})=>li({prefix:e,name:t,encode(i){return Np(i,r,s)},decode(i){return Op(i,r,s,t)}}),Pp=li({prefix:"\0",name:"identity",encode:t=>vp(t),decode:t=>bp(t)}),xp=Object.freeze(Object.defineProperty({__proto__:null,identity:Pp},Symbol.toStringTag,{value:"Module"})),Rp=ut({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Tp=Object.freeze(Object.defineProperty({__proto__:null,base2:Rp},Symbol.toStringTag,{value:"Module"})),Ap=ut({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Lp=Object.freeze(Object.defineProperty({__proto__:null,base8:Ap},Symbol.toStringTag,{value:"Module"})),Cp=fr({prefix:"9",name:"base10",alphabet:"0123456789"}),Up=Object.freeze(Object.defineProperty({__proto__:null,base10:Cp},Symbol.toStringTag,{value:"Module"})),Mp=ut({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),kp=ut({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Dp=Object.freeze(Object.defineProperty({__proto__:null,base16:Mp,base16upper:kp},Symbol.toStringTag,{value:"Module"})),jp=ut({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),zp=ut({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),qp=ut({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$p=ut({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Vp=ut({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Kp=ut({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Hp=ut({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Fp=ut({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bp=ut({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Wp=Object.freeze(Object.defineProperty({__proto__:null,base32:jp,base32hex:Vp,base32hexpad:Hp,base32hexpadupper:Fp,base32hexupper:Kp,base32pad:qp,base32padupper:$p,base32upper:zp,base32z:Bp},Symbol.toStringTag,{value:"Module"})),Gp=fr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Yp=fr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Jp=Object.freeze(Object.defineProperty({__proto__:null,base36:Gp,base36upper:Yp},Symbol.toStringTag,{value:"Module"})),Qp=fr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Xp=fr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Zp=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Qp,base58flickr:Xp},Symbol.toStringTag,{value:"Module"})),ed=ut({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),td=ut({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),sd=ut({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),rd=ut({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),id=Object.freeze(Object.defineProperty({__proto__:null,base64:ed,base64pad:td,base64url:sd,base64urlpad:rd},Symbol.toStringTag,{value:"Module"})),Sc=Array.from(""),nd=Sc.reduce((t,e,s)=>(t[s]=e,t),[]),od=Sc.reduce((t,e,s)=>(t[e.codePointAt(0)]=s,t),[]);function ad(t){return t.reduce((e,s)=>(e+=nd[s],e),"")}function cd(t){const e=[];for(const s of t){const r=od[s.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${s}`);e.push(r)}return new Uint8Array(e)}const hd=li({prefix:"",name:"base256emoji",encode:ad,decode:cd}),ld=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:hd},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const vo={...xp,...Tp,...Lp,...Up,...Dp,...Wp,...Jp,...Zp,...id,...ld};function Ic(t,e,s,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:r}}}const _o=Ic("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),vi=Ic("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);const e=_c(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),Oc={utf8:_o,"utf-8":_o,hex:vo.base16,latin1:vi,ascii:vi,binary:vi,...vo};function xe(t,e="utf8"){const s=Oc[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):s.encoder.encode(t).substring(1)}function Ae(t,e="utf8"){const s=Oc[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?en(globalThis.Buffer.from(t,"utf-8")):s.decoder.decode(`${s.prefix}${t}`)}function Yr(t){return xe(Ae(oi(t),ap),vc)}function tn(t){const e=Ae(dp,bo),s=pp+xe(pr([e,t]),bo);return[lp,up,s].join(hp)}function ud(t){return xe(t,vc)}function pd(t){return Ae([Yr(t.header),Yr(t.payload)].join(bc),cp)}function dd(t){return[Yr(t.header),Yr(t.payload),ud(t.signature)].join(bc)}function Jr(t=ds.randomBytes(gp)){return Zi.generateKeyPairFromSeed(t)}async function Nc(t,e,s,r,i=K.fromMiliseconds(Date.now())){const n={alg:np,typ:op},c=tn(r.publicKey),a=i+s,l={iss:c,sub:t,aud:e,iat:i,exp:a},d=pd({header:n,payload:l}),g=Zi.sign(r.secretKey,d);return dd({header:n,payload:l,signature:g})}var yr={},ui={};Object.defineProperty(ui,"__esModule",{value:!0});var ft=oe,Di=At,gd=20;function fd(t,e,s){for(var r=1634760805,i=857760878,n=2036477234,c=1797285236,a=s[3]<<24|s[2]<<16|s[1]<<8|s[0],l=s[7]<<24|s[6]<<16|s[5]<<8|s[4],d=s[11]<<24|s[10]<<16|s[9]<<8|s[8],g=s[15]<<24|s[14]<<16|s[13]<<8|s[12],m=s[19]<<24|s[18]<<16|s[17]<<8|s[16],A=s[23]<<24|s[22]<<16|s[21]<<8|s[20],N=s[27]<<24|s[26]<<16|s[25]<<8|s[24],I=s[31]<<24|s[30]<<16|s[29]<<8|s[28],x=e[3]<<24|e[2]<<16|e[1]<<8|e[0],k=e[7]<<24|e[6]<<16|e[5]<<8|e[4],F=e[11]<<24|e[10]<<16|e[9]<<8|e[8],S=e[15]<<24|e[14]<<16|e[13]<<8|e[12],O=r,y=i,v=n,p=c,o=a,u=l,D=d,b=g,T=m,U=A,z=N,w=I,_=x,V=k,$=F,q=S,M=0;M<gd;M+=2)O=O+o|0,_^=O,_=_>>>16|_<<16,T=T+_|0,o^=T,o=o>>>20|o<<12,y=y+u|0,V^=y,V=V>>>16|V<<16,U=U+V|0,u^=U,u=u>>>20|u<<12,v=v+D|0,$^=v,$=$>>>16|$<<16,z=z+$|0,D^=z,D=D>>>20|D<<12,p=p+b|0,q^=p,q=q>>>16|q<<16,w=w+q|0,b^=w,b=b>>>20|b<<12,v=v+D|0,$^=v,$=$>>>24|$<<8,z=z+$|0,D^=z,D=D>>>25|D<<7,p=p+b|0,q^=p,q=q>>>24|q<<8,w=w+q|0,b^=w,b=b>>>25|b<<7,y=y+u|0,V^=y,V=V>>>24|V<<8,U=U+V|0,u^=U,u=u>>>25|u<<7,O=O+o|0,_^=O,_=_>>>24|_<<8,T=T+_|0,o^=T,o=o>>>25|o<<7,O=O+u|0,q^=O,q=q>>>16|q<<16,z=z+q|0,u^=z,u=u>>>20|u<<12,y=y+D|0,_^=y,_=_>>>16|_<<16,w=w+_|0,D^=w,D=D>>>20|D<<12,v=v+b|0,V^=v,V=V>>>16|V<<16,T=T+V|0,b^=T,b=b>>>20|b<<12,p=p+o|0,$^=p,$=$>>>16|$<<16,U=U+$|0,o^=U,o=o>>>20|o<<12,v=v+b|0,V^=v,V=V>>>24|V<<8,T=T+V|0,b^=T,b=b>>>25|b<<7,p=p+o|0,$^=p,$=$>>>24|$<<8,U=U+$|0,o^=U,o=o>>>25|o<<7,y=y+D|0,_^=y,_=_>>>24|_<<8,w=w+_|0,D^=w,D=D>>>25|D<<7,O=O+u|0,q^=O,q=q>>>24|q<<8,z=z+q|0,u^=z,u=u>>>25|u<<7;ft.writeUint32LE(O+r|0,t,0),ft.writeUint32LE(y+i|0,t,4),ft.writeUint32LE(v+n|0,t,8),ft.writeUint32LE(p+c|0,t,12),ft.writeUint32LE(o+a|0,t,16),ft.writeUint32LE(u+l|0,t,20),ft.writeUint32LE(D+d|0,t,24),ft.writeUint32LE(b+g|0,t,28),ft.writeUint32LE(T+m|0,t,32),ft.writeUint32LE(U+A|0,t,36),ft.writeUint32LE(z+N|0,t,40),ft.writeUint32LE(w+I|0,t,44),ft.writeUint32LE(_+x|0,t,48),ft.writeUint32LE(V+k|0,t,52),ft.writeUint32LE($+F|0,t,56),ft.writeUint32LE(q+S|0,t,60)}function Pc(t,e,s,r,i){if(i===void 0&&(i=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(r.length<s.length)throw new Error("ChaCha: destination is shorter than source");var n,c;if(i===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");n=new Uint8Array(16),c=n.length-e.length,n.set(e,c)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");n=e,c=i}for(var a=new Uint8Array(64),l=0;l<s.length;l+=64){fd(a,n,t);for(var d=l;d<l+64&&d<s.length;d++)r[d]=s[d]^a[d-l];md(n,0,c)}return Di.wipe(a),i===0&&Di.wipe(n),r}ui.streamXOR=Pc;function yd(t,e,s,r){return r===void 0&&(r=0),Di.wipe(s),Pc(t,e,s,s,r)}ui.stream=yd;function md(t,e,s){for(var r=1;s--;)r=r+(t[e]&255)|0,t[e]=r&255,r>>>=8,e++;if(r>0)throw new Error("ChaCha: counter overflow")}var xc={},gs={};Object.defineProperty(gs,"__esModule",{value:!0});function wd(t,e,s){return~(t-1)&e|t-1&s}gs.select=wd;function bd(t,e){return(t|0)-(e|0)-1>>>31&1}gs.lessOrEqual=bd;function Rc(t,e){if(t.length!==e.length)return 0;for(var s=0,r=0;r<t.length;r++)s|=t[r]^e[r];return 1&s-1>>>8}gs.compare=Rc;function vd(t,e){return t.length===0||e.length===0?!1:Rc(t,e)!==0}gs.equal=vd;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=gs,s=At;t.DIGEST_LENGTH=16;var r=function(){function c(a){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var l=a[0]|a[1]<<8;this._r[0]=l&8191;var d=a[2]|a[3]<<8;this._r[1]=(l>>>13|d<<3)&8191;var g=a[4]|a[5]<<8;this._r[2]=(d>>>10|g<<6)&7939;var m=a[6]|a[7]<<8;this._r[3]=(g>>>7|m<<9)&8191;var A=a[8]|a[9]<<8;this._r[4]=(m>>>4|A<<12)&255,this._r[5]=A>>>1&8190;var N=a[10]|a[11]<<8;this._r[6]=(A>>>14|N<<2)&8191;var I=a[12]|a[13]<<8;this._r[7]=(N>>>11|I<<5)&8065;var x=a[14]|a[15]<<8;this._r[8]=(I>>>8|x<<8)&8191,this._r[9]=x>>>5&127,this._pad[0]=a[16]|a[17]<<8,this._pad[1]=a[18]|a[19]<<8,this._pad[2]=a[20]|a[21]<<8,this._pad[3]=a[22]|a[23]<<8,this._pad[4]=a[24]|a[25]<<8,this._pad[5]=a[26]|a[27]<<8,this._pad[6]=a[28]|a[29]<<8,this._pad[7]=a[30]|a[31]<<8}return c.prototype._blocks=function(a,l,d){for(var g=this._fin?0:2048,m=this._h[0],A=this._h[1],N=this._h[2],I=this._h[3],x=this._h[4],k=this._h[5],F=this._h[6],S=this._h[7],O=this._h[8],y=this._h[9],v=this._r[0],p=this._r[1],o=this._r[2],u=this._r[3],D=this._r[4],b=this._r[5],T=this._r[6],U=this._r[7],z=this._r[8],w=this._r[9];d>=16;){var _=a[l+0]|a[l+1]<<8;m+=_&8191;var V=a[l+2]|a[l+3]<<8;A+=(_>>>13|V<<3)&8191;var $=a[l+4]|a[l+5]<<8;N+=(V>>>10|$<<6)&8191;var q=a[l+6]|a[l+7]<<8;I+=($>>>7|q<<9)&8191;var M=a[l+8]|a[l+9]<<8;x+=(q>>>4|M<<12)&8191,k+=M>>>1&8191;var j=a[l+10]|a[l+11]<<8;F+=(M>>>14|j<<2)&8191;var B=a[l+12]|a[l+13]<<8;S+=(j>>>11|B<<5)&8191;var te=a[l+14]|a[l+15]<<8;O+=(B>>>8|te<<8)&8191,y+=te>>>5|g;var W=0,se=W;se+=m*v,se+=A*(5*w),se+=N*(5*z),se+=I*(5*U),se+=x*(5*T),W=se>>>13,se&=8191,se+=k*(5*b),se+=F*(5*D),se+=S*(5*u),se+=O*(5*o),se+=y*(5*p),W+=se>>>13,se&=8191;var Q=W;Q+=m*p,Q+=A*v,Q+=N*(5*w),Q+=I*(5*z),Q+=x*(5*U),W=Q>>>13,Q&=8191,Q+=k*(5*T),Q+=F*(5*b),Q+=S*(5*D),Q+=O*(5*u),Q+=y*(5*o),W+=Q>>>13,Q&=8191;var re=W;re+=m*o,re+=A*p,re+=N*v,re+=I*(5*w),re+=x*(5*z),W=re>>>13,re&=8191,re+=k*(5*U),re+=F*(5*T),re+=S*(5*b),re+=O*(5*D),re+=y*(5*u),W+=re>>>13,re&=8191;var C=W;C+=m*u,C+=A*o,C+=N*p,C+=I*v,C+=x*(5*w),W=C>>>13,C&=8191,C+=k*(5*z),C+=F*(5*U),C+=S*(5*T),C+=O*(5*b),C+=y*(5*D),W+=C>>>13,C&=8191;var L=W;L+=m*D,L+=A*u,L+=N*o,L+=I*p,L+=x*v,W=L>>>13,L&=8191,L+=k*(5*w),L+=F*(5*z),L+=S*(5*U),L+=O*(5*T),L+=y*(5*b),W+=L>>>13,L&=8191;var P=W;P+=m*b,P+=A*D,P+=N*u,P+=I*o,P+=x*p,W=P>>>13,P&=8191,P+=k*v,P+=F*(5*w),P+=S*(5*z),P+=O*(5*U),P+=y*(5*T),W+=P>>>13,P&=8191;var h=W;h+=m*T,h+=A*b,h+=N*D,h+=I*u,h+=x*o,W=h>>>13,h&=8191,h+=k*p,h+=F*v,h+=S*(5*w),h+=O*(5*z),h+=y*(5*U),W+=h>>>13,h&=8191;var E=W;E+=m*U,E+=A*T,E+=N*b,E+=I*D,E+=x*u,W=E>>>13,E&=8191,E+=k*o,E+=F*p,E+=S*v,E+=O*(5*w),E+=y*(5*z),W+=E>>>13,E&=8191;var G=W;G+=m*z,G+=A*U,G+=N*T,G+=I*b,G+=x*D,W=G>>>13,G&=8191,G+=k*u,G+=F*o,G+=S*p,G+=O*v,G+=y*(5*w),W+=G>>>13,G&=8191;var X=W;X+=m*w,X+=A*z,X+=N*U,X+=I*T,X+=x*b,W=X>>>13,X&=8191,X+=k*D,X+=F*u,X+=S*o,X+=O*p,X+=y*v,W+=X>>>13,X&=8191,W=(W<<2)+W|0,W=W+se|0,se=W&8191,W=W>>>13,Q+=W,m=se,A=Q,N=re,I=C,x=L,k=P,F=h,S=E,O=G,y=X,l+=16,d-=16}this._h[0]=m,this._h[1]=A,this._h[2]=N,this._h[3]=I,this._h[4]=x,this._h[5]=k,this._h[6]=F,this._h[7]=S,this._h[8]=O,this._h[9]=y},c.prototype.finish=function(a,l){l===void 0&&(l=0);var d=new Uint16Array(10),g,m,A,N;if(this._leftover){for(N=this._leftover,this._buffer[N++]=1;N<16;N++)this._buffer[N]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(g=this._h[1]>>>13,this._h[1]&=8191,N=2;N<10;N++)this._h[N]+=g,g=this._h[N]>>>13,this._h[N]&=8191;for(this._h[0]+=g*5,g=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=g,g=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=g,d[0]=this._h[0]+5,g=d[0]>>>13,d[0]&=8191,N=1;N<10;N++)d[N]=this._h[N]+g,g=d[N]>>>13,d[N]&=8191;for(d[9]-=8192,m=(g^1)-1,N=0;N<10;N++)d[N]&=m;for(m=~m,N=0;N<10;N++)this._h[N]=this._h[N]&m|d[N];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,A=this._h[0]+this._pad[0],this._h[0]=A&65535,N=1;N<8;N++)A=(this._h[N]+this._pad[N]|0)+(A>>>16)|0,this._h[N]=A&65535;return a[l+0]=this._h[0]>>>0,a[l+1]=this._h[0]>>>8,a[l+2]=this._h[1]>>>0,a[l+3]=this._h[1]>>>8,a[l+4]=this._h[2]>>>0,a[l+5]=this._h[2]>>>8,a[l+6]=this._h[3]>>>0,a[l+7]=this._h[3]>>>8,a[l+8]=this._h[4]>>>0,a[l+9]=this._h[4]>>>8,a[l+10]=this._h[5]>>>0,a[l+11]=this._h[5]>>>8,a[l+12]=this._h[6]>>>0,a[l+13]=this._h[6]>>>8,a[l+14]=this._h[7]>>>0,a[l+15]=this._h[7]>>>8,this._finished=!0,this},c.prototype.update=function(a){var l=0,d=a.length,g;if(this._leftover){g=16-this._leftover,g>d&&(g=d);for(var m=0;m<g;m++)this._buffer[this._leftover+m]=a[l+m];if(d-=g,l+=g,this._leftover+=g,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(d>=16&&(g=d-d%16,this._blocks(a,l,g),l+=g,d-=g),d){for(var m=0;m<d;m++)this._buffer[this._leftover+m]=a[l+m];this._leftover+=d}return this},c.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var a=new Uint8Array(16);return this.finish(a),a},c.prototype.clean=function(){return s.wipe(this._buffer),s.wipe(this._r),s.wipe(this._h),s.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},c}();t.Poly1305=r;function i(c,a){var l=new r(c);l.update(a);var d=l.digest();return l.clean(),d}t.oneTimeAuth=i;function n(c,a){return c.length!==t.DIGEST_LENGTH||a.length!==t.DIGEST_LENGTH?!1:e.equal(c,a)}t.equal=n})(xc);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ui,s=xc,r=At,i=oe,n=gs;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var c=new Uint8Array(16),a=function(){function l(d){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,d.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(d)}return l.prototype.seal=function(d,g,m,A){if(d.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var N=new Uint8Array(16);N.set(d,N.length-d.length);var I=new Uint8Array(32);e.stream(this._key,N,I,4);var x=g.length+this.tagLength,k;if(A){if(A.length!==x)throw new Error("ChaCha20Poly1305: incorrect destination length");k=A}else k=new Uint8Array(x);return e.streamXOR(this._key,N,g,k,4),this._authenticate(k.subarray(k.length-this.tagLength,k.length),I,k.subarray(0,k.length-this.tagLength),m),r.wipe(N),k},l.prototype.open=function(d,g,m,A){if(d.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(g.length<this.tagLength)return null;var N=new Uint8Array(16);N.set(d,N.length-d.length);var I=new Uint8Array(32);e.stream(this._key,N,I,4);var x=new Uint8Array(this.tagLength);if(this._authenticate(x,I,g.subarray(0,g.length-this.tagLength),m),!n.equal(x,g.subarray(g.length-this.tagLength,g.length)))return null;var k=g.length-this.tagLength,F;if(A){if(A.length!==k)throw new Error("ChaCha20Poly1305: incorrect destination length");F=A}else F=new Uint8Array(k);return e.streamXOR(this._key,N,g.subarray(0,g.length-this.tagLength),F,4),r.wipe(N),F},l.prototype.clean=function(){return r.wipe(this._key),this},l.prototype._authenticate=function(d,g,m,A){var N=new s.Poly1305(g);A&&(N.update(A),A.length%16>0&&N.update(c.subarray(A.length%16))),N.update(m),m.length%16>0&&N.update(c.subarray(m.length%16));var I=new Uint8Array(8);A&&i.writeUint64LE(A.length,I),N.update(I),i.writeUint64LE(m.length,I),N.update(I);for(var x=N.digest(),k=0;k<x.length;k++)d[k]=x[k];N.clean(),r.wipe(x),r.wipe(I)},l}();t.ChaCha20Poly1305=a})(yr);var Tc={},mr={},sn={};Object.defineProperty(sn,"__esModule",{value:!0});function _d(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}sn.isSerializableHash=_d;Object.defineProperty(mr,"__esModule",{value:!0});var Vt=sn,Ed=gs,Sd=At,Ac=function(){function t(e,s){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var r=new Uint8Array(this.blockSize);s.length>this.blockSize?this._inner.update(s).finish(r).clean():r.set(s);for(var i=0;i<r.length;i++)r[i]^=54;this._inner.update(r);for(var i=0;i<r.length;i++)r[i]^=106;this._outer.update(r),Vt.isSerializableHash(this._inner)&&Vt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Sd.wipe(r)}return t.prototype.reset=function(){if(!Vt.isSerializableHash(this._inner)||!Vt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){Vt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Vt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!Vt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!Vt.isSerializableHash(this._inner)||!Vt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!Vt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();mr.HMAC=Ac;function Id(t,e,s){var r=new Ac(t,e);r.update(s);var i=r.digest();return r.clean(),i}mr.hmac=Id;mr.equal=Ed.equal;Object.defineProperty(Tc,"__esModule",{value:!0});var Eo=mr,So=At,Od=function(){function t(e,s,r,i){r===void 0&&(r=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=i;var n=Eo.hmac(this._hash,r,s);this._hmac=new Eo.HMAC(e,n),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var s=new Uint8Array(e),r=0;r<s.length;r++)this._bufpos===this._buffer.length&&this._fillBuffer(),s[r]=this._buffer[this._bufpos++];return s},t.prototype.clean=function(){this._hmac.clean(),So.wipe(this._buffer),So.wipe(this._counter),this._bufpos=0},t}(),Lc=Tc.HKDF=Od,Ss={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=oe,s=At;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var r=function(){function a(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return a.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},a.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},a.prototype.clean=function(){s.wipe(this._buffer),s.wipe(this._temp),this.reset()},a.prototype.update=function(l,d){if(d===void 0&&(d=l.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var g=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&d>0;)this._buffer[this._bufferLength++]=l[g++],d--;this._bufferLength===this.blockSize&&(n(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(g=n(this._temp,this._state,l,g,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=l[g++],d--;return this},a.prototype.finish=function(l){if(!this._finished){var d=this._bytesHashed,g=this._bufferLength,m=d/536870912|0,A=d<<3,N=d%64<56?64:128;this._buffer[g]=128;for(var I=g+1;I<N-8;I++)this._buffer[I]=0;e.writeUint32BE(m,this._buffer,N-8),e.writeUint32BE(A,this._buffer,N-4),n(this._temp,this._state,this._buffer,0,N),this._finished=!0}for(var I=0;I<this.digestLength/4;I++)e.writeUint32BE(this._state[I],l,I*4);return this},a.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},a.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},a.prototype.restoreState=function(l){return this._state.set(l.state),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},a.prototype.cleanSavedState=function(l){s.wipe(l.state),l.buffer&&s.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},a}();t.SHA256=r;var i=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function n(a,l,d,g,m){for(;m>=64;){for(var A=l[0],N=l[1],I=l[2],x=l[3],k=l[4],F=l[5],S=l[6],O=l[7],y=0;y<16;y++){var v=g+y*4;a[y]=e.readUint32BE(d,v)}for(var y=16;y<64;y++){var p=a[y-2],o=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10;p=a[y-15];var u=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3;a[y]=(o+a[y-7]|0)+(u+a[y-16]|0)}for(var y=0;y<64;y++){var o=(((k>>>6|k<<26)^(k>>>11|k<<21)^(k>>>25|k<<7))+(k&F^~k&S)|0)+(O+(i[y]+a[y]|0)|0)|0,u=((A>>>2|A<<30)^(A>>>13|A<<19)^(A>>>22|A<<10))+(A&N^A&I^N&I)|0;O=S,S=F,F=k,k=x+o|0,x=I,I=N,N=A,A=o+u|0}l[0]+=A,l[1]+=N,l[2]+=I,l[3]+=x,l[4]+=k,l[5]+=F,l[6]+=S,l[7]+=O,g+=64,m-=64}return g}function c(a){var l=new r;l.update(a);var d=l.digest();return l.clean(),d}t.hash=c})(Ss);var wr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=ds,s=At;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function r(y){const v=new Float64Array(16);if(y)for(let p=0;p<y.length;p++)v[p]=y[p];return v}const i=new Uint8Array(32);i[0]=9;const n=r([56129,1]);function c(y){let v=1;for(let p=0;p<16;p++){let o=y[p]+v+65535;v=Math.floor(o/65536),y[p]=o-v*65536}y[0]+=v-1+37*(v-1)}function a(y,v,p){const o=~(p-1);for(let u=0;u<16;u++){const D=o&(y[u]^v[u]);y[u]^=D,v[u]^=D}}function l(y,v){const p=r(),o=r();for(let u=0;u<16;u++)o[u]=v[u];c(o),c(o),c(o);for(let u=0;u<2;u++){p[0]=o[0]-65517;for(let b=1;b<15;b++)p[b]=o[b]-65535-(p[b-1]>>16&1),p[b-1]&=65535;p[15]=o[15]-32767-(p[14]>>16&1);const D=p[15]>>16&1;p[14]&=65535,a(o,p,1-D)}for(let u=0;u<16;u++)y[2*u]=o[u]&255,y[2*u+1]=o[u]>>8}function d(y,v){for(let p=0;p<16;p++)y[p]=v[2*p]+(v[2*p+1]<<8);y[15]&=32767}function g(y,v,p){for(let o=0;o<16;o++)y[o]=v[o]+p[o]}function m(y,v,p){for(let o=0;o<16;o++)y[o]=v[o]-p[o]}function A(y,v,p){let o,u,D=0,b=0,T=0,U=0,z=0,w=0,_=0,V=0,$=0,q=0,M=0,j=0,B=0,te=0,W=0,se=0,Q=0,re=0,C=0,L=0,P=0,h=0,E=0,G=0,X=0,de=0,be=0,fe=0,Se=0,je=0,Ue=0,we=p[0],ye=p[1],ge=p[2],ue=p[3],le=p[4],he=p[5],ae=p[6],ie=p[7],pe=p[8],me=p[9],ne=p[10],ve=p[11],Ee=p[12],Oe=p[13],Ne=p[14],Ie=p[15];o=v[0],D+=o*we,b+=o*ye,T+=o*ge,U+=o*ue,z+=o*le,w+=o*he,_+=o*ae,V+=o*ie,$+=o*pe,q+=o*me,M+=o*ne,j+=o*ve,B+=o*Ee,te+=o*Oe,W+=o*Ne,se+=o*Ie,o=v[1],b+=o*we,T+=o*ye,U+=o*ge,z+=o*ue,w+=o*le,_+=o*he,V+=o*ae,$+=o*ie,q+=o*pe,M+=o*me,j+=o*ne,B+=o*ve,te+=o*Ee,W+=o*Oe,se+=o*Ne,Q+=o*Ie,o=v[2],T+=o*we,U+=o*ye,z+=o*ge,w+=o*ue,_+=o*le,V+=o*he,$+=o*ae,q+=o*ie,M+=o*pe,j+=o*me,B+=o*ne,te+=o*ve,W+=o*Ee,se+=o*Oe,Q+=o*Ne,re+=o*Ie,o=v[3],U+=o*we,z+=o*ye,w+=o*ge,_+=o*ue,V+=o*le,$+=o*he,q+=o*ae,M+=o*ie,j+=o*pe,B+=o*me,te+=o*ne,W+=o*ve,se+=o*Ee,Q+=o*Oe,re+=o*Ne,C+=o*Ie,o=v[4],z+=o*we,w+=o*ye,_+=o*ge,V+=o*ue,$+=o*le,q+=o*he,M+=o*ae,j+=o*ie,B+=o*pe,te+=o*me,W+=o*ne,se+=o*ve,Q+=o*Ee,re+=o*Oe,C+=o*Ne,L+=o*Ie,o=v[5],w+=o*we,_+=o*ye,V+=o*ge,$+=o*ue,q+=o*le,M+=o*he,j+=o*ae,B+=o*ie,te+=o*pe,W+=o*me,se+=o*ne,Q+=o*ve,re+=o*Ee,C+=o*Oe,L+=o*Ne,P+=o*Ie,o=v[6],_+=o*we,V+=o*ye,$+=o*ge,q+=o*ue,M+=o*le,j+=o*he,B+=o*ae,te+=o*ie,W+=o*pe,se+=o*me,Q+=o*ne,re+=o*ve,C+=o*Ee,L+=o*Oe,P+=o*Ne,h+=o*Ie,o=v[7],V+=o*we,$+=o*ye,q+=o*ge,M+=o*ue,j+=o*le,B+=o*he,te+=o*ae,W+=o*ie,se+=o*pe,Q+=o*me,re+=o*ne,C+=o*ve,L+=o*Ee,P+=o*Oe,h+=o*Ne,E+=o*Ie,o=v[8],$+=o*we,q+=o*ye,M+=o*ge,j+=o*ue,B+=o*le,te+=o*he,W+=o*ae,se+=o*ie,Q+=o*pe,re+=o*me,C+=o*ne,L+=o*ve,P+=o*Ee,h+=o*Oe,E+=o*Ne,G+=o*Ie,o=v[9],q+=o*we,M+=o*ye,j+=o*ge,B+=o*ue,te+=o*le,W+=o*he,se+=o*ae,Q+=o*ie,re+=o*pe,C+=o*me,L+=o*ne,P+=o*ve,h+=o*Ee,E+=o*Oe,G+=o*Ne,X+=o*Ie,o=v[10],M+=o*we,j+=o*ye,B+=o*ge,te+=o*ue,W+=o*le,se+=o*he,Q+=o*ae,re+=o*ie,C+=o*pe,L+=o*me,P+=o*ne,h+=o*ve,E+=o*Ee,G+=o*Oe,X+=o*Ne,de+=o*Ie,o=v[11],j+=o*we,B+=o*ye,te+=o*ge,W+=o*ue,se+=o*le,Q+=o*he,re+=o*ae,C+=o*ie,L+=o*pe,P+=o*me,h+=o*ne,E+=o*ve,G+=o*Ee,X+=o*Oe,de+=o*Ne,be+=o*Ie,o=v[12],B+=o*we,te+=o*ye,W+=o*ge,se+=o*ue,Q+=o*le,re+=o*he,C+=o*ae,L+=o*ie,P+=o*pe,h+=o*me,E+=o*ne,G+=o*ve,X+=o*Ee,de+=o*Oe,be+=o*Ne,fe+=o*Ie,o=v[13],te+=o*we,W+=o*ye,se+=o*ge,Q+=o*ue,re+=o*le,C+=o*he,L+=o*ae,P+=o*ie,h+=o*pe,E+=o*me,G+=o*ne,X+=o*ve,de+=o*Ee,be+=o*Oe,fe+=o*Ne,Se+=o*Ie,o=v[14],W+=o*we,se+=o*ye,Q+=o*ge,re+=o*ue,C+=o*le,L+=o*he,P+=o*ae,h+=o*ie,E+=o*pe,G+=o*me,X+=o*ne,de+=o*ve,be+=o*Ee,fe+=o*Oe,Se+=o*Ne,je+=o*Ie,o=v[15],se+=o*we,Q+=o*ye,re+=o*ge,C+=o*ue,L+=o*le,P+=o*he,h+=o*ae,E+=o*ie,G+=o*pe,X+=o*me,de+=o*ne,be+=o*ve,fe+=o*Ee,Se+=o*Oe,je+=o*Ne,Ue+=o*Ie,D+=38*Q,b+=38*re,T+=38*C,U+=38*L,z+=38*P,w+=38*h,_+=38*E,V+=38*G,$+=38*X,q+=38*de,M+=38*be,j+=38*fe,B+=38*Se,te+=38*je,W+=38*Ue,u=1,o=D+u+65535,u=Math.floor(o/65536),D=o-u*65536,o=b+u+65535,u=Math.floor(o/65536),b=o-u*65536,o=T+u+65535,u=Math.floor(o/65536),T=o-u*65536,o=U+u+65535,u=Math.floor(o/65536),U=o-u*65536,o=z+u+65535,u=Math.floor(o/65536),z=o-u*65536,o=w+u+65535,u=Math.floor(o/65536),w=o-u*65536,o=_+u+65535,u=Math.floor(o/65536),_=o-u*65536,o=V+u+65535,u=Math.floor(o/65536),V=o-u*65536,o=$+u+65535,u=Math.floor(o/65536),$=o-u*65536,o=q+u+65535,u=Math.floor(o/65536),q=o-u*65536,o=M+u+65535,u=Math.floor(o/65536),M=o-u*65536,o=j+u+65535,u=Math.floor(o/65536),j=o-u*65536,o=B+u+65535,u=Math.floor(o/65536),B=o-u*65536,o=te+u+65535,u=Math.floor(o/65536),te=o-u*65536,o=W+u+65535,u=Math.floor(o/65536),W=o-u*65536,o=se+u+65535,u=Math.floor(o/65536),se=o-u*65536,D+=u-1+37*(u-1),u=1,o=D+u+65535,u=Math.floor(o/65536),D=o-u*65536,o=b+u+65535,u=Math.floor(o/65536),b=o-u*65536,o=T+u+65535,u=Math.floor(o/65536),T=o-u*65536,o=U+u+65535,u=Math.floor(o/65536),U=o-u*65536,o=z+u+65535,u=Math.floor(o/65536),z=o-u*65536,o=w+u+65535,u=Math.floor(o/65536),w=o-u*65536,o=_+u+65535,u=Math.floor(o/65536),_=o-u*65536,o=V+u+65535,u=Math.floor(o/65536),V=o-u*65536,o=$+u+65535,u=Math.floor(o/65536),$=o-u*65536,o=q+u+65535,u=Math.floor(o/65536),q=o-u*65536,o=M+u+65535,u=Math.floor(o/65536),M=o-u*65536,o=j+u+65535,u=Math.floor(o/65536),j=o-u*65536,o=B+u+65535,u=Math.floor(o/65536),B=o-u*65536,o=te+u+65535,u=Math.floor(o/65536),te=o-u*65536,o=W+u+65535,u=Math.floor(o/65536),W=o-u*65536,o=se+u+65535,u=Math.floor(o/65536),se=o-u*65536,D+=u-1+37*(u-1),y[0]=D,y[1]=b,y[2]=T,y[3]=U,y[4]=z,y[5]=w,y[6]=_,y[7]=V,y[8]=$,y[9]=q,y[10]=M,y[11]=j,y[12]=B,y[13]=te,y[14]=W,y[15]=se}function N(y,v){A(y,v,v)}function I(y,v){const p=r();for(let o=0;o<16;o++)p[o]=v[o];for(let o=253;o>=0;o--)N(p,p),o!==2&&o!==4&&A(p,p,v);for(let o=0;o<16;o++)y[o]=p[o]}function x(y,v){const p=new Uint8Array(32),o=new Float64Array(80),u=r(),D=r(),b=r(),T=r(),U=r(),z=r();for(let $=0;$<31;$++)p[$]=y[$];p[31]=y[31]&127|64,p[0]&=248,d(o,v);for(let $=0;$<16;$++)D[$]=o[$];u[0]=T[0]=1;for(let $=254;$>=0;--$){const q=p[$>>>3]>>>($&7)&1;a(u,D,q),a(b,T,q),g(U,u,b),m(u,u,b),g(b,D,T),m(D,D,T),N(T,U),N(z,u),A(u,b,u),A(b,D,U),g(U,u,b),m(u,u,b),N(D,u),m(b,T,z),A(u,b,n),g(u,u,T),A(b,b,u),A(u,T,z),A(T,D,o),N(D,U),a(u,D,q),a(b,T,q)}for(let $=0;$<16;$++)o[$+16]=u[$],o[$+32]=b[$],o[$+48]=D[$],o[$+64]=T[$];const w=o.subarray(32),_=o.subarray(16);I(w,w),A(_,_,w);const V=new Uint8Array(32);return l(V,_),V}t.scalarMult=x;function k(y){return x(y,i)}t.scalarMultBase=k;function F(y){if(y.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const v=new Uint8Array(y);return{publicKey:k(v),secretKey:v}}t.generateKeyPairFromSeed=F;function S(y){const v=(0,e.randomBytes)(32,y),p=F(v);return(0,s.wipe)(v),p}t.generateKeyPair=S;function O(y,v,p=!1){if(y.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(v.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const o=x(y,v);if(p){let u=0;for(let D=0;D<o.length;D++)u|=o[D];if(u===0)throw new Error("X25519: invalid shared key")}return o}t.sharedKey=O})(wr);var Io=globalThis&&globalThis.__spreadArray||function(t,e,s){if(s||arguments.length===2)for(var r=0,i=e.length,n;r<i;r++)(n||!(r in e))&&(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Nd=function(){function t(e,s,r){this.name=e,this.version=s,this.os=r,this.type="browser"}return t}(),Pd=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=Rt.platform}return t}(),xd=function(){function t(e,s,r,i){this.name=e,this.version=s,this.os=r,this.bot=i,this.type="bot-device"}return t}(),Rd=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Td=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Ad=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Ld=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Oo=3,Cd=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Ad]],No=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function rn(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Td:typeof navigator<"u"?Md(navigator.userAgent):Dd()}function Ud(t){return t!==""&&Cd.reduce(function(e,s){var r=s[0],i=s[1];if(e)return e;var n=i.exec(t);return!!n&&[r,n]},!1)}function Md(t){var e=Ud(t);if(!e)return null;var s=e[0],r=e[1];if(s==="searchbot")return new Rd;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<Oo&&(i=Io(Io([],i,!0),jd(Oo-i.length),!0)):i=[];var n=i.join("."),c=kd(t),a=Ld.exec(t);return a&&a[1]?new xd(s,n,c,a[1]):new Nd(s,n,c)}function kd(t){for(var e=0,s=No.length;e<s;e++){var r=No[e],i=r[0],n=r[1],c=n.exec(t);if(c)return i}return null}function Dd(){var t=typeof Rt<"u"&&Rt.version;return t?new Pd(Rt.version.slice(1)):null}function jd(t){for(var e=[],s=0;s<t;s++)e.push("0");return e}var Re={};Object.defineProperty(Re,"__esModule",{value:!0});Re.getLocalStorage=Re.getLocalStorageOrThrow=Re.getCrypto=Re.getCryptoOrThrow=on=Re.getLocation=Re.getLocationOrThrow=br=Re.getNavigator=Re.getNavigatorOrThrow=nn=Re.getDocument=Re.getDocumentOrThrow=Re.getFromWindowOrThrow=Re.getFromWindow=void 0;function Is(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Re.getFromWindow=Is;function zs(t){const e=Is(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Re.getFromWindowOrThrow=zs;function zd(){return zs("document")}Re.getDocumentOrThrow=zd;function qd(){return Is("document")}var nn=Re.getDocument=qd;function $d(){return zs("navigator")}Re.getNavigatorOrThrow=$d;function Vd(){return Is("navigator")}var br=Re.getNavigator=Vd;function Kd(){return zs("location")}Re.getLocationOrThrow=Kd;function Hd(){return Is("location")}var on=Re.getLocation=Hd;function Fd(){return zs("crypto")}Re.getCryptoOrThrow=Fd;function Bd(){return Is("crypto")}Re.getCrypto=Bd;function Wd(){return zs("localStorage")}Re.getLocalStorageOrThrow=Wd;function Gd(){return Is("localStorage")}Re.getLocalStorage=Gd;var an={};Object.defineProperty(an,"__esModule",{value:!0});var cn=an.getWindowMetadata=void 0;const Po=Re;function Yd(){let t,e;try{t=Po.getDocumentOrThrow(),e=Po.getLocationOrThrow()}catch{return null}function s(){const g=t.getElementsByTagName("link"),m=[];for(let A=0;A<g.length;A++){const N=g[A],I=N.getAttribute("rel");if(I&&I.toLowerCase().indexOf("icon")>-1){const x=N.getAttribute("href");if(x)if(x.toLowerCase().indexOf("https:")===-1&&x.toLowerCase().indexOf("http:")===-1&&x.indexOf("//")!==0){let k=e.protocol+"//"+e.host;if(x.indexOf("/")===0)k+=x;else{const F=e.pathname.split("/");F.pop();const S=F.join("/");k+=S+"/"+x}m.push(k)}else if(x.indexOf("//")===0){const k=e.protocol+x;m.push(k)}else m.push(x)}}return m}function r(...g){const m=t.getElementsByTagName("meta");for(let A=0;A<m.length;A++){const N=m[A],I=["itemprop","property","name"].map(x=>N.getAttribute(x)).filter(x=>x?g.includes(x):!1);if(I.length&&I){const x=N.getAttribute("content");if(x)return x}}return""}function i(){let g=r("name","og:site_name","og:title","twitter:title");return g||(g=t.title),g}function n(){return r("description","og:description","twitter:description","keywords")}const c=i(),a=n(),l=e.origin,d=s();return{description:a,url:l,icons:d,name:c}}cn=an.getWindowMetadata=Yd;var is={},Jd=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Cc="%[a-f0-9]{2}",xo=new RegExp("("+Cc+")|([^%]+?)","gi"),Ro=new RegExp("("+Cc+")+","gi");function ji(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var s=t.slice(0,e),r=t.slice(e);return Array.prototype.concat.call([],ji(s),ji(r))}function Qd(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(xo)||[],s=1;s<e.length;s++)t=ji(e,s).join(""),e=t.match(xo)||[];return t}}function Xd(t){for(var e={"%FE%FF":"","%FF%FE":""},s=Ro.exec(t);s;){try{e[s[0]]=decodeURIComponent(s[0])}catch{var r=Qd(s[0]);r!==s[0]&&(e[s[0]]=r)}s=Ro.exec(t)}e["%C2"]="";for(var i=Object.keys(e),n=0;n<i.length;n++){var c=i[n];t=t.replace(new RegExp(c,"g"),e[c])}return t}var Zd=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Xd(t)}},eg=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const s=t.indexOf(e);return s===-1?[t]:[t.slice(0,s),t.slice(s+e.length)]},tg=function(t,e){for(var s={},r=Object.keys(t),i=Array.isArray(e),n=0;n<r.length;n++){var c=r[n],a=t[c];(i?e.indexOf(c)!==-1:e(c,a,t))&&(s[c]=a)}return s};(function(t){const e=Jd,s=Zd,r=eg,i=tg,n=S=>S==null,c=Symbol("encodeFragmentIdentifier");function a(S){switch(S.arrayFormat){case"index":return O=>(y,v)=>{const p=y.length;return v===void 0||S.skipNull&&v===null||S.skipEmptyString&&v===""?y:v===null?[...y,[g(O,S),"[",p,"]"].join("")]:[...y,[g(O,S),"[",g(p,S),"]=",g(v,S)].join("")]};case"bracket":return O=>(y,v)=>v===void 0||S.skipNull&&v===null||S.skipEmptyString&&v===""?y:v===null?[...y,[g(O,S),"[]"].join("")]:[...y,[g(O,S),"[]=",g(v,S)].join("")];case"colon-list-separator":return O=>(y,v)=>v===void 0||S.skipNull&&v===null||S.skipEmptyString&&v===""?y:v===null?[...y,[g(O,S),":list="].join("")]:[...y,[g(O,S),":list=",g(v,S)].join("")];case"comma":case"separator":case"bracket-separator":{const O=S.arrayFormat==="bracket-separator"?"[]=":"=";return y=>(v,p)=>p===void 0||S.skipNull&&p===null||S.skipEmptyString&&p===""?v:(p=p===null?"":p,v.length===0?[[g(y,S),O,g(p,S)].join("")]:[[v,g(p,S)].join(S.arrayFormatSeparator)])}default:return O=>(y,v)=>v===void 0||S.skipNull&&v===null||S.skipEmptyString&&v===""?y:v===null?[...y,g(O,S)]:[...y,[g(O,S),"=",g(v,S)].join("")]}}function l(S){let O;switch(S.arrayFormat){case"index":return(y,v,p)=>{if(O=/\[(\d*)\]$/.exec(y),y=y.replace(/\[\d*\]$/,""),!O){p[y]=v;return}p[y]===void 0&&(p[y]={}),p[y][O[1]]=v};case"bracket":return(y,v,p)=>{if(O=/(\[\])$/.exec(y),y=y.replace(/\[\]$/,""),!O){p[y]=v;return}if(p[y]===void 0){p[y]=[v];return}p[y]=[].concat(p[y],v)};case"colon-list-separator":return(y,v,p)=>{if(O=/(:list)$/.exec(y),y=y.replace(/:list$/,""),!O){p[y]=v;return}if(p[y]===void 0){p[y]=[v];return}p[y]=[].concat(p[y],v)};case"comma":case"separator":return(y,v,p)=>{const o=typeof v=="string"&&v.includes(S.arrayFormatSeparator),u=typeof v=="string"&&!o&&m(v,S).includes(S.arrayFormatSeparator);v=u?m(v,S):v;const D=o||u?v.split(S.arrayFormatSeparator).map(b=>m(b,S)):v===null?v:m(v,S);p[y]=D};case"bracket-separator":return(y,v,p)=>{const o=/(\[\])$/.test(y);if(y=y.replace(/\[\]$/,""),!o){p[y]=v&&m(v,S);return}const u=v===null?[]:v.split(S.arrayFormatSeparator).map(D=>m(D,S));if(p[y]===void 0){p[y]=u;return}p[y]=[].concat(p[y],u)};default:return(y,v,p)=>{if(p[y]===void 0){p[y]=v;return}p[y]=[].concat(p[y],v)}}}function d(S){if(typeof S!="string"||S.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function g(S,O){return O.encode?O.strict?e(S):encodeURIComponent(S):S}function m(S,O){return O.decode?s(S):S}function A(S){return Array.isArray(S)?S.sort():typeof S=="object"?A(Object.keys(S)).sort((O,y)=>Number(O)-Number(y)).map(O=>S[O]):S}function N(S){const O=S.indexOf("#");return O!==-1&&(S=S.slice(0,O)),S}function I(S){let O="";const y=S.indexOf("#");return y!==-1&&(O=S.slice(y)),O}function x(S){S=N(S);const O=S.indexOf("?");return O===-1?"":S.slice(O+1)}function k(S,O){return O.parseNumbers&&!Number.isNaN(Number(S))&&typeof S=="string"&&S.trim()!==""?S=Number(S):O.parseBooleans&&S!==null&&(S.toLowerCase()==="true"||S.toLowerCase()==="false")&&(S=S.toLowerCase()==="true"),S}function F(S,O){O=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},O),d(O.arrayFormatSeparator);const y=l(O),v=Object.create(null);if(typeof S!="string"||(S=S.trim().replace(/^[?#&]/,""),!S))return v;for(const p of S.split("&")){if(p==="")continue;let[o,u]=r(O.decode?p.replace(/\+/g," "):p,"=");u=u===void 0?null:["comma","separator","bracket-separator"].includes(O.arrayFormat)?u:m(u,O),y(m(o,O),u,v)}for(const p of Object.keys(v)){const o=v[p];if(typeof o=="object"&&o!==null)for(const u of Object.keys(o))o[u]=k(o[u],O);else v[p]=k(o,O)}return O.sort===!1?v:(O.sort===!0?Object.keys(v).sort():Object.keys(v).sort(O.sort)).reduce((p,o)=>{const u=v[o];return u&&typeof u=="object"&&!Array.isArray(u)?p[o]=A(u):p[o]=u,p},Object.create(null))}t.extract=x,t.parse=F,t.stringify=(S,O)=>{if(!S)return"";O=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},O),d(O.arrayFormatSeparator);const y=u=>O.skipNull&&n(S[u])||O.skipEmptyString&&S[u]==="",v=a(O),p={};for(const u of Object.keys(S))y(u)||(p[u]=S[u]);const o=Object.keys(p);return O.sort!==!1&&o.sort(O.sort),o.map(u=>{const D=S[u];return D===void 0?"":D===null?g(u,O):Array.isArray(D)?D.length===0&&O.arrayFormat==="bracket-separator"?g(u,O)+"[]":D.reduce(v(u),[]).join("&"):g(u,O)+"="+g(D,O)}).filter(u=>u.length>0).join("&")},t.parseUrl=(S,O)=>{O=Object.assign({decode:!0},O);const[y,v]=r(S,"#");return Object.assign({url:y.split("?")[0]||"",query:F(x(S),O)},O&&O.parseFragmentIdentifier&&v?{fragmentIdentifier:m(v,O)}:{})},t.stringifyUrl=(S,O)=>{O=Object.assign({encode:!0,strict:!0,[c]:!0},O);const y=N(S.url).split("?")[0]||"",v=t.extract(S.url),p=t.parse(v,{sort:!1}),o=Object.assign(p,S.query);let u=t.stringify(o,O);u&&(u=`?${u}`);let D=I(S.url);return S.fragmentIdentifier&&(D=`#${O[c]?g(S.fragmentIdentifier,O):S.fragmentIdentifier}`),`${y}${u}${D}`},t.pick=(S,O,y)=>{y=Object.assign({parseFragmentIdentifier:!0,[c]:!1},y);const{url:v,query:p,fragmentIdentifier:o}=t.parseUrl(S,y);return t.stringifyUrl({url:v,query:i(p,O),fragmentIdentifier:o},y)},t.exclude=(S,O,y)=>{const v=Array.isArray(O)?p=>!O.includes(p):(p,o)=>!O(p,o);return t.pick(S,v,y)}})(is);const Uc={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function Mc(t,e){return t.includes(":")?[t]:e.chains||[]}const kc="base10",bt="base16",zi="base64pad",hn="utf8",Dc=0,Os=1,sg=0,To=1,qi=12,ln=32;function rg(){const t=wr.generateKeyPair();return{privateKey:xe(t.secretKey,bt),publicKey:xe(t.publicKey,bt)}}function $i(){const t=ds.randomBytes(ln);return xe(t,bt)}function ig(t,e){const s=wr.sharedKey(Ae(t,bt),Ae(e,bt),!0),r=new Lc(Ss.SHA256,s).expand(ln);return xe(r,bt)}function ng(t){const e=Ss.hash(Ae(t,bt));return xe(e,bt)}function Ds(t){const e=Ss.hash(Ae(t,hn));return xe(e,bt)}function og(t){return Ae(`${t}`,kc)}function vr(t){return Number(xe(t,kc))}function ag(t){const e=og(typeof t.type<"u"?t.type:Dc);if(vr(e)===Os&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const s=typeof t.senderPublicKey<"u"?Ae(t.senderPublicKey,bt):void 0,r=typeof t.iv<"u"?Ae(t.iv,bt):ds.randomBytes(qi),i=new yr.ChaCha20Poly1305(Ae(t.symKey,bt)).seal(r,Ae(t.message,hn));return hg({type:e,sealed:i,iv:r,senderPublicKey:s})}function cg(t){const e=new yr.ChaCha20Poly1305(Ae(t.symKey,bt)),{sealed:s,iv:r}=Qr(t.encoded),i=e.open(r,s);if(i===null)throw new Error("Failed to decrypt");return xe(i,hn)}function hg(t){if(vr(t.type)===Os){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return xe(pr([t.type,t.senderPublicKey,t.iv,t.sealed]),zi)}return xe(pr([t.type,t.iv,t.sealed]),zi)}function Qr(t){const e=Ae(t,zi),s=e.slice(sg,To),r=To;if(vr(s)===Os){const a=r+ln,l=a+qi,d=e.slice(r,a),g=e.slice(a,l),m=e.slice(l);return{type:s,sealed:m,iv:g,senderPublicKey:d}}const i=r+qi,n=e.slice(r,i),c=e.slice(i);return{type:s,sealed:c,iv:n}}function lg(t,e){const s=Qr(t);return jc({type:vr(s.type),senderPublicKey:typeof s.senderPublicKey<"u"?xe(s.senderPublicKey,bt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function jc(t){const e=(t==null?void 0:t.type)||Dc;if(e===Os){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Ao(t){return t.type===Os&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var ug=Object.defineProperty,Lo=Object.getOwnPropertySymbols,pg=Object.prototype.hasOwnProperty,dg=Object.prototype.propertyIsEnumerable,Co=(t,e,s)=>e in t?ug(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Uo=(t,e)=>{for(var s in e||(e={}))pg.call(e,s)&&Co(t,s,e[s]);if(Lo)for(var s of Lo(e))dg.call(e,s)&&Co(t,s,e[s]);return t};const gg="ReactNative",xt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},fg="js";function un(){return typeof Rt<"u"&&typeof Rt.versions<"u"&&typeof Rt.versions.node<"u"}function pi(){return!nn()&&!!br()&&navigator.product===gg}function _r(){return!un()&&!!br()}function Er(){return pi()?xt.reactNative:un()?xt.node:_r()?xt.browser:xt.unknown}function yg(t,e){let s=is.parse(t);return s=Uo(Uo({},s),e),t=is.stringify(s),t}function mg(){return cn()||{name:"",description:"",url:"",icons:[""]}}function wg(){if(Er()===xt.reactNative&&typeof ze<"u"&&typeof(ze==null?void 0:ze.Platform)<"u"){const{OS:s,Version:r}=ze.Platform;return[s,r].join("-")}const t=rn();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function bg(){var t;const e=Er();return e===xt.browser?[e,((t=on())==null?void 0:t.host)||"unknown"].join(":"):e}function vg(t,e,s){const r=wg(),i=bg();return[[t,e].join("-"),[fg,s].join("-"),r,i].join("/")}function _g({protocol:t,version:e,relayUrl:s,sdkVersion:r,auth:i,projectId:n,useOnCloseEvent:c}){const a=s.split("?"),l=vg(t,e,r),d={auth:i,ua:l,projectId:n,useOnCloseEvent:c||void 0},g=yg(a[1]||"",d);return a[0]+"?"+g}function _s(t,e){return t.filter(s=>e.includes(s)).length===t.length}function zc(t){return Object.fromEntries(t.entries())}function qc(t){return new Map(Object.entries(t))}function Us(t=K.FIVE_MINUTES,e){const s=K.toMiliseconds(t||K.FIVE_MINUTES);let r,i,n;return{resolve:c=>{n&&r&&(clearTimeout(n),r(c))},reject:c=>{n&&i&&(clearTimeout(n),i(c))},done:()=>new Promise((c,a)=>{n=setTimeout(()=>{a(new Error(e))},s),r=c,i=a})}}function dr(t,e,s){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(new Error(s)),e);try{const c=await t;r(c)}catch(c){i(c)}clearTimeout(n)})}function $c(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Eg(t){return $c("topic",t)}function Sg(t){return $c("id",t)}function Vc(t){const[e,s]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")r.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))r.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return r}function qt(t,e){return K.fromMiliseconds(Date.now()+K.toMiliseconds(t))}function hs(t){return Date.now()>=K.toMiliseconds(t)}function Fe(t,e){return`${t}${e?`:${e}`:""}`}async function Ig({id:t,topic:e,wcDeepLink:s}){var r;try{if(!s)return;let i=(r=typeof s=="string"?JSON.parse(s):s)==null?void 0:r.href;if(typeof i!="string")return;i.endsWith("/")&&(i=i.slice(0,-1));const n=`${i}/wc?requestId=${t}&sessionTopic=${e}`,c=Er();c===xt.browser?n.startsWith("https://")?window.open(n,"_blank","noreferrer noopener"):window.open(n,"_self","noreferrer noopener"):c===xt.reactNative&&typeof(ze==null?void 0:ze.Linking)<"u"&&await ze.Linking.openURL(n)}catch(i){console.error(i)}}const Og="irn";function Vi(t){return(t==null?void 0:t.relay)||{protocol:Og}}function Vr(t){const e=Uc[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Ng=Object.defineProperty,Mo=Object.getOwnPropertySymbols,Pg=Object.prototype.hasOwnProperty,xg=Object.prototype.propertyIsEnumerable,ko=(t,e,s)=>e in t?Ng(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Rg=(t,e)=>{for(var s in e||(e={}))Pg.call(e,s)&&ko(t,s,e[s]);if(Mo)for(var s of Mo(e))xg.call(e,s)&&ko(t,s,e[s]);return t};function Tg(t,e="-"){const s={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){const n=i.replace(r,""),c=t[i];s[n]=c}}),s}function Ag(t){const e=t.indexOf(":"),s=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,s).split("@"),n=typeof s<"u"?t.substring(s):"",c=is.parse(n);return{protocol:r,topic:Lg(i[0]),version:parseInt(i[1],10),symKey:c.symKey,relay:Tg(c)}}function Lg(t){return t.startsWith("//")?t.substring(2):t}function Cg(t,e="-"){const s="relay",r={};return Object.keys(t).forEach(i=>{const n=s+e+i;t[i]&&(r[n]=t[i])}),r}function Ug(t){return`${t.protocol}:${t.topic}@${t.version}?`+is.stringify(Rg({symKey:t.symKey},Cg(t.relay)))}function qs(t){const e=[];return t.forEach(s=>{const[r,i]=s.split(":");e.push(`${r}:${i}`)}),e}function Mg(t){const e=[];return Object.values(t).forEach(s=>{e.push(...qs(s.accounts))}),e}function kg(t,e){const s=[];return Object.values(t).forEach(r=>{qs(r.accounts).includes(e)&&s.push(...r.methods)}),s}function Dg(t,e){const s=[];return Object.values(t).forEach(r=>{qs(r.accounts).includes(e)&&s.push(...r.events)}),s}function jg(t,e){const s=Kr(t,e);if(s)throw new Error(s.message);const r={};for(const[i,n]of Object.entries(t))r[i]={methods:n.methods,events:n.events,chains:n.accounts.map(c=>`${c.split(":")[0]}:${c.split(":")[1]}`)};return r}const zg={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},qg={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Y(t,e){const{message:s,code:r}=qg[t];return{message:e?`${s} ${e}`:s,code:r}}function ot(t,e){const{message:s,code:r}=zg[t];return{message:e?`${s} ${e}`:s,code:r}}function Sr(t,e){return!!Array.isArray(t)}function hr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function It(t){return typeof t>"u"}function at(t,e){return e&&It(t)?!0:typeof t=="string"&&!!t.trim().length}function pn(t,e){return typeof t=="number"&&!isNaN(t)}function $g(t,e){const{requiredNamespaces:s}=e,r=Object.keys(t.namespaces),i=Object.keys(s);let n=!0;return _s(i,r)?(r.forEach(c=>{const{accounts:a,methods:l,events:d}=t.namespaces[c],g=qs(a),m=s[c];(!_s(Mc(c,m),g)||!_s(m.methods,l)||!_s(m.events,d))&&(n=!1)}),n):!1}function Xr(t){return at(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Vg(t){if(at(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const s=e[0]+":"+e[1];return!!e[2]&&Xr(s)}}return!1}function Kg(t){if(at(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Hg(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Fg(t){return t==null?void 0:t.topic}function Bg(t,e){let s=null;return at(t==null?void 0:t.publicKey,!1)||(s=Y("MISSING_OR_INVALID",`${e} controller public key should be a string`)),s}function Do(t){let e=!0;return Sr(t)?t.length&&(e=t.every(s=>at(s,!1))):e=!1,e}function Wg(t,e,s){let r=null;return Sr(e)&&e.length?e.forEach(i=>{r||Xr(i)||(r=ot("UNSUPPORTED_CHAINS",`${s}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):Xr(t)||(r=ot("UNSUPPORTED_CHAINS",`${s}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function Gg(t,e,s){let r=null;return Object.entries(t).forEach(([i,n])=>{if(r)return;const c=Wg(i,Mc(i,n),`${e} ${s}`);c&&(r=c)}),r}function Yg(t,e){let s=null;return Sr(t)?t.forEach(r=>{s||Vg(r)||(s=ot("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):s=ot("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s}function Jg(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;const i=Yg(r==null?void 0:r.accounts,`${e} namespace`);i&&(s=i)}),s}function Qg(t,e){let s=null;return Do(t==null?void 0:t.methods)?Do(t==null?void 0:t.events)||(s=ot("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):s=ot("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),s}function Kc(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;const i=Qg(r,`${e}, namespace`);i&&(s=i)}),s}function Xg(t,e,s){let r=null;if(t&&hr(t)){const i=Kc(t,e);i&&(r=i);const n=Gg(t,e,s);n&&(r=n)}else r=Y("MISSING_OR_INVALID",`${e}, ${s} should be an object with data`);return r}function Kr(t,e){let s=null;if(t&&hr(t)){const r=Kc(t,e);r&&(s=r);const i=Jg(t,e);i&&(s=i)}else s=Y("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return s}function Hc(t){return at(t.protocol,!0)}function Zg(t,e){let s=!1;return t?t&&Sr(t)&&t.length&&t.forEach(r=>{s=Hc(r)}):s=!0,s}function ef(t){return typeof t=="number"}function Et(t){return typeof t<"u"&&typeof t!==null}function tf(t){return!(!t||typeof t!="object"||!t.code||!pn(t.code)||!t.message||!at(t.message,!1))}function sf(t){return!(It(t)||!at(t.method,!1))}function rf(t){return!(It(t)||It(t.result)&&It(t.error)||!pn(t.id)||!at(t.jsonrpc,!1))}function nf(t){return!(It(t)||!at(t.name,!1))}function jo(t,e){return!(!Xr(e)||!Mg(t).includes(e))}function of(t,e,s){return at(s,!1)?kg(t,e).includes(s):!1}function af(t,e,s){return at(s,!1)?Dg(t,e).includes(s):!1}function zo(t,e,s){let r=null;const i=cf(t),n=hf(e),c=Object.keys(i),a=Object.keys(n),l=qo(Object.keys(t)),d=qo(Object.keys(e)),g=l.filter(m=>!d.includes(m));return g.length&&(r=Y("NON_CONFORMING_NAMESPACES",`${s} namespaces keys don't satisfy requiredNamespaces.
      Required: ${g.toString()}
      Received: ${Object.keys(e).toString()}`)),_s(c,a)||(r=Y("NON_CONFORMING_NAMESPACES",`${s} namespaces chains don't satisfy required namespaces.
      Required: ${c.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(m=>{if(!m.includes(":")||r)return;const A=qs(e[m].accounts);A.includes(m)||(r=Y("NON_CONFORMING_NAMESPACES",`${s} namespaces accounts don't satisfy namespace accounts for ${m}
        Required: ${m}
        Approved: ${A.toString()}`))}),c.forEach(m=>{r||(_s(i[m].methods,n[m].methods)?_s(i[m].events,n[m].events)||(r=Y("NON_CONFORMING_NAMESPACES",`${s} namespaces events don't satisfy namespace events for ${m}`)):r=Y("NON_CONFORMING_NAMESPACES",`${s} namespaces methods don't satisfy namespace methods for ${m}`))}),r}function cf(t){const e={};return Object.keys(t).forEach(s=>{var r;s.includes(":")?e[s]=t[s]:(r=t[s].chains)==null||r.forEach(i=>{e[i]={methods:t[s].methods,events:t[s].events}})}),e}function qo(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function hf(t){const e={};return Object.keys(t).forEach(s=>{var r;s.includes(":")?e[s]=t[s]:(r=qs(t[s].accounts))==null||r.forEach(i=>{e[i]={accounts:t[s].accounts.filter(n=>n.includes(`${i}:`)),methods:t[s].methods,events:t[s].events}})}),e}function lf(t,e){return pn(t)&&t<=e.max&&t>=e.min}function $o(){const t=Er();return new Promise(e=>{switch(t){case xt.browser:e(uf());break;case xt.reactNative:e(pf());break;case xt.node:e(df());break;default:e(!0)}})}function uf(){return _r()&&(navigator==null?void 0:navigator.onLine)}async function pf(){var t;return pi()&&typeof ze<"u"&&ze!=null&&ze.NetInfo?(t=await(ze==null?void 0:ze.NetInfo.fetch()))==null?void 0:t.isConnected:!0}function df(){return!0}function gf(t){switch(Er()){case xt.browser:ff(t);break;case xt.reactNative:yf(t);break}}function ff(t){_r()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function yf(t){var e;pi()&&typeof ze<"u"&&ze!=null&&ze.NetInfo&&((e=ze)==null||e.NetInfo.addEventListener(s=>t(s==null?void 0:s.isConnected)))}const _i={};let kr=class{static get(t){return _i[t]}static set(t,e){_i[t]=e}static delete(t){delete _i[t]}};const mf="PARSE_ERROR",wf="INVALID_REQUEST",bf="METHOD_NOT_FOUND",vf="INVALID_PARAMS",Fc="INTERNAL_ERROR",dn="SERVER_ERROR",_f=[-32700,-32600,-32601,-32602,-32603],lr={[mf]:{code:-32700,message:"Parse error"},[wf]:{code:-32600,message:"Invalid Request"},[bf]:{code:-32601,message:"Method not found"},[vf]:{code:-32602,message:"Invalid params"},[Fc]:{code:-32603,message:"Internal error"},[dn]:{code:-32e3,message:"Server error"}},Bc=dn;function Ef(t){return _f.includes(t)}function Vo(t){return Object.keys(lr).includes(t)?lr[t]:lr[Bc]}function Sf(t){return Object.values(lr).find(s=>s.code===t)||lr[Bc]}function If(t,e,s){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${s} RPC url at ${e}`):t}var Wc={},Zt={},Ko;function Of(){if(Ko)return Zt;Ko=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.isBrowserCryptoAvailable=Zt.getSubtleCrypto=Zt.getBrowerCrypto=void 0;function t(){return(wt===null||wt===void 0?void 0:wt.crypto)||(wt===null||wt===void 0?void 0:wt.msCrypto)||{}}Zt.getBrowerCrypto=t;function e(){const r=t();return r.subtle||r.webkitSubtle}Zt.getSubtleCrypto=e;function s(){return!!t()&&!!e()}return Zt.isBrowserCryptoAvailable=s,Zt}var es={},Ho;function Nf(){if(Ho)return es;Ho=1,Object.defineProperty(es,"__esModule",{value:!0}),es.isBrowser=es.isNode=es.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}es.isReactNative=t;function e(){return typeof Rt<"u"&&typeof Rt.versions<"u"&&typeof Rt.versions.node<"u"}es.isNode=e;function s(){return!t()&&!e()}return es.isBrowser=s,es}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(Of(),t),e.__exportStar(Nf(),t)})(Wc);function gn(t=3){const e=Date.now()*Math.pow(10,t),s=Math.floor(Math.random()*Math.pow(10,t));return e+s}function fn(t=6){return BigInt(gn(t))}function rs(t,e,s){return{id:s||gn(),jsonrpc:"2.0",method:t,params:e}}function Ns(t,e){return{id:t,jsonrpc:"2.0",result:e}}function $s(t,e,s){return{id:t,jsonrpc:"2.0",error:Pf(e)}}function Pf(t,e){return typeof t>"u"?Vo(Fc):(typeof t=="string"&&(t=Object.assign(Object.assign({},Vo(dn)),{message:t})),Ef(t.code)&&(t=Sf(t.code)),t)}class Gc{}class xf extends Gc{constructor(e){super()}}class Rf extends Gc{constructor(){super()}}class Tf extends Rf{constructor(e){super()}}const Af="^wss?:";function Lf(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Cf(t,e){const s=Lf(t);return typeof s>"u"?!1:new RegExp(e).test(s)}function Fo(t){return Cf(t,Af)}function Uf(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Yc(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Vs(t){return Yc(t)&&"method"in t}function Ps(t){return Yc(t)&&(lt(t)||Ge(t))}function lt(t){return"result"in t}function Ge(t){return"error"in t}class yn extends Tf{constructor(e){super(e),this.events=new Ye.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async request(e,s){return this.requestStrict(rs(e.method,e.params||[],e.id||fn().toString()),s)}async requestStrict(e,s){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(n){i(n)}this.events.on(`${e.id}`,n=>{Ge(n)?i(n.error):r(n.result)});try{await this.connection.send(e,s)}catch(n){i(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ps(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Mf=()=>typeof WebSocket<"u"?WebSocket:typeof ze<"u"&&typeof ze.WebSocket<"u"?ze.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),kf=()=>typeof WebSocket<"u"||typeof ze<"u"&&typeof ze.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Bo=t=>t.split("?")[0],Wo=10,Df=Mf();class Jc{constructor(e){if(this.url=e,this.events=new Ye.EventEmitter,this.registering=!1,!Fo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,s)=>{if(typeof this.socket>"u"){s(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e,s){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(oi(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Fo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const s=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=s||this.events.listenerCount("open")>=s)&&this.events.setMaxListeners(s+1),new Promise((r,i)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),i(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((s,r)=>{const i=Wc.isReactNative()?void 0:{rejectUnauthorized:!Uf(e)},n=new Df(e,[],i);kf()?n.onerror=c=>{const a=c;r(this.emitError(a.error))}:n.on("error",c=>{r(this.emitError(c))}),n.onopen=()=>{this.onOpen(n),s(n)}})}onOpen(e){e.onmessage=s=>this.onPayload(s),e.onclose=s=>this.onClose(s),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const s=typeof e.data=="string"?Xi(e.data):e.data;this.events.emit("payload",s)}onError(e,s){const r=this.parseError(s),i=r.message||r.toString(),n=$s(e,i);this.events.emit("payload",n)}parseError(e,s=this.url){return If(e,Bo(s),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Wo&&this.events.setMaxListeners(Wo)}emitError(e){const s=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Bo(this.url)}`));return this.events.emit("register_error",s),s}}var Zr={exports:{}};Zr.exports;(function(t,e){var s=200,r="__lodash_hash_undefined__",i=1,n=2,c=9007199254740991,a="[object Arguments]",l="[object Array]",d="[object AsyncFunction]",g="[object Boolean]",m="[object Date]",A="[object Error]",N="[object Function]",I="[object GeneratorFunction]",x="[object Map]",k="[object Number]",F="[object Null]",S="[object Object]",O="[object Promise]",y="[object Proxy]",v="[object RegExp]",p="[object Set]",o="[object String]",u="[object Symbol]",D="[object Undefined]",b="[object WeakMap]",T="[object ArrayBuffer]",U="[object DataView]",z="[object Float32Array]",w="[object Float64Array]",_="[object Int8Array]",V="[object Int16Array]",$="[object Int32Array]",q="[object Uint8Array]",M="[object Uint8ClampedArray]",j="[object Uint16Array]",B="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,W=/^\[object .+?Constructor\]$/,se=/^(?:0|[1-9]\d*)$/,Q={};Q[z]=Q[w]=Q[_]=Q[V]=Q[$]=Q[q]=Q[M]=Q[j]=Q[B]=!0,Q[a]=Q[l]=Q[T]=Q[g]=Q[U]=Q[m]=Q[A]=Q[N]=Q[x]=Q[k]=Q[S]=Q[v]=Q[p]=Q[o]=Q[b]=!1;var re=typeof wt=="object"&&wt&&wt.Object===Object&&wt,C=typeof self=="object"&&self&&self.Object===Object&&self,L=re||C||Function("return this")(),P=e&&!e.nodeType&&e,h=P&&!0&&t&&!t.nodeType&&t,E=h&&h.exports===P,G=E&&re.process,X=function(){try{return G&&G.binding&&G.binding("util")}catch{}}(),de=X&&X.isTypedArray;function be(f,R){for(var H=-1,Z=f==null?0:f.length,Te=0,ce=[];++H<Z;){var De=f[H];R(De,H,f)&&(ce[Te++]=De)}return ce}function fe(f,R){for(var H=-1,Z=R.length,Te=f.length;++H<Z;)f[Te+H]=R[H];return f}function Se(f,R){for(var H=-1,Z=f==null?0:f.length;++H<Z;)if(R(f[H],H,f))return!0;return!1}function je(f,R){for(var H=-1,Z=Array(f);++H<f;)Z[H]=R(H);return Z}function Ue(f){return function(R){return f(R)}}function we(f,R){return f.has(R)}function ye(f,R){return f==null?void 0:f[R]}function ge(f){var R=-1,H=Array(f.size);return f.forEach(function(Z,Te){H[++R]=[Te,Z]}),H}function ue(f,R){return function(H){return f(R(H))}}function le(f){var R=-1,H=Array(f.size);return f.forEach(function(Z){H[++R]=Z}),H}var he=Array.prototype,ae=Function.prototype,ie=Object.prototype,pe=L["__core-js_shared__"],me=ae.toString,ne=ie.hasOwnProperty,ve=function(){var f=/[^.]+$/.exec(pe&&pe.keys&&pe.keys.IE_PROTO||"");return f?"Symbol(src)_1."+f:""}(),Ee=ie.toString,Oe=RegExp("^"+me.call(ne).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ne=E?L.Buffer:void 0,Ie=L.Symbol,jt=L.Uint8Array,$t=ie.propertyIsEnumerable,ns=he.splice,Nt=Ie?Ie.toStringTag:void 0,fs=Object.getOwnPropertySymbols,Hs=Ne?Ne.isBuffer:void 0,xr=ue(Object.keys,Object),qe=Rs(L,"DataView"),Me=Rs(L,"Map"),$e=Rs(L,"Promise"),Ve=Rs(L,"Set"),Ke=Rs(L,"WeakMap"),ke=Rs(Object,"create"),Xe=ms(qe),Ze=ms(Me),et=ms($e),tt=ms(Ve),st=ms(Ke),Je=Ie?Ie.prototype:void 0,He=Je?Je.valueOf:void 0;function Le(f){var R=-1,H=f==null?0:f.length;for(this.clear();++R<H;){var Z=f[R];this.set(Z[0],Z[1])}}function rt(){this.__data__=ke?ke(null):{},this.size=0}function it(f){var R=this.has(f)&&delete this.__data__[f];return this.size-=R?1:0,R}function Wh(f){var R=this.__data__;if(ke){var H=R[f];return H===r?void 0:H}return ne.call(R,f)?R[f]:void 0}function Gh(f){var R=this.__data__;return ke?R[f]!==void 0:ne.call(R,f)}function Yh(f,R){var H=this.__data__;return this.size+=this.has(f)?0:1,H[f]=ke&&R===void 0?r:R,this}Le.prototype.clear=rt,Le.prototype.delete=it,Le.prototype.get=Wh,Le.prototype.has=Gh,Le.prototype.set=Yh;function Qt(f){var R=-1,H=f==null?0:f.length;for(this.clear();++R<H;){var Z=f[R];this.set(Z[0],Z[1])}}function Jh(){this.__data__=[],this.size=0}function Qh(f){var R=this.__data__,H=Tr(R,f);if(H<0)return!1;var Z=R.length-1;return H==Z?R.pop():ns.call(R,H,1),--this.size,!0}function Xh(f){var R=this.__data__,H=Tr(R,f);return H<0?void 0:R[H][1]}function Zh(f){return Tr(this.__data__,f)>-1}function el(f,R){var H=this.__data__,Z=Tr(H,f);return Z<0?(++this.size,H.push([f,R])):H[Z][1]=R,this}Qt.prototype.clear=Jh,Qt.prototype.delete=Qh,Qt.prototype.get=Xh,Qt.prototype.has=Zh,Qt.prototype.set=el;function ys(f){var R=-1,H=f==null?0:f.length;for(this.clear();++R<H;){var Z=f[R];this.set(Z[0],Z[1])}}function tl(){this.size=0,this.__data__={hash:new Le,map:new(Me||Qt),string:new Le}}function sl(f){var R=Ar(this,f).delete(f);return this.size-=R?1:0,R}function rl(f){return Ar(this,f).get(f)}function il(f){return Ar(this,f).has(f)}function nl(f,R){var H=Ar(this,f),Z=H.size;return H.set(f,R),this.size+=H.size==Z?0:1,this}ys.prototype.clear=tl,ys.prototype.delete=sl,ys.prototype.get=rl,ys.prototype.has=il,ys.prototype.set=nl;function Rr(f){var R=-1,H=f==null?0:f.length;for(this.__data__=new ys;++R<H;)this.add(f[R])}function ol(f){return this.__data__.set(f,r),this}function al(f){return this.__data__.has(f)}Rr.prototype.add=Rr.prototype.push=ol,Rr.prototype.has=al;function os(f){var R=this.__data__=new Qt(f);this.size=R.size}function cl(){this.__data__=new Qt,this.size=0}function hl(f){var R=this.__data__,H=R.delete(f);return this.size=R.size,H}function ll(f){return this.__data__.get(f)}function ul(f){return this.__data__.has(f)}function pl(f,R){var H=this.__data__;if(H instanceof Qt){var Z=H.__data__;if(!Me||Z.length<s-1)return Z.push([f,R]),this.size=++H.size,this;H=this.__data__=new ys(Z)}return H.set(f,R),this.size=H.size,this}os.prototype.clear=cl,os.prototype.delete=hl,os.prototype.get=ll,os.prototype.has=ul,os.prototype.set=pl;function dl(f,R){var H=Lr(f),Z=!H&&xl(f),Te=!H&&!Z&&mi(f),ce=!H&&!Z&&!Te&&Dn(f),De=H||Z||Te||ce,nt=De?je(f.length,String):[],ht=nt.length;for(var Ce in f)ne.call(f,Ce)&&!(De&&(Ce=="length"||Te&&(Ce=="offset"||Ce=="parent")||ce&&(Ce=="buffer"||Ce=="byteLength"||Ce=="byteOffset")||Sl(Ce,ht)))&&nt.push(Ce);return nt}function Tr(f,R){for(var H=f.length;H--;)if(Cn(f[H][0],R))return H;return-1}function gl(f,R,H){var Z=R(f);return Lr(f)?Z:fe(Z,H(f))}function Fs(f){return f==null?f===void 0?D:F:Nt&&Nt in Object(f)?_l(f):Pl(f)}function Rn(f){return Bs(f)&&Fs(f)==a}function Tn(f,R,H,Z,Te){return f===R?!0:f==null||R==null||!Bs(f)&&!Bs(R)?f!==f&&R!==R:fl(f,R,H,Z,Tn,Te)}function fl(f,R,H,Z,Te,ce){var De=Lr(f),nt=Lr(R),ht=De?l:as(f),Ce=nt?l:as(R);ht=ht==a?S:ht,Ce=Ce==a?S:Ce;var Pt=ht==S,zt=Ce==S,gt=ht==Ce;if(gt&&mi(f)){if(!mi(R))return!1;De=!0,Pt=!1}if(gt&&!Pt)return ce||(ce=new os),De||Dn(f)?An(f,R,H,Z,Te,ce):bl(f,R,ht,H,Z,Te,ce);if(!(H&i)){var Lt=Pt&&ne.call(f,"__wrapped__"),Ct=zt&&ne.call(R,"__wrapped__");if(Lt||Ct){var cs=Lt?f.value():f,Xt=Ct?R.value():R;return ce||(ce=new os),Te(cs,Xt,H,Z,ce)}}return gt?(ce||(ce=new os),vl(f,R,H,Z,Te,ce)):!1}function yl(f){if(!kn(f)||Ol(f))return!1;var R=Un(f)?Oe:W;return R.test(ms(f))}function ml(f){return Bs(f)&&Mn(f.length)&&!!Q[Fs(f)]}function wl(f){if(!Nl(f))return xr(f);var R=[];for(var H in Object(f))ne.call(f,H)&&H!="constructor"&&R.push(H);return R}function An(f,R,H,Z,Te,ce){var De=H&i,nt=f.length,ht=R.length;if(nt!=ht&&!(De&&ht>nt))return!1;var Ce=ce.get(f);if(Ce&&ce.get(R))return Ce==R;var Pt=-1,zt=!0,gt=H&n?new Rr:void 0;for(ce.set(f,R),ce.set(R,f);++Pt<nt;){var Lt=f[Pt],Ct=R[Pt];if(Z)var cs=De?Z(Ct,Lt,Pt,R,f,ce):Z(Lt,Ct,Pt,f,R,ce);if(cs!==void 0){if(cs)continue;zt=!1;break}if(gt){if(!Se(R,function(Xt,ws){if(!we(gt,ws)&&(Lt===Xt||Te(Lt,Xt,H,Z,ce)))return gt.push(ws)})){zt=!1;break}}else if(!(Lt===Ct||Te(Lt,Ct,H,Z,ce))){zt=!1;break}}return ce.delete(f),ce.delete(R),zt}function bl(f,R,H,Z,Te,ce,De){switch(H){case U:if(f.byteLength!=R.byteLength||f.byteOffset!=R.byteOffset)return!1;f=f.buffer,R=R.buffer;case T:return!(f.byteLength!=R.byteLength||!ce(new jt(f),new jt(R)));case g:case m:case k:return Cn(+f,+R);case A:return f.name==R.name&&f.message==R.message;case v:case o:return f==R+"";case x:var nt=ge;case p:var ht=Z&i;if(nt||(nt=le),f.size!=R.size&&!ht)return!1;var Ce=De.get(f);if(Ce)return Ce==R;Z|=n,De.set(f,R);var Pt=An(nt(f),nt(R),Z,Te,ce,De);return De.delete(f),Pt;case u:if(He)return He.call(f)==He.call(R)}return!1}function vl(f,R,H,Z,Te,ce){var De=H&i,nt=Ln(f),ht=nt.length,Ce=Ln(R),Pt=Ce.length;if(ht!=Pt&&!De)return!1;for(var zt=ht;zt--;){var gt=nt[zt];if(!(De?gt in R:ne.call(R,gt)))return!1}var Lt=ce.get(f);if(Lt&&ce.get(R))return Lt==R;var Ct=!0;ce.set(f,R),ce.set(R,f);for(var cs=De;++zt<ht;){gt=nt[zt];var Xt=f[gt],ws=R[gt];if(Z)var jn=De?Z(ws,Xt,gt,R,f,ce):Z(Xt,ws,gt,f,R,ce);if(!(jn===void 0?Xt===ws||Te(Xt,ws,H,Z,ce):jn)){Ct=!1;break}cs||(cs=gt=="constructor")}if(Ct&&!cs){var Cr=f.constructor,Ur=R.constructor;Cr!=Ur&&"constructor"in f&&"constructor"in R&&!(typeof Cr=="function"&&Cr instanceof Cr&&typeof Ur=="function"&&Ur instanceof Ur)&&(Ct=!1)}return ce.delete(f),ce.delete(R),Ct}function Ln(f){return gl(f,Al,El)}function Ar(f,R){var H=f.__data__;return Il(R)?H[typeof R=="string"?"string":"hash"]:H.map}function Rs(f,R){var H=ye(f,R);return yl(H)?H:void 0}function _l(f){var R=ne.call(f,Nt),H=f[Nt];try{f[Nt]=void 0;var Z=!0}catch{}var Te=Ee.call(f);return Z&&(R?f[Nt]=H:delete f[Nt]),Te}var El=fs?function(f){return f==null?[]:(f=Object(f),be(fs(f),function(R){return $t.call(f,R)}))}:Ll,as=Fs;(qe&&as(new qe(new ArrayBuffer(1)))!=U||Me&&as(new Me)!=x||$e&&as($e.resolve())!=O||Ve&&as(new Ve)!=p||Ke&&as(new Ke)!=b)&&(as=function(f){var R=Fs(f),H=R==S?f.constructor:void 0,Z=H?ms(H):"";if(Z)switch(Z){case Xe:return U;case Ze:return x;case et:return O;case tt:return p;case st:return b}return R});function Sl(f,R){return R=R??c,!!R&&(typeof f=="number"||se.test(f))&&f>-1&&f%1==0&&f<R}function Il(f){var R=typeof f;return R=="string"||R=="number"||R=="symbol"||R=="boolean"?f!=="__proto__":f===null}function Ol(f){return!!ve&&ve in f}function Nl(f){var R=f&&f.constructor,H=typeof R=="function"&&R.prototype||ie;return f===H}function Pl(f){return Ee.call(f)}function ms(f){if(f!=null){try{return me.call(f)}catch{}try{return f+""}catch{}}return""}function Cn(f,R){return f===R||f!==f&&R!==R}var xl=Rn(function(){return arguments}())?Rn:function(f){return Bs(f)&&ne.call(f,"callee")&&!$t.call(f,"callee")},Lr=Array.isArray;function Rl(f){return f!=null&&Mn(f.length)&&!Un(f)}var mi=Hs||Cl;function Tl(f,R){return Tn(f,R)}function Un(f){if(!kn(f))return!1;var R=Fs(f);return R==N||R==I||R==d||R==y}function Mn(f){return typeof f=="number"&&f>-1&&f%1==0&&f<=c}function kn(f){var R=typeof f;return f!=null&&(R=="object"||R=="function")}function Bs(f){return f!=null&&typeof f=="object"}var Dn=de?Ue(de):ml;function Al(f){return Rl(f)?dl(f):wl(f)}function Ll(){return[]}function Cl(){return!1}t.exports=Tl})(Zr,Zr.exports);var jf=Zr.exports;const Qc=Ya(jf);function zf(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),r=0;r<s.length;r++)s[r]=255;for(var i=0;i<t.length;i++){var n=t.charAt(i),c=n.charCodeAt(0);if(s[c]!==255)throw new TypeError(n+" is ambiguous");s[c]=i}var a=t.length,l=t.charAt(0),d=Math.log(a)/Math.log(256),g=Math.log(256)/Math.log(a);function m(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var x=0,k=0,F=0,S=I.length;F!==S&&I[F]===0;)F++,x++;for(var O=(S-F)*g+1>>>0,y=new Uint8Array(O);F!==S;){for(var v=I[F],p=0,o=O-1;(v!==0||p<k)&&o!==-1;o--,p++)v+=256*y[o]>>>0,y[o]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");k=p,F++}for(var u=O-k;u!==O&&y[u]===0;)u++;for(var D=l.repeat(x);u<O;++u)D+=t.charAt(y[u]);return D}function A(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var x=0;if(I[x]!==" "){for(var k=0,F=0;I[x]===l;)k++,x++;for(var S=(I.length-x)*d+1>>>0,O=new Uint8Array(S);I[x];){var y=s[I.charCodeAt(x)];if(y===255)return;for(var v=0,p=S-1;(y!==0||v<F)&&p!==-1;p--,v++)y+=a*O[p]>>>0,O[p]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");F=v,x++}if(I[x]!==" "){for(var o=S-F;o!==S&&O[o]===0;)o++;for(var u=new Uint8Array(k+(S-o)),D=k;o!==S;)u[D++]=O[o++];return u}}}function N(I){var x=A(I);if(x)return x;throw new Error(`Non-${e} character`)}return{encode:m,decodeUnsafe:A,decode:N}}var qf=zf,$f=qf;const Xc=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Vf=t=>new TextEncoder().encode(t),Kf=t=>new TextDecoder().decode(t);let Hf=class{constructor(t,e,s){this.name=t,this.prefix=e,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Ff=class{constructor(t,e,s){if(this.name=t,this.prefix=e,e.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=e.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Zc(this,t)}},Bf=class{constructor(t){this.decoders=t}or(t){return Zc(this,t)}decode(t){const e=t[0],s=this.decoders[e];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Zc=(t,e)=>new Bf({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Wf=class{constructor(t,e,s,r){this.name=t,this.prefix=e,this.baseEncode=s,this.baseDecode=r,this.encoder=new Hf(t,e,s),this.decoder=new Ff(t,e,r)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const di=({name:t,prefix:e,encode:s,decode:r})=>new Wf(t,e,s,r),Ir=({prefix:t,name:e,alphabet:s})=>{const{encode:r,decode:i}=$f(s,e);return di({prefix:t,name:e,encode:r,decode:n=>Xc(i(n))})},Gf=(t,e,s,r)=>{const i={};for(let g=0;g<e.length;++g)i[e[g]]=g;let n=t.length;for(;t[n-1]==="=";)--n;const c=new Uint8Array(n*s/8|0);let a=0,l=0,d=0;for(let g=0;g<n;++g){const m=i[t[g]];if(m===void 0)throw new SyntaxError(`Non-${r} character`);l=l<<s|m,a+=s,a>=8&&(a-=8,c[d++]=255&l>>a)}if(a>=s||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return c},Yf=(t,e,s)=>{const r=e[e.length-1]==="=",i=(1<<s)-1;let n="",c=0,a=0;for(let l=0;l<t.length;++l)for(a=a<<8|t[l],c+=8;c>s;)c-=s,n+=e[i&a>>c];if(c&&(n+=e[i&a<<s-c]),r)for(;n.length*s&7;)n+="=";return n},pt=({name:t,prefix:e,bitsPerChar:s,alphabet:r})=>di({prefix:e,name:t,encode(i){return Yf(i,r,s)},decode(i){return Gf(i,r,s,t)}}),Jf=di({prefix:"\0",name:"identity",encode:t=>Kf(t),decode:t=>Vf(t)});var Qf=Object.freeze({__proto__:null,identity:Jf});const Xf=pt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Zf=Object.freeze({__proto__:null,base2:Xf});const ey=pt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ty=Object.freeze({__proto__:null,base8:ey});const sy=Ir({prefix:"9",name:"base10",alphabet:"0123456789"});var ry=Object.freeze({__proto__:null,base10:sy});const iy=pt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ny=pt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var oy=Object.freeze({__proto__:null,base16:iy,base16upper:ny});const ay=pt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),cy=pt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),hy=pt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ly=pt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),uy=pt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),py=pt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),dy=pt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),gy=pt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fy=pt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var yy=Object.freeze({__proto__:null,base32:ay,base32upper:cy,base32pad:hy,base32padupper:ly,base32hex:uy,base32hexupper:py,base32hexpad:dy,base32hexpadupper:gy,base32z:fy});const my=Ir({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wy=Ir({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var by=Object.freeze({__proto__:null,base36:my,base36upper:wy});const vy=Ir({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_y=Ir({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ey=Object.freeze({__proto__:null,base58btc:vy,base58flickr:_y});const Sy=pt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Iy=pt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Oy=pt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ny=pt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Py=Object.freeze({__proto__:null,base64:Sy,base64pad:Iy,base64url:Oy,base64urlpad:Ny});const eh=Array.from(""),xy=eh.reduce((t,e,s)=>(t[s]=e,t),[]),Ry=eh.reduce((t,e,s)=>(t[e.codePointAt(0)]=s,t),[]);function Ty(t){return t.reduce((e,s)=>(e+=xy[s],e),"")}function Ay(t){const e=[];for(const s of t){const r=Ry[s.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${s}`);e.push(r)}return new Uint8Array(e)}const Ly=di({prefix:"",name:"base256emoji",encode:Ty,decode:Ay});var Cy=Object.freeze({__proto__:null,base256emoji:Ly}),Uy=th,Go=128,My=127,ky=~My,Dy=Math.pow(2,31);function th(t,e,s){e=e||[],s=s||0;for(var r=s;t>=Dy;)e[s++]=t&255|Go,t/=128;for(;t&ky;)e[s++]=t&255|Go,t>>>=7;return e[s]=t|0,th.bytes=s-r+1,e}var jy=Ki,zy=128,Yo=127;function Ki(t,r){var s=0,r=r||0,i=0,n=r,c,a=t.length;do{if(n>=a)throw Ki.bytes=0,new RangeError("Could not decode varint");c=t[n++],s+=i<28?(c&Yo)<<i:(c&Yo)*Math.pow(2,i),i+=7}while(c>=zy);return Ki.bytes=n-r,s}var qy=Math.pow(2,7),$y=Math.pow(2,14),Vy=Math.pow(2,21),Ky=Math.pow(2,28),Hy=Math.pow(2,35),Fy=Math.pow(2,42),By=Math.pow(2,49),Wy=Math.pow(2,56),Gy=Math.pow(2,63),Yy=function(t){return t<qy?1:t<$y?2:t<Vy?3:t<Ky?4:t<Hy?5:t<Fy?6:t<By?7:t<Wy?8:t<Gy?9:10},Jy={encode:Uy,decode:jy,encodingLength:Yy},sh=Jy;const Jo=(t,e,s=0)=>(sh.encode(t,e,s),e),Qo=t=>sh.encodingLength(t),Hi=(t,e)=>{const s=e.byteLength,r=Qo(t),i=r+Qo(s),n=new Uint8Array(i+s);return Jo(t,n,0),Jo(s,n,r),n.set(e,i),new Qy(t,s,e,n)};let Qy=class{constructor(t,e,s,r){this.code=t,this.size=e,this.digest=s,this.bytes=r}};const rh=({name:t,code:e,encode:s})=>new Xy(t,e,s);let Xy=class{constructor(t,e,s){this.name=t,this.code=e,this.encode=s}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?Hi(this.code,e):e.then(s=>Hi(this.code,s))}else throw Error("Unknown type, must be binary type")}};const ih=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Zy=rh({name:"sha2-256",code:18,encode:ih("SHA-256")}),em=rh({name:"sha2-512",code:19,encode:ih("SHA-512")});var tm=Object.freeze({__proto__:null,sha256:Zy,sha512:em});const nh=0,sm="identity",oh=Xc,rm=t=>Hi(nh,oh(t)),im={code:nh,name:sm,encode:oh,digest:rm};var nm=Object.freeze({__proto__:null,identity:im});new TextEncoder,new TextDecoder;const Xo={...Qf,...Zf,...ty,...ry,...oy,...yy,...by,...Ey,...Py,...Cy};({...tm,...nm});function ah(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function om(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ah(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ch(t,e,s,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:r}}}const Zo=ch("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ei=ch("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);const e=om(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),am={utf8:Zo,"utf-8":Zo,hex:Xo.base16,latin1:Ei,ascii:Ei,binary:Ei,...Xo};function cm(t,e="utf8"){const s=am[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ah(globalThis.Buffer.from(t,"utf-8")):s.decoder.decode(`${s.prefix}${t}`)}const hh="wc",hm=2,mn="core",us=`${hh}@2:${mn}:`,lm={name:mn,logger:"error"},um={database:":memory:"},pm="crypto",ea="client_ed25519_seed",dm=K.ONE_DAY,gm="keychain",fm="0.3",ym="messages",mm="0.3",wm=K.SIX_HOURS,bm="publisher",lh="irn",vm="error",uh="wss://relay.walletconnect.com",ta="wss://relay.walletconnect.org",_m="relayer",yt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Em="_subscription",ts={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Sm=K.ONE_SECOND,Im="2.10.1",Om=1e4,Nm="0.3",Pm="WALLETCONNECT_CLIENT_ID",Ft={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},xm="subscription",Rm="0.3",Tm=K.FIVE_SECONDS*1e3,Am="pairing",Lm="0.3",Zs={wc_pairingDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:K.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:K.ONE_DAY,prompt:!1,tag:0},res:{ttl:K.ONE_DAY,prompt:!1,tag:0}}},ar={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Cm="history",Um="0.3",Mm="expirer",Mt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},km="0.3",Si="verify-api",Hr="https://verify.walletconnect.com",sa="https://verify.walletconnect.org";let Dm=class{constructor(t,e){this.core=t,this.logger=e,this.keychain=new Map,this.name=gm,this.version=fm,this.initialized=!1,this.storagePrefix=us,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,r)=>{this.isInitialized(),this.keychain.set(s,r),await this.persist()},this.get=s=>{this.isInitialized();const r=this.keychain.get(s);if(typeof r>"u"){const{message:i}=Y("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(i)}return r},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=ee.generateChildLogger(e,this.name)}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,zc(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?qc(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}},jm=class{constructor(t,e,s){this.core=t,this.logger=e,this.name=pm,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=r=>(this.isInitialized(),this.keychain.has(r)),this.getClientId=async()=>{this.isInitialized();const r=await this.getClientSeed(),i=Jr(r);return tn(i.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const r=rg();return this.setPrivateKey(r.publicKey,r.privateKey)},this.signJWT=async r=>{this.isInitialized();const i=await this.getClientSeed(),n=Jr(i),c=$i();return await Nc(c,r,dm,n)},this.generateSharedKey=(r,i,n)=>{this.isInitialized();const c=this.getPrivateKey(r),a=ig(c,i);return this.setSymKey(a,n)},this.setSymKey=async(r,i)=>{this.isInitialized();const n=i||ng(r);return await this.keychain.set(n,r),n},this.deleteKeyPair=async r=>{this.isInitialized(),await this.keychain.del(r)},this.deleteSymKey=async r=>{this.isInitialized(),await this.keychain.del(r)},this.encode=async(r,i,n)=>{this.isInitialized();const c=jc(n),a=oi(i);if(Ao(c)){const m=c.senderPublicKey,A=c.receiverPublicKey;r=await this.generateSharedKey(m,A)}const l=this.getSymKey(r),{type:d,senderPublicKey:g}=c;return ag({type:d,symKey:l,message:a,senderPublicKey:g})},this.decode=async(r,i,n)=>{this.isInitialized();const c=lg(i,n);if(Ao(c)){const a=c.receiverPublicKey,l=c.senderPublicKey;r=await this.generateSharedKey(a,l)}try{const a=this.getSymKey(r),l=cg({symKey:a,encoded:i});return Xi(l)}catch(a){this.logger.error(`Failed to decode message from topic: '${r}', clientId: '${await this.getClientId()}'`),this.logger.error(a)}},this.getPayloadType=r=>{const i=Qr(r);return vr(i.type)},this.getPayloadSenderPublicKey=r=>{const i=Qr(r);return i.senderPublicKey?xe(i.senderPublicKey,bt):void 0},this.core=t,this.logger=ee.generateChildLogger(e,this.name),this.keychain=s||new Dm(this.core,this.logger)}get context(){return ee.getLoggerContext(this.logger)}async setPrivateKey(t,e){return await this.keychain.set(t,e),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(ea)}catch{t=$i(),await this.keychain.set(ea,t)}return cm(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}},zm=class extends mu{constructor(t,e){super(t,e),this.logger=t,this.core=e,this.messages=new Map,this.name=ym,this.version=mm,this.initialized=!1,this.storagePrefix=us,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,r)=>{this.isInitialized();const i=Ds(r);let n=this.messages.get(s);return typeof n>"u"&&(n={}),typeof n[i]<"u"||(n[i]=r,this.messages.set(s,n),await this.persist()),i},this.get=s=>{this.isInitialized();let r=this.messages.get(s);return typeof r>"u"&&(r={}),r},this.has=(s,r)=>{this.isInitialized();const i=this.get(s),n=Ds(r);return typeof i[n]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=ee.generateChildLogger(t,this.name),this.core=e}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,zc(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?qc(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}},qm=class extends wu{constructor(t,e){super(t,e),this.relayer=t,this.logger=e,this.events=new Ye.EventEmitter,this.name=bm,this.queue=new Map,this.publishTimeout=K.toMiliseconds(K.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,r,i)=>{var n;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:r,opts:i}});try{const c=(i==null?void 0:i.ttl)||wm,a=Vi(i),l=(i==null?void 0:i.prompt)||!1,d=(i==null?void 0:i.tag)||0,g=(i==null?void 0:i.id)||fn().toString(),m={topic:s,message:r,opts:{ttl:c,relay:a,prompt:l,tag:d,id:g}},A=setTimeout(()=>this.queue.set(g,m),this.publishTimeout);try{await await dr(this.rpcPublish(s,r,c,a,l,d,g),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(g),this.relayer.events.emit(yt.publish,m)}catch(N){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(n=i==null?void 0:i.internal)!=null&&n.throwOnFailedPublish)throw this.removeRequestFromQueue(g),N;return}finally{clearTimeout(A)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:r,opts:i}})}catch(c){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(c),c}},this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.relayer=t,this.logger=ee.generateChildLogger(e,this.name),this.registerEventListeners()}get context(){return ee.getLoggerContext(this.logger)}rpcPublish(t,e,s,r,i,n,c){var a,l,d,g;const m={method:Vr(r.protocol).publish,params:{topic:t,message:e,ttl:s,prompt:i,tag:n},id:c};return It((a=m.params)==null?void 0:a.prompt)&&((l=m.params)==null||delete l.prompt),It((d=m.params)==null?void 0:d.tag)&&((g=m.params)==null||delete g.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:m}),this.relayer.request(m)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:e,message:s,opts:r}=t;await this.publish(e,s,r)})}registerEventListeners(){this.relayer.core.heartbeat.on(Jt.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(yt.connection_stalled);return}this.checkQueue()}),this.relayer.on(yt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}},$m=class{constructor(){this.map=new Map,this.set=(t,e)=>{const s=this.get(t);this.exists(t,e)||this.map.set(t,[...s,e])},this.get=t=>this.map.get(t)||[],this.exists=(t,e)=>this.get(t).includes(e),this.delete=(t,e)=>{if(typeof e>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,e))return;const r=s.filter(i=>i!==e);if(!r.length){this.map.delete(t);return}this.map.set(t,r)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}};var Vm=Object.defineProperty,Km=Object.defineProperties,Hm=Object.getOwnPropertyDescriptors,ra=Object.getOwnPropertySymbols,Fm=Object.prototype.hasOwnProperty,Bm=Object.prototype.propertyIsEnumerable,ia=(t,e,s)=>e in t?Vm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,er=(t,e)=>{for(var s in e||(e={}))Fm.call(e,s)&&ia(t,s,e[s]);if(ra)for(var s of ra(e))Bm.call(e,s)&&ia(t,s,e[s]);return t},Ii=(t,e)=>Km(t,Hm(e));let Wm=class extends _u{constructor(t,e){super(t,e),this.relayer=t,this.logger=e,this.subscriptions=new Map,this.topicMap=new $m,this.events=new Ye.EventEmitter,this.name=xm,this.version=Rm,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=us,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,r)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}});try{const i=Vi(r),n={topic:s,relay:i};this.pending.set(s,n);const c=await this.rpcSubscribe(s,i);return this.onSubscribe(c,n),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}}),c}catch(i){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(i),i}},this.unsubscribe=async(s,r)=>{await this.restartToComplete(),this.isInitialized(),typeof(r==null?void 0:r.id)<"u"?await this.unsubscribeById(s,r.id,r):await this.unsubscribeByTopic(s,r)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((r,i)=>{const n=new K.Watch;n.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(c),n.stop(this.pendingSubscriptionWatchLabel),r(!0)),n.elapsed(this.pendingSubscriptionWatchLabel)>=Tm&&(clearInterval(c),n.stop(this.pendingSubscriptionWatchLabel),i(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=ee.generateChildLogger(e,this.name),this.clientId=""}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,e){let s=!1;try{s=this.getSubscription(t).topic===e}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,e){const s=this.topicMap.get(t);await Promise.all(s.map(async r=>await this.unsubscribeById(t,r,e)))}async unsubscribeById(t,e,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:e,opts:s}});try{const r=Vi(s);await this.rpcUnsubscribe(t,e,r);const i=ot("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,e,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:e,opts:s}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(t,e){const s={method:Vr(e.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await dr(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(yt.connection_stalled)}return Ds(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const e=t[0].relay,s={method:Vr(e.protocol).batchSubscribe,params:{topics:t.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await dr(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(yt.connection_stalled)}}rpcUnsubscribe(t,e,s){const r={method:Vr(s.protocol).unsubscribe,params:{topic:t,id:e}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}onSubscribe(t,e){this.setSubscription(t,Ii(er({},e),{id:t})),this.pending.delete(e.topic)}onBatchSubscribe(t){t.length&&t.forEach(e=>{this.setSubscription(e.id,er({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(t,e,s){this.events.removeAllListeners(e),this.hasSubscription(e,t)&&this.deleteSubscription(e,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,e){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:e}),this.addSubscription(t,e))}addSubscription(t,e){this.subscriptions.set(t,er({},e)),this.topicMap.set(e.topic,t),this.events.emit(Ft.created,e)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const e=this.subscriptions.get(t);if(!e){const{message:s}=Y("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return e}deleteSubscription(t,e){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:e});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Ft.deleted,Ii(er({},s),{reason:e}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ft.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let e=0;e<t;e++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Ft.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:e}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(e)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const e=await this.rpcBatchSubscribe(t);Sr(e)&&this.onBatchSubscribe(e.map((s,r)=>Ii(er({},t[r]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(e=>{t.push(e)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Jt.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(yt.connect,async()=>{await this.onConnect()}),this.relayer.on(yt.disconnect,()=>{this.onDisconnect()}),this.events.on(Ft.created,async t=>{const e=Ft.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),await this.persist()}),this.events.on(Ft.deleted,async t=>{const e=Ft.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const e=setInterval(()=>{this.restartInProgress||(clearInterval(e),t())},this.pollingInterval)})}};var Gm=Object.defineProperty,na=Object.getOwnPropertySymbols,Ym=Object.prototype.hasOwnProperty,Jm=Object.prototype.propertyIsEnumerable,oa=(t,e,s)=>e in t?Gm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Qm=(t,e)=>{for(var s in e||(e={}))Ym.call(e,s)&&oa(t,s,e[s]);if(na)for(var s of na(e))Jm.call(e,s)&&oa(t,s,e[s]);return t};let Xm=class extends bu{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Ye.EventEmitter,this.name=_m,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async e=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(e)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=e=>{this.onProviderPayload(e)},this.onConnectHandler=()=>{this.events.emit(yt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=e=>{this.logger.error(e),this.events.emit(yt.error,e),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ts.payload,this.onPayloadHandler),this.provider.on(ts.connect,this.onConnectHandler),this.provider.on(ts.disconnect,this.onDisconnectHandler),this.provider.on(ts.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?ee.generateChildLogger(t.logger,this.name):ee.pino(ee.getDefaultLoggerOptions({level:t.logger||vm})),this.messages=new zm(this.logger,t.core),this.subscriber=new Wm(this,this.logger),this.publisher=new qm(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||uh,this.projectId=t.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ta}...`),await this.restartTransport(ta)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Om)}get context(){return ee.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,e,s){this.isInitialized(),await this.publisher.publish(t,e,s),await this.recordMessageEvent({topic:t,message:e,publishedAt:Date.now()})}async subscribe(t,e){var s;this.isInitialized();let r=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";return r||(await Promise.all([new Promise(i=>{this.subscriber.once(Ft.created,n=>{n.topic===t&&i()})}),new Promise(async i=>{r=await this.subscriber.subscribe(t,e),i()})]),r)}async unsubscribe(t,e){this.isInitialized(),await this.subscriber.unsubscribe(t,e)}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await dr(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(e=>{if(!this.initialized)return e();this.subscriber.once(Ft.resubscribed,()=>{e()})}),new Promise(async(e,s)=>{try{await dr(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(r){s(r);return}e()})])}catch(e){this.logger.error(e);const s=e;if(!this.isConnectionStalled(s.message))throw e;this.provider.events.emit(ts.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await $o())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(e=>t.includes(e))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new yn(new Jc(_g({sdkVersion:Im,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:e,message:s}=t;await this.messages.set(e,s)}async shouldIgnoreMessageEvent(t){const{topic:e,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(e))return this.logger.debug(`Ignoring message for non-subscribed topic ${e}`),!0;const r=this.messages.has(e,s);return r&&this.logger.debug(`Ignoring duplicate message: ${s}`),r}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Vs(t)){if(!t.method.endsWith(Em))return;const e=t.params,{topic:s,message:r,publishedAt:i}=e.data,n={topic:s,message:r,publishedAt:i};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Qm({type:"event",event:e.id},n)),this.events.emit(e.id,n),await this.acknowledgePayload(t),await this.onMessageEvent(n)}else Ps(t)&&this.events.emit(yt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(yt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const e=Ns(t.id,!0);await this.provider.connection.send(e)}unregisterProviderListeners(){this.provider.off(ts.payload,this.onPayloadHandler),this.provider.off(ts.connect,this.onConnectHandler),this.provider.off(ts.disconnect,this.onDisconnectHandler),this.provider.off(ts.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(yt.connection_stalled,()=>{this.restartTransport().catch(e=>this.logger.error(e))});let t=await $o();gf(async e=>{this.initialized&&t!==e&&(t=e,e?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(yt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},K.toMiliseconds(Sm)))}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const e=setInterval(()=>{this.connected&&(clearInterval(e),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}};var Zm=Object.defineProperty,aa=Object.getOwnPropertySymbols,ew=Object.prototype.hasOwnProperty,tw=Object.prototype.propertyIsEnumerable,ca=(t,e,s)=>e in t?Zm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ha=(t,e)=>{for(var s in e||(e={}))ew.call(e,s)&&ca(t,s,e[s]);if(aa)for(var s of aa(e))tw.call(e,s)&&ca(t,s,e[s]);return t};let gi=class extends vu{constructor(t,e,s,r=us,i=void 0){super(t,e,s,r),this.core=t,this.logger=e,this.name=s,this.map=new Map,this.version=Nm,this.cached=[],this.initialized=!1,this.storagePrefix=us,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>{this.getKey&&n!==null&&!It(n)?this.map.set(this.getKey(n),n):Hg(n)?this.map.set(n.id,n):Fg(n)&&this.map.set(n.topic,n)}),this.cached=[],this.initialized=!0)},this.set=async(n,c)=>{this.isInitialized(),this.map.has(n)?await this.update(n,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:n,value:c}),this.map.set(n,c),await this.persist())},this.get=n=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:n}),this.getData(n)),this.getAll=n=>(this.isInitialized(),n?this.values.filter(c=>Object.keys(n).every(a=>Qc(c[a],n[a]))):this.values),this.update=async(n,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:n,update:c});const a=ha(ha({},this.getData(n)),c);this.map.set(n,a),await this.persist()},this.delete=async(n,c)=>{this.isInitialized(),this.map.has(n)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:n,reason:c}),this.map.delete(n),await this.persist())},this.logger=ee.generateChildLogger(e,this.name),this.storagePrefix=r,this.getKey=i}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const e=this.map.get(t);if(!e){const{message:s}=Y("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return e}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:e}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}},sw=class{constructor(t,e){this.core=t,this.logger=e,this.name=Am,this.version=Lm,this.events=new ii,this.initialized=!1,this.storagePrefix=us,this.ignoredPayloadTypes=[Os],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=$i(),r=await this.core.crypto.setSymKey(s),i=qt(K.FIVE_MINUTES),n={protocol:lh},c={topic:r,expiry:i,relay:n,active:!1},a=Ug({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:s,relay:n});return await this.pairings.set(r,c),await this.core.relayer.subscribe(r),this.core.expirer.set(r,i),{topic:r,uri:a}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:r,symKey:i,relay:n}=Ag(s.uri);let c;if(this.pairings.keys.includes(r)&&(c=this.pairings.get(r),c.active))throw new Error(`Pairing already exists: ${r}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(r)||(await this.core.crypto.setSymKey(i,r),await this.core.relayer.subscribe(r,{relay:n}));const a=qt(K.FIVE_MINUTES),l={topic:r,relay:n,expiry:a,active:!1};return await this.pairings.set(r,l),this.core.expirer.set(r,a),s.activatePairing&&await this.activate({topic:r}),this.events.emit(ar.create,l),l},this.activate=async({topic:s})=>{this.isInitialized();const r=qt(K.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:r}),this.core.expirer.set(s,r)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:r}=s;if(this.pairings.keys.includes(r)){const i=await this.sendRequest(r,"wc_pairingPing",{}),{done:n,resolve:c,reject:a}=Us();this.events.once(Fe("pairing_ping",i),({error:l})=>{l?a(l):c()}),await n()}},this.updateExpiry=async({topic:s,expiry:r})=>{this.isInitialized(),await this.pairings.update(s,{expiry:r})},this.updateMetadata=async({topic:s,metadata:r})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:r})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:r}=s;this.pairings.keys.includes(r)&&(await this.sendRequest(r,"wc_pairingDelete",ot("USER_DISCONNECTED")),await this.deletePairing(r))},this.sendRequest=async(s,r,i)=>{const n=rs(r,i),c=await this.core.crypto.encode(s,n),a=Zs[r].req;return this.core.history.set(s,n),this.core.relayer.publish(s,c,a),n.id},this.sendResult=async(s,r,i)=>{const n=Ns(s,i),c=await this.core.crypto.encode(r,n),a=await this.core.history.get(r,s),l=Zs[a.request.method].res;await this.core.relayer.publish(r,c,l),await this.core.history.resolve(n)},this.sendError=async(s,r,i)=>{const n=$s(s,i),c=await this.core.crypto.encode(r,n),a=await this.core.history.get(r,s),l=Zs[a.request.method]?Zs[a.request.method].res:Zs.unregistered_method.res;await this.core.relayer.publish(r,c,l),await this.core.history.resolve(n)},this.deletePairing=async(s,r)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,ot("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),r?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(r=>hs(r.expiry));await Promise.all(s.map(r=>this.deletePairing(r.topic)))},this.onRelayEventRequest=s=>{const{topic:r,payload:i}=s;switch(i.method){case"wc_pairingPing":return this.onPairingPingRequest(r,i);case"wc_pairingDelete":return this.onPairingDeleteRequest(r,i);default:return this.onUnknownRpcMethodRequest(r,i)}},this.onRelayEventResponse=async s=>{const{topic:r,payload:i}=s,n=(await this.core.history.get(r,i.id)).request.method;switch(n){case"wc_pairingPing":return this.onPairingPingResponse(r,i);default:return this.onUnknownRpcMethodResponse(n)}},this.onPairingPingRequest=async(s,r)=>{const{id:i}=r;try{this.isValidPing({topic:s}),await this.sendResult(i,s,!0),this.events.emit(ar.ping,{id:i,topic:s})}catch(n){await this.sendError(i,s,n),this.logger.error(n)}},this.onPairingPingResponse=(s,r)=>{const{id:i}=r;setTimeout(()=>{lt(r)?this.events.emit(Fe("pairing_ping",i),{}):Ge(r)&&this.events.emit(Fe("pairing_ping",i),{error:r.error})},500)},this.onPairingDeleteRequest=async(s,r)=>{const{id:i}=r;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(ar.delete,{id:i,topic:s})}catch(n){await this.sendError(i,s,n),this.logger.error(n)}},this.onUnknownRpcMethodRequest=async(s,r)=>{const{id:i,method:n}=r;try{if(this.registeredMethods.includes(n))return;const c=ot("WC_METHOD_UNSUPPORTED",n);await this.sendError(i,s,c),this.logger.error(c)}catch(c){await this.sendError(i,s,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(ot("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!Et(s)){const{message:r}=Y("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(r)}if(!Kg(s.uri)){const{message:r}=Y("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(r)}},this.isValidPing=async s=>{if(!Et(s)){const{message:i}=Y("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidPairingTopic(r)},this.isValidDisconnect=async s=>{if(!Et(s)){const{message:i}=Y("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidPairingTopic(r)},this.isValidPairingTopic=async s=>{if(!at(s,!1)){const{message:r}=Y("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.pairings.keys.includes(s)){const{message:r}=Y("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if(hs(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:r}=Y("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}},this.core=t,this.logger=ee.generateChildLogger(e,this.name),this.pairings=new gi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ee.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(yt.message,async t=>{const{topic:e,message:s}=t;if(!this.pairings.keys.includes(e)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const r=await this.core.crypto.decode(e,s);try{Vs(r)?(this.core.history.set(e,r),this.onRelayEventRequest({topic:e,payload:r})):Ps(r)&&(await this.core.history.resolve(r),await this.onRelayEventResponse({topic:e,payload:r}),this.core.history.delete(e,r.id))}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(Mt.expired,async t=>{const{topic:e}=Vc(t.target);e&&this.pairings.keys.includes(e)&&(await this.deletePairing(e,!0),this.events.emit(ar.expire,{topic:e}))})}},rw=class extends yu{constructor(t,e){super(t,e),this.core=t,this.logger=e,this.records=new Map,this.events=new Ye.EventEmitter,this.name=Cm,this.version=Um,this.cached=[],this.initialized=!1,this.storagePrefix=us,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,r,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:r,chainId:i}),this.records.has(r.id))return;const n={id:r.id,topic:s,request:{method:r.method,params:r.params||null},chainId:i,expiry:qt(K.THIRTY_DAYS)};this.records.set(n.id,n),this.events.emit(Kt.created,n)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const r=await this.getRecord(s.id);typeof r.response>"u"&&(r.response=Ge(s)?{error:s.error}:{result:s.result},this.records.set(r.id,r),this.events.emit(Kt.updated,r))},this.get=async(s,r)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:r}),await this.getRecord(r)),this.delete=(s,r)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:r}),this.values.forEach(i=>{if(i.topic===s){if(typeof r<"u"&&i.id!==r)return;this.records.delete(i.id),this.events.emit(Kt.deleted,i)}})},this.exists=async(s,r)=>(this.isInitialized(),this.records.has(r)?(await this.getRecord(r)).topic===s:!1),this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.logger=ee.generateChildLogger(e,this.name)}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(e=>{if(typeof e.response<"u")return;const s={topic:e.topic,request:rs(e.request.method,e.request.params,e.id),chainId:e.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const e=this.records.get(t);if(!e){const{message:s}=Y("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return e}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kt.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:e}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Kt.created,t=>{const e=Kt.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t}),this.persist()}),this.events.on(Kt.updated,t=>{const e=Kt.updated;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t}),this.persist()}),this.events.on(Kt.deleted,t=>{const e=Kt.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t}),this.persist()}),this.core.heartbeat.on(Jt.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{K.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}},iw=class extends Eu{constructor(t,e){super(t,e),this.core=t,this.logger=e,this.expirations=new Map,this.events=new Ye.EventEmitter,this.name=Mm,this.version=km,this.cached=[],this.initialized=!1,this.storagePrefix=us,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const r=this.formatTarget(s);return typeof this.getExpiration(r)<"u"}catch{return!1}},this.set=(s,r)=>{this.isInitialized();const i=this.formatTarget(s),n={target:i,expiry:r};this.expirations.set(i,n),this.checkExpiry(i,n),this.events.emit(Mt.created,{target:i,expiration:n})},this.get=s=>{this.isInitialized();const r=this.formatTarget(s);return this.getExpiration(r)},this.del=s=>{if(this.isInitialized(),this.has(s)){const r=this.formatTarget(s),i=this.getExpiration(r);this.expirations.delete(r),this.events.emit(Mt.deleted,{target:r,expiration:i})}},this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.logger=ee.generateChildLogger(e,this.name)}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Eg(t);if(typeof t=="number")return Sg(t);const{message:e}=Y("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(e)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Mt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:e}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const e=this.expirations.get(t);if(!e){const{message:s}=Y("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return e}checkExpiry(t,e){const{expiry:s}=e;K.toMiliseconds(s)-Date.now()<=0&&this.expire(t,e)}expire(t,e){this.expirations.delete(t),this.events.emit(Mt.expired,{target:t,expiration:e})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,e)=>this.checkExpiry(e,t))}registerEventListeners(){this.core.heartbeat.on(Jt.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Mt.created,t=>{const e=Mt.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()}),this.events.on(Mt.expired,t=>{const e=Mt.expired;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()}),this.events.on(Mt.deleted,t=>{const e=Mt.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}}},nw=class extends Su{constructor(t,e){super(t,e),this.projectId=t,this.logger=e,this.name=Si,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||pi()||!_r())return;const r=(s==null?void 0:s.verifyUrl)||Hr;this.verifyUrl!==r&&this.removeIframe(),this.verifyUrl=r;try{await this.createIframe()}catch(i){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(i)}if(!this.initialized){this.removeIframe(),this.verifyUrl=sa;try{await this.createIframe()}catch(i){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(i),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const r=(s==null?void 0:s.verifyUrl)||Hr;let i;try{i=await this.fetchAttestation(s.attestationId,r)}catch(n){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${r}`),this.logger.info(n),i=await this.fetchAttestation(s.attestationId,sa)}return i},this.fetchAttestation=async(s,r)=>{this.logger.info(`resolving attestation: ${s} from url: ${r}`);const i=this.startAbortTimer(K.ONE_SECOND*2),n=await fetch(`${r}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(i),n.status===200?await n.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var r;try{if(!this.iframe)return;(r=this.iframe.contentWindow)==null||r.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const r=i=>{i.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",r),s())};await Promise.race([new Promise(i=>{if(document.getElementById(Si))return i();window.addEventListener("message",r);const n=document.createElement("iframe");n.id=Si,n.src=`${this.verifyUrl}/${this.projectId}`,n.style.display="none",document.body.append(n),this.iframe=n,s=i}),new Promise((i,n)=>setTimeout(()=>{window.removeEventListener("message",r),n("verify iframe load timeout")},K.toMiliseconds(K.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=ee.generateChildLogger(e,this.name),this.verifyUrl=Hr,this.abortController=new AbortController,this.isDevEnv=un()&&Ja.IS_VITEST}get context(){return ee.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),K.toMiliseconds(t))}};var ow=Object.defineProperty,la=Object.getOwnPropertySymbols,aw=Object.prototype.hasOwnProperty,cw=Object.prototype.propertyIsEnumerable,ua=(t,e,s)=>e in t?ow(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,pa=(t,e)=>{for(var s in e||(e={}))aw.call(e,s)&&ua(t,s,e[s]);if(la)for(var s of la(e))cw.call(e,s)&&ua(t,s,e[s]);return t};let hw=class ph extends fu{constructor(e){super(e),this.protocol=hh,this.version=hm,this.name=mn,this.events=new Ye.EventEmitter,this.initialized=!1,this.on=(r,i)=>this.events.on(r,i),this.once=(r,i)=>this.events.once(r,i),this.off=(r,i)=>this.events.off(r,i),this.removeListener=(r,i)=>this.events.removeListener(r,i),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||uh;const s=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:ee.pino(ee.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||lm.logger}));this.logger=ee.generateChildLogger(s,this.name),this.heartbeat=new Jt.HeartBeat,this.crypto=new jm(this,this.logger,e==null?void 0:e.keychain),this.history=new rw(this,this.logger),this.expirer=new iw(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new ac(pa(pa({},um),e==null?void 0:e.storageOptions)),this.relayer=new Xm({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new sw(this,this.logger),this.verify=new nw(this.projectId||"",this.logger)}static async init(e){const s=new ph(e);await s.initialize();const r=await s.crypto.getClientId();return await s.storage.setItem(Pm,r),s}get context(){return ee.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const lw=hw,dh="wc",gh=2,fh="client",wn=`${dh}@${gh}:${fh}:`,Oi={name:fh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},da="WALLETCONNECT_DEEPLINK_CHOICE",uw="proposal",pw="Proposal expired",dw="session",Dr=K.SEVEN_DAYS,gw="engine",tr={wc_sessionPropose:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1104},res:{ttl:K.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1106},res:{ttl:K.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1112},res:{ttl:K.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ni={min:K.FIVE_MINUTES,max:K.SEVEN_DAYS},ss={idle:"IDLE",active:"ACTIVE"},fw="request",yw=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var mw=Object.defineProperty,ww=Object.defineProperties,bw=Object.getOwnPropertyDescriptors,ga=Object.getOwnPropertySymbols,vw=Object.prototype.hasOwnProperty,_w=Object.prototype.propertyIsEnumerable,fa=(t,e,s)=>e in t?mw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_t=(t,e)=>{for(var s in e||(e={}))vw.call(e,s)&&fa(t,s,e[s]);if(ga)for(var s of ga(e))_w.call(e,s)&&fa(t,s,e[s]);return t},sr=(t,e)=>ww(t,bw(e));let Ew=class extends Ou{constructor(t){super(t),this.name=gw,this.events=new ii,this.initialized=!1,this.ignoredPayloadTypes=[Os],this.requestQueue={state:ss.idle,queue:[]},this.sessionRequestQueue={state:ss.idle,queue:[]},this.requestQueueDelay=K.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(tr)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay)))},this.connect=async e=>{await this.isInitialized();const s=sr(_t({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:c,relays:a}=s;let l=r,d,g=!1;if(l&&(g=this.client.core.pairing.pairings.get(l).active),!l||!g){const{topic:S,uri:O}=await this.client.core.pairing.create();l=S,d=O}const m=await this.client.core.crypto.generateKeyPair(),A=_t({requiredNamespaces:i,optionalNamespaces:n,relays:a??[{protocol:lh}],proposer:{publicKey:m,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:N,resolve:I,done:x}=Us(K.FIVE_MINUTES,pw);if(this.events.once(Fe("session_connect"),async({error:S,session:O})=>{if(S)N(S);else if(O){O.self.publicKey=m;const y=sr(_t({},O),{requiredNamespaces:O.requiredNamespaces,optionalNamespaces:O.optionalNamespaces});await this.client.session.set(O.topic,y),await this.setExpiry(O.topic,O.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:O.peer.metadata}),I(y)}}),!l){const{message:S}=Y("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(S)}const k=await this.sendRequest({topic:l,method:"wc_sessionPropose",params:A}),F=qt(K.FIVE_MINUTES);return await this.setProposal(k,_t({id:k,expiry:F},A)),{uri:d,approval:x}},this.pair=async e=>(await this.isInitialized(),await this.client.core.pairing.pair(e)),this.approve=async e=>{await this.isInitialized(),await this.isValidApprove(e);const{id:s,relayProtocol:r,namespaces:i,sessionProperties:n}=e,c=this.client.proposal.get(s);let{pairingTopic:a,proposer:l,requiredNamespaces:d,optionalNamespaces:g}=c;a=a||"",hr(d)||(d=jg(i,"approve()"));const m=await this.client.core.crypto.generateKeyPair(),A=l.publicKey,N=await this.client.core.crypto.generateSharedKey(m,A);a&&s&&(await this.client.core.pairing.updateMetadata({topic:a,metadata:l.metadata}),await this.sendResult({id:s,topic:a,result:{relay:{protocol:r??"irn"},responderPublicKey:m}}),await this.client.proposal.delete(s,ot("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:a}));const I=_t({relay:{protocol:r??"irn"},namespaces:i,requiredNamespaces:d,optionalNamespaces:g,pairingTopic:a,controller:{publicKey:m,metadata:this.client.metadata},expiry:qt(Dr)},n&&{sessionProperties:n});await this.client.core.relayer.subscribe(N),await this.sendRequest({topic:N,method:"wc_sessionSettle",params:I,throwOnFailedPublish:!0});const x=sr(_t({},I),{topic:N,pairingTopic:a,acknowledged:!1,self:I.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:m});return await this.client.session.set(N,x),await this.setExpiry(N,qt(Dr)),{topic:N,acknowledged:()=>new Promise(k=>setTimeout(()=>k(this.client.session.get(N)),500))}},this.reject=async e=>{await this.isInitialized(),await this.isValidReject(e);const{id:s,reason:r}=e,{pairingTopic:i}=this.client.proposal.get(s);i&&(await this.sendError(s,i,r),await this.client.proposal.delete(s,ot("USER_DISCONNECTED")))},this.update=async e=>{await this.isInitialized(),await this.isValidUpdate(e);const{topic:s,namespaces:r}=e,i=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:r}}),{done:n,resolve:c,reject:a}=Us();return this.events.once(Fe("session_update",i),({error:l})=>{l?a(l):c()}),await this.client.session.update(s,{namespaces:r}),{acknowledged:n}},this.extend=async e=>{await this.isInitialized(),await this.isValidExtend(e);const{topic:s}=e,r=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:i,resolve:n,reject:c}=Us();return this.events.once(Fe("session_extend",r),({error:a})=>{a?c(a):n()}),await this.setExpiry(s,qt(Dr)),{acknowledged:i}},this.request=async e=>{await this.isInitialized(),await this.isValidRequest(e);const{chainId:s,request:r,topic:i,expiry:n}=e,c=gn(),{done:a,resolve:l,reject:d}=Us(n);return this.events.once(Fe("session_request",c),({error:g,result:m})=>{g?d(g):l(m)}),await Promise.all([new Promise(async g=>{await this.sendRequest({clientRpcId:c,topic:i,method:"wc_sessionRequest",params:{request:r,chainId:s},expiry:n,throwOnFailedPublish:!0}).catch(m=>d(m)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:s,id:c}),g()}),new Promise(async g=>{const m=await this.client.core.storage.getItem(da);Ig({id:c,topic:i,wcDeepLink:m}),g()}),a()]).then(g=>g[2])},this.respond=async e=>{await this.isInitialized(),await this.isValidRespond(e);const{topic:s,response:r}=e,{id:i}=r;lt(r)?await this.sendResult({id:i,topic:s,result:r.result,throwOnFailedPublish:!0}):Ge(r)&&await this.sendError(i,s,r.error),this.cleanupAfterResponse(e)},this.ping=async e=>{await this.isInitialized(),await this.isValidPing(e);const{topic:s}=e;if(this.client.session.keys.includes(s)){const r=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:i,resolve:n,reject:c}=Us();this.events.once(Fe("session_ping",r),({error:a})=>{a?c(a):n()}),await i()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async e=>{await this.isInitialized(),await this.isValidEmit(e);const{topic:s,event:r,chainId:i}=e;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:r,chainId:i}})},this.disconnect=async e=>{await this.isInitialized(),await this.isValidDisconnect(e);const{topic:s}=e;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:ot("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=e=>(this.isInitialized(),this.client.session.getAll().filter(s=>$g(s,e))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async e=>{if(e.pairingTopic)try{const s=this.client.core.pairing.pairings.get(e.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(i=>{var n,c;return((n=i.peerMetadata)==null?void 0:n.url)&&((c=i.peerMetadata)==null?void 0:c.url)===e.peer.metadata.url&&i.topic&&i.topic!==s.topic});if(r.length===0)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(e,s)=>{const{self:r}=this.client.session.get(e);await this.client.core.relayer.unsubscribe(e),this.client.session.delete(e,ot("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(r.publicKey)&&await this.client.core.crypto.deleteKeyPair(r.publicKey),this.client.core.crypto.keychain.has(e)&&await this.client.core.crypto.deleteSymKey(e),s||this.client.core.expirer.del(e),this.client.core.storage.removeItem(da).catch(i=>this.client.logger.warn(i))},this.deleteProposal=async(e,s)=>{await Promise.all([this.client.proposal.delete(e,ot("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(e)])},this.deletePendingSessionRequest=async(e,s,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,s),r?Promise.resolve():this.client.core.expirer.del(e)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==e),r&&(this.sessionRequestQueue.state=ss.idle)},this.setExpiry=async(e,s)=>{this.client.session.keys.includes(e)&&await this.client.session.update(e,{expiry:s}),this.client.core.expirer.set(e,s)},this.setProposal=async(e,s)=>{await this.client.proposal.set(e,s),this.client.core.expirer.set(e,s.expiry)},this.setPendingSessionRequest=async e=>{const s=tr.wc_sessionRequest.req.ttl,{id:r,topic:i,params:n,verifyContext:c}=e;await this.client.pendingRequest.set(r,{id:r,topic:i,params:n,verifyContext:c}),s&&this.client.core.expirer.set(r,qt(s))},this.sendRequest=async e=>{const{topic:s,method:r,params:i,expiry:n,relayRpcId:c,clientRpcId:a,throwOnFailedPublish:l}=e,d=rs(r,i,a);if(_r()&&yw.includes(r)){const A=Ds(JSON.stringify(d));this.client.core.verify.register({attestationId:A})}const g=await this.client.core.crypto.encode(s,d),m=tr[r].req;return n&&(m.ttl=n),c&&(m.id=c),this.client.core.history.set(s,d),l?(m.internal=sr(_t({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,g,m)):this.client.core.relayer.publish(s,g,m).catch(A=>this.client.logger.error(A)),d.id},this.sendResult=async e=>{const{id:s,topic:r,result:i,throwOnFailedPublish:n}=e,c=Ns(s,i),a=await this.client.core.crypto.encode(r,c),l=await this.client.core.history.get(r,s),d=tr[l.request.method].res;n?(d.internal=sr(_t({},d.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,a,d)):this.client.core.relayer.publish(r,a,d).catch(g=>this.client.logger.error(g)),await this.client.core.history.resolve(c)},this.sendError=async(e,s,r)=>{const i=$s(e,r),n=await this.client.core.crypto.encode(s,i),c=await this.client.core.history.get(s,e),a=tr[c.request.method].res;this.client.core.relayer.publish(s,n,a),await this.client.core.history.resolve(i)},this.cleanup=async()=>{const e=[],s=[];this.client.session.getAll().forEach(r=>{hs(r.expiry)&&e.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{hs(r.expiry)&&s.push(r.id)}),await Promise.all([...e.map(r=>this.deleteSession(r)),...s.map(r=>this.deleteProposal(r))])},this.onRelayEventRequest=async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ss.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ss.active;const e=this.requestQueue.queue.shift();if(e)try{this.processRequest(e),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=ss.idle},this.processRequest=e=>{const{topic:s,payload:r}=e,i=r.method;switch(i){case"wc_sessionPropose":return this.onSessionProposeRequest(s,r);case"wc_sessionSettle":return this.onSessionSettleRequest(s,r);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,r);case"wc_sessionExtend":return this.onSessionExtendRequest(s,r);case"wc_sessionPing":return this.onSessionPingRequest(s,r);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,r);case"wc_sessionRequest":return this.onSessionRequest(s,r);case"wc_sessionEvent":return this.onSessionEventRequest(s,r);default:return this.client.logger.info(`Unsupported request method ${i}`)}},this.onRelayEventResponse=async e=>{const{topic:s,payload:r}=e,i=(await this.client.core.history.get(s,r.id)).request.method;switch(i){case"wc_sessionPropose":return this.onSessionProposeResponse(s,r);case"wc_sessionSettle":return this.onSessionSettleResponse(s,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,r);case"wc_sessionExtend":return this.onSessionExtendResponse(s,r);case"wc_sessionPing":return this.onSessionPingResponse(s,r);case"wc_sessionRequest":return this.onSessionRequestResponse(s,r);default:return this.client.logger.info(`Unsupported response method ${i}`)}},this.onRelayEventUnknownPayload=e=>{const{topic:s}=e,{message:r}=Y("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(r)},this.onSessionProposeRequest=async(e,s)=>{const{params:r,id:i}=s;try{this.isValidConnect(_t({},s.params));const n=qt(K.FIVE_MINUTES),c=_t({id:i,pairingTopic:e,expiry:n},r);await this.setProposal(i,c);const a=Ds(JSON.stringify(s)),l=await this.getVerifyContext(a,c.proposer.metadata);this.client.events.emit("session_proposal",{id:i,params:c,verifyContext:l})}catch(n){await this.sendError(i,e,n),this.client.logger.error(n)}},this.onSessionProposeResponse=async(e,s)=>{const{id:r}=s;if(lt(s)){const{result:i}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:i});const n=this.client.proposal.get(r);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:n});const c=n.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const a=i.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:a});const l=await this.client.core.crypto.generateSharedKey(c,a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:l});const d=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:d}),await this.client.core.pairing.activate({topic:e})}else Ge(s)&&(await this.client.proposal.delete(r,ot("USER_DISCONNECTED")),this.events.emit(Fe("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(e,s)=>{const{id:r,params:i}=s;try{this.isValidSessionSettleRequest(i);const{relay:n,controller:c,expiry:a,namespaces:l,requiredNamespaces:d,optionalNamespaces:g,sessionProperties:m,pairingTopic:A}=s.params,N=_t({topic:e,relay:n,expiry:a,namespaces:l,acknowledged:!0,pairingTopic:A,requiredNamespaces:d,optionalNamespaces:g,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},m&&{sessionProperties:m});await this.sendResult({id:s.id,topic:e,result:!0}),this.events.emit(Fe("session_connect"),{session:N}),this.cleanupDuplicatePairings(N)}catch(n){await this.sendError(r,e,n),this.client.logger.error(n)}},this.onSessionSettleResponse=async(e,s)=>{const{id:r}=s;lt(s)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(Fe("session_approve",r),{})):Ge(s)&&(await this.client.session.delete(e,ot("USER_DISCONNECTED")),this.events.emit(Fe("session_approve",r),{error:s.error}))},this.onSessionUpdateRequest=async(e,s)=>{const{params:r,id:i}=s;try{const n=`${e}_session_update`,c=kr.get(n);if(c&&this.isRequestOutOfSync(c,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidUpdate(_t({topic:e},r)),await this.client.session.update(e,{namespaces:r.namespaces}),await this.sendResult({id:i,topic:e,result:!0}),this.client.events.emit("session_update",{id:i,topic:e,params:r}),kr.set(n,i)}catch(n){await this.sendError(i,e,n),this.client.logger.error(n)}},this.isRequestOutOfSync=(e,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(e.toString().slice(0,-3)),this.onSessionUpdateResponse=(e,s)=>{const{id:r}=s;lt(s)?this.events.emit(Fe("session_update",r),{}):Ge(s)&&this.events.emit(Fe("session_update",r),{error:s.error})},this.onSessionExtendRequest=async(e,s)=>{const{id:r}=s;try{this.isValidExtend({topic:e}),await this.setExpiry(e,qt(Dr)),await this.sendResult({id:r,topic:e,result:!0}),this.client.events.emit("session_extend",{id:r,topic:e})}catch(i){await this.sendError(r,e,i),this.client.logger.error(i)}},this.onSessionExtendResponse=(e,s)=>{const{id:r}=s;lt(s)?this.events.emit(Fe("session_extend",r),{}):Ge(s)&&this.events.emit(Fe("session_extend",r),{error:s.error})},this.onSessionPingRequest=async(e,s)=>{const{id:r}=s;try{this.isValidPing({topic:e}),await this.sendResult({id:r,topic:e,result:!0}),this.client.events.emit("session_ping",{id:r,topic:e})}catch(i){await this.sendError(r,e,i),this.client.logger.error(i)}},this.onSessionPingResponse=(e,s)=>{const{id:r}=s;setTimeout(()=>{lt(s)?this.events.emit(Fe("session_ping",r),{}):Ge(s)&&this.events.emit(Fe("session_ping",r),{error:s.error})},500)},this.onSessionDeleteRequest=async(e,s)=>{const{id:r}=s;try{this.isValidDisconnect({topic:e,reason:s.params}),await Promise.all([new Promise(i=>{this.client.core.relayer.once(yt.publish,async()=>{i(await this.deleteSession(e))})}),this.sendResult({id:r,topic:e,result:!0})]),this.client.events.emit("session_delete",{id:r,topic:e})}catch(i){this.client.logger.error(i)}},this.onSessionRequest=async(e,s)=>{const{id:r,params:i}=s;try{this.isValidRequest(_t({topic:e},i));const n=Ds(JSON.stringify(rs("wc_sessionRequest",i,r))),c=this.client.session.get(e),a=await this.getVerifyContext(n,c.peer.metadata),l={id:r,topic:e,params:i,verifyContext:a};await this.setPendingSessionRequest(l),this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue()}catch(n){await this.sendError(r,e,n),this.client.logger.error(n)}},this.onSessionRequestResponse=(e,s)=>{const{id:r}=s;lt(s)?this.events.emit(Fe("session_request",r),{result:s.result}):Ge(s)&&this.events.emit(Fe("session_request",r),{error:s.error})},this.onSessionEventRequest=async(e,s)=>{const{id:r,params:i}=s;try{const n=`${e}_session_event_${i.event.name}`,c=kr.get(n);if(c&&this.isRequestOutOfSync(c,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidEmit(_t({topic:e},i)),this.client.events.emit("session_event",{id:r,topic:e,params:i}),kr.set(n,r)}catch(n){await this.sendError(r,e,n),this.client.logger.error(n)}},this.addSessionRequestToSessionRequestQueue=e=>{this.sessionRequestQueue.queue.push(e)},this.cleanupAfterResponse=e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ss.idle,this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ss.active){this.client.logger.info("session request queue is already active.");return}const e=this.sessionRequestQueue.queue[0];if(!e){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ss.active,this.client.events.emit("session_request",e)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=e=>{if(e.active)return;const s=this.client.proposal.getAll().find(r=>r.pairingTopic===e.topic);s&&this.onSessionProposeRequest(e.topic,rs("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer},s.id))},this.isValidConnect=async e=>{if(!Et(e)){const{message:a}=Y("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw new Error(a)}const{pairingTopic:s,requiredNamespaces:r,optionalNamespaces:i,sessionProperties:n,relays:c}=e;if(It(s)||await this.isValidPairingTopic(s),!Zg(c)){const{message:a}=Y("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(a)}!It(r)&&hr(r)!==0&&this.validateNamespaces(r,"requiredNamespaces"),!It(i)&&hr(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),It(n)||this.validateSessionProps(n,"sessionProperties")},this.validateNamespaces=(e,s)=>{const r=Xg(e,"connect()",s);if(r)throw new Error(r.message)},this.isValidApprove=async e=>{if(!Et(e))throw new Error(Y("MISSING_OR_INVALID",`approve() params: ${e}`).message);const{id:s,namespaces:r,relayProtocol:i,sessionProperties:n}=e;await this.isValidProposalId(s);const c=this.client.proposal.get(s),a=Kr(r,"approve()");if(a)throw new Error(a.message);const l=zo(c.requiredNamespaces,r,"approve()");if(l)throw new Error(l.message);if(!at(i,!0)){const{message:d}=Y("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(d)}It(n)||this.validateSessionProps(n,"sessionProperties")},this.isValidReject=async e=>{if(!Et(e)){const{message:i}=Y("MISSING_OR_INVALID",`reject() params: ${e}`);throw new Error(i)}const{id:s,reason:r}=e;if(await this.isValidProposalId(s),!tf(r)){const{message:i}=Y("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(i)}},this.isValidSessionSettleRequest=e=>{if(!Et(e)){const{message:l}=Y("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw new Error(l)}const{relay:s,controller:r,namespaces:i,expiry:n}=e;if(!Hc(s)){const{message:l}=Y("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const c=Bg(r,"onSessionSettleRequest()");if(c)throw new Error(c.message);const a=Kr(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);if(hs(n)){const{message:l}=Y("EXPIRED","onSessionSettleRequest()");throw new Error(l)}},this.isValidUpdate=async e=>{if(!Et(e)){const{message:a}=Y("MISSING_OR_INVALID",`update() params: ${e}`);throw new Error(a)}const{topic:s,namespaces:r}=e;await this.isValidSessionTopic(s);const i=this.client.session.get(s),n=Kr(r,"update()");if(n)throw new Error(n.message);const c=zo(i.requiredNamespaces,r,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async e=>{if(!Et(e)){const{message:r}=Y("MISSING_OR_INVALID",`extend() params: ${e}`);throw new Error(r)}const{topic:s}=e;await this.isValidSessionTopic(s)},this.isValidRequest=async e=>{if(!Et(e)){const{message:a}=Y("MISSING_OR_INVALID",`request() params: ${e}`);throw new Error(a)}const{topic:s,request:r,chainId:i,expiry:n}=e;await this.isValidSessionTopic(s);const{namespaces:c}=this.client.session.get(s);if(!jo(c,i)){const{message:a}=Y("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(a)}if(!sf(r)){const{message:a}=Y("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(a)}if(!of(c,i,r.method)){const{message:a}=Y("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(a)}if(n&&!lf(n,Ni)){const{message:a}=Y("MISSING_OR_INVALID",`request() expiry: ${n}. Expiry must be a number (in seconds) between ${Ni.min} and ${Ni.max}`);throw new Error(a)}},this.isValidRespond=async e=>{if(!Et(e)){const{message:i}=Y("MISSING_OR_INVALID",`respond() params: ${e}`);throw new Error(i)}const{topic:s,response:r}=e;if(await this.isValidSessionTopic(s),!rf(r)){const{message:i}=Y("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(r)}`);throw new Error(i)}},this.isValidPing=async e=>{if(!Et(e)){const{message:r}=Y("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(r)}const{topic:s}=e;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async e=>{if(!Et(e)){const{message:c}=Y("MISSING_OR_INVALID",`emit() params: ${e}`);throw new Error(c)}const{topic:s,event:r,chainId:i}=e;await this.isValidSessionTopic(s);const{namespaces:n}=this.client.session.get(s);if(!jo(n,i)){const{message:c}=Y("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(c)}if(!nf(r)){const{message:c}=Y("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(c)}if(!af(n,i,r.name)){const{message:c}=Y("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(c)}},this.isValidDisconnect=async e=>{if(!Et(e)){const{message:r}=Y("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(r)}const{topic:s}=e;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(e,s)=>{const r={verified:{verifyUrl:s.verifyUrl||Hr,validation:"UNKNOWN",origin:s.url||""}};try{const i=await this.client.core.verify.resolve({attestationId:e,verifyUrl:s.verifyUrl});i&&(r.verified.origin=i.origin,r.verified.isScam=i.isScam,r.verified.validation=i.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(i){this.client.logger.info(i)}return this.client.logger.info(`Verify context: ${JSON.stringify(r)}`),r},this.validateSessionProps=(e,s)=>{Object.values(e).forEach(r=>{if(!at(r,!1)){const{message:i}=Y("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(r)}`);throw new Error(i)}})}}async isInitialized(){if(!this.initialized){const{message:t}=Y("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(yt.message,async t=>{const{topic:e,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const r=await this.client.core.crypto.decode(e,s);try{Vs(r)?(this.client.core.history.set(e,r),this.onRelayEventRequest({topic:e,payload:r})):Ps(r)?(await this.client.core.history.resolve(r),await this.onRelayEventResponse({topic:e,payload:r}),this.client.core.history.delete(e,r.id)):this.onRelayEventUnknownPayload({topic:e,payload:r})}catch(i){this.client.logger.error(i)}})}registerExpirerEvents(){this.client.core.expirer.on(Mt.expired,async t=>{const{topic:e,id:s}=Vc(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,Y("EXPIRED"),!0);e?this.client.session.keys.includes(e)&&(await this.deleteSession(e,!0),this.client.events.emit("session_expire",{topic:e})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(ar.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!at(t,!1)){const{message:e}=Y("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(e)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:e}=Y("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(e)}if(hs(this.client.core.pairing.pairings.get(t).expiry)){const{message:e}=Y("EXPIRED",`pairing topic: ${t}`);throw new Error(e)}}async isValidSessionTopic(t){if(!at(t,!1)){const{message:e}=Y("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(e)}if(!this.client.session.keys.includes(t)){const{message:e}=Y("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(e)}if(hs(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:e}=Y("EXPIRED",`session topic: ${t}`);throw new Error(e)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(at(t,!1)){const{message:e}=Y("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(e)}else{const{message:e}=Y("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(e)}}async isValidProposalId(t){if(!ef(t)){const{message:e}=Y("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(e)}if(!this.client.proposal.keys.includes(t)){const{message:e}=Y("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(e)}if(hs(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:e}=Y("EXPIRED",`proposal id: ${t}`);throw new Error(e)}}},Sw=class extends gi{constructor(t,e){super(t,e,uw,wn),this.core=t,this.logger=e}},Iw=class extends gi{constructor(t,e){super(t,e,dw,wn),this.core=t,this.logger=e}},Ow=class extends gi{constructor(t,e){super(t,e,fw,wn,s=>s.id),this.core=t,this.logger=e}},Nw=class yh extends Iu{constructor(e){super(e),this.protocol=dh,this.version=gh,this.name=Oi.name,this.events=new Ye.EventEmitter,this.on=(r,i)=>this.events.on(r,i),this.once=(r,i)=>this.events.once(r,i),this.off=(r,i)=>this.events.off(r,i),this.removeListener=(r,i)=>this.events.removeListener(r,i),this.removeAllListeners=r=>this.events.removeAllListeners(r),this.connect=async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}},this.pair=async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}},this.approve=async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}},this.reject=async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}},this.update=async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}},this.extend=async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}},this.request=async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}},this.respond=async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}},this.ping=async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}},this.emit=async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}},this.disconnect=async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}},this.find=r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}},this.name=(e==null?void 0:e.name)||Oi.name,this.metadata=(e==null?void 0:e.metadata)||mg();const s=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:ee.pino(ee.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Oi.logger}));this.core=(e==null?void 0:e.core)||new lw(e),this.logger=ee.generateChildLogger(s,this.name),this.session=new Iw(this.core,this.logger),this.proposal=new Sw(this.core,this.logger),this.pendingRequest=new Ow(this.core,this.logger),this.engine=new Ew(this)}static async init(e){const s=new yh(e);return await s.initialize(),s}get context(){return ee.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Pw=()=>{var e,s;const t=(s=(e=rn())==null?void 0:e.os)==null?void 0:s.toLowerCase();return t!=null&&t.includes("android")?"android":t!=null&&t.toLowerCase().includes("ios")||t!=null&&t.toLowerCase().includes("mac")&&navigator.maxTouchPoints>1?"ios":"desktop"},jr=Pw(),xw={position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0,0,0,0.8)",backdropFilter:"blur(10px)",zIndex:"9999",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",color:"white",fontWeight:"500",fontFamily:"'Barlow', sans-serif"},Rw={width:"840px",height:"540px",zIndex:"99999",backgroundColor:"white",border:"none",outline:"none",borderRadius:"40px",boxShadow:"0px 4px 40px 0px rgb(0 0 0), 0px 4px 8px 0px rgb(0 0 0 / 25%)",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},Tw=`
  <div id="argent-mobile-modal-container" style="position: relative">
    <iframe class="argent-iframe" allow="clipboard-write"></iframe>
    <div class="argent-close-button" style="position: absolute; top: 24px; right: 24px; cursor: pointer;">
      <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="16" fill="#F5F3F0"/>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M22.2462 9.75382C22.7018 10.2094 22.7018 10.9481 22.2462 11.4037L17.6499 16L22.2462 20.5963C22.7018 21.0519 22.7018 21.7906 22.2462 22.2462C21.7905 22.7018 21.0519 22.7018 20.5962 22.2462L16 17.6499L11.4039 22.246C10.9482 22.7017 10.2096 22.7017 9.75394 22.246C9.29833 21.7904 9.29833 21.0517 9.75394 20.5961L14.3501 16L9.75394 11.4039C9.29833 10.9483 9.29833 10.2096 9.75394 9.75396C10.2096 9.29835 10.9482 9.29835 11.4039 9.75396L16 14.3501L20.5962 9.75382C21.0519 9.29821 21.7905 9.29821 22.2462 9.75382Z" fill="#333332"/>
      </svg>
    </div>
  </div>
`;class Aw{constructor(){_e(this,"bridgeUrl","https://login.argent.xyz"),_e(this,"mobileUrl","argent://"),_e(this,"type","overlay"),_e(this,"wcUri"),_e(this,"overlay"),_e(this,"popupWindow"),_e(this,"closingTimeout"),_e(this,"close",()=>{var e,s;(e=this.overlay)==null||e.remove(),(s=this.popupWindow)==null||s.close(),this.overlay=void 0,this.popupWindow=void 0})}showConnectionModal(e){const s=encodeURIComponent(e),r=encodeURIComponent(window.location.href);this.showModal({desktop:`${this.bridgeUrl}?wc=${s}&device=desktop`,ios:`${this.mobileUrl}app/wc?uri=${s}&href=${r}&device=mobile`,android:`${this.mobileUrl}app/wc?uri=${s}&href=${r}&device=mobile`})}showApprovalModal(e){if(jr==="desktop"){this.showModal({desktop:`${this.bridgeUrl}?action=sign`,ios:"",android:""});return}const s=encodeURIComponent(window.location.href);this.showModal({desktop:`${this.bridgeUrl}?action=sign&device=desktop`,ios:`${this.mobileUrl}app/wc/request?href=${s}&device=mobile`,android:`${this.mobileUrl}app/wc/request?href=${s}&device=mobile`})}closeModal(e){var s,r,i,n;e?((i=(r=(s=this.overlay)==null?void 0:s.querySelector("iframe"))==null?void 0:r.contentWindow)==null||i.postMessage("argent-login.success","*"),(n=this.popupWindow)==null||n.postMessage("argent-login.success","*"),this.closingTimeout=setTimeout(this.close,3400)):this.close()}showModal(e){if(clearTimeout(this.closingTimeout),(this.overlay||this.popupWindow)&&this.close(),jr==="android"||jr==="ios"){const i=document.createElement("button");i.style.display="none",i.addEventListener("click",()=>{window.location.href=e[jr]}),i.click();return}if(this.type==="window"){const i="menubar=no,location=no,resizable=no,scrollbars=no,status=no,width=840,height=540";this.popupWindow=window.open(e.desktop,"_blank",i)||void 0;return}const s=document.createElement("div");s.innerHTML=Tw,s.id="argent-mobile-modal-overlay";for(const[i,n]of Object.entries(xw))s.style[i]=n;document.body.appendChild(s),s.addEventListener("click",()=>this.closeModal()),this.overlay=s;const r=s.querySelector("iframe");r.setAttribute("src",e.desktop);for(const[i,n]of Object.entries(Rw))r.style[i]=n;s.querySelector(".argent-close-button").addEventListener("click",()=>this.closeModal())}}const Wt=new Aw,ei=qr.NetworkName,Lw=async({projectId:t,chainId:e,name:s,description:r,rpcUrl:i,bridgeUrl:n=Cw(e),mobileUrl:c=Uw(e),modalType:a="overlay",url:l,icons:d,walletConnect:g,provider:m},A)=>{if(!n)throw new Error("bridgeUrl is required");if(!c)throw new Error("mobileUrl is required");Wt.bridgeUrl=n,Wt.mobileUrl=c,Wt.type=a;const N={projectId:t,metadata:{name:s??"Unknown dapp",description:r??"Unknown dapp description",url:l??"#",icons:d??[],...g==null?void 0:g.metadata}},I=await Nw.init(N),x=new A({client:I,chainId:e,rpcUrl:i,provider:m});I.on("session_event",k=>{}),I.on("session_update",({topic:k,params:F})=>{const{namespaces:S}=F,O=I.session.get(k);x.updateSession({...O,namespaces:S})}),I.on("session_delete",()=>{});try{const k=I.session.getAll().find(x.isValidSession);if(k)return x.updateSession(k),x;const F={requiredNamespaces:x.getRequiredNamespaces()};Ul(),await new Promise(y=>setTimeout(y,200));const{uri:S,approval:O}=await I.connect(F);if(S){Wt.showConnectionModal(S),Wt.wcUri=S;const y=await O();x.updateSession(y),Wt.closeModal("animateSuccess")}return x}catch{return console.error("@argent/login::error"),Wt.closeModal(),null}},Cw=t=>{if(!t)throw new Error(`Unknown or unsupported chainId (${t}), either specify a supported chain or set bridgeUrl.`);const e=parseInt(`${t}`);if(String(t).startsWith(ei.SN_GOERLI)||e===5)return"https://login.hydrogen.argent47.net";if(String(t).startsWith(ei.SN_MAIN)||e===1)return"https://login.argent.xyz"},Uw=t=>{if(!t)throw new Error(`Unknown or unsupported chainId (${t}), either specify a supported chain or set mobileUrl.`);const e=parseInt(`${t}`);if(String(t).startsWith(ei.SN_GOERLI)||e===5)return"argent-dev://";if(String(t).startsWith(ei.SN_MAIN)||e===1)return"argent://"};class Mw extends Tt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class kw extends Tt{constructor(e,s){super(),this.core=e,this.logger=s,this.records=new Map}}class Dw{constructor(e,s){this.logger=e,this.core=s}}class jw extends Tt{constructor(e,s){super(),this.relayer=e,this.logger=s}}let zw=class extends Tt{constructor(t){super()}},qw=class{constructor(t,e,s,r){this.core=t,this.logger=e,this.name=s}};class $w extends Tt{constructor(e,s){super(),this.relayer=e,this.logger=s}}class Vw extends Tt{constructor(e,s){super(),this.core=e,this.logger=s}}class Kw{constructor(e,s){this.projectId=e,this.logger=s}}let Hw=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},Fw=class{constructor(t){this.client=t}};const mh=":";function Bw(t){const{namespace:e,reference:s}=t;return[e,s].join(mh)}function Ww(t){const[e,s,r]=t.split(mh);return{namespace:e,reference:s,address:r}}function Gw(t,e){const s=[];return t.forEach(r=>{const i=e(r);s.includes(i)||s.push(i)}),s}function Yw(t){const{namespace:e,reference:s}=Ww(t);return Bw({namespace:e,reference:s})}function Jw(t){return Gw(t,Yw)}function Qw(t,e=[]){const s=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const i=t[r];s.push(...i.accounts)}),s}function Xw(t,e=[]){const s=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const i=t[r];s.push(...Jw(i.accounts))}),s}function Zw(t,e=[]){const s=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const i=t[r];s.push(...bn(r,i))}),s}function bn(t,e){return t.includes(":")?[t]:e.chains||[]}const wh="base10",vt="base16",Fi="base64pad",vn="utf8",bh=0,xs=1,eb=0,ya=1,Bi=12,_n=32;function tb(){const t=wr.generateKeyPair();return{privateKey:xe(t.secretKey,vt),publicKey:xe(t.publicKey,vt)}}function Wi(){const t=ds.randomBytes(_n);return xe(t,vt)}function sb(t,e){const s=wr.sharedKey(Ae(t,vt),Ae(e,vt)),r=new Lc(Ss.SHA256,s).expand(_n);return xe(r,vt)}function rb(t){const e=Ss.hash(Ae(t,vt));return xe(e,vt)}function js(t){const e=Ss.hash(Ae(t,vn));return xe(e,vt)}function ib(t){return Ae(`${t}`,wh)}function Or(t){return Number(xe(t,wh))}function nb(t){const e=ib(typeof t.type<"u"?t.type:bh);if(Or(e)===xs&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const s=typeof t.senderPublicKey<"u"?Ae(t.senderPublicKey,vt):void 0,r=typeof t.iv<"u"?Ae(t.iv,vt):ds.randomBytes(Bi),i=new yr.ChaCha20Poly1305(Ae(t.symKey,vt)).seal(r,Ae(t.message,vn));return ab({type:e,sealed:i,iv:r,senderPublicKey:s})}function ob(t){const e=new yr.ChaCha20Poly1305(Ae(t.symKey,vt)),{sealed:s,iv:r}=ti(t.encoded),i=e.open(r,s);if(i===null)throw new Error("Failed to decrypt");return xe(i,vn)}function ab(t){if(Or(t.type)===xs){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return xe(pr([t.type,t.senderPublicKey,t.iv,t.sealed]),Fi)}return xe(pr([t.type,t.iv,t.sealed]),Fi)}function ti(t){const e=Ae(t,Fi),s=e.slice(eb,ya),r=ya;if(Or(s)===xs){const a=r+_n,l=a+Bi,d=e.slice(r,a),g=e.slice(a,l),m=e.slice(l);return{type:s,sealed:m,iv:g,senderPublicKey:d}}const i=r+Bi,n=e.slice(r,i),c=e.slice(i);return{type:s,sealed:c,iv:n}}function cb(t,e){const s=ti(t);return vh({type:Or(s.type),senderPublicKey:typeof s.senderPublicKey<"u"?xe(s.senderPublicKey,vt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function vh(t){const e=(t==null?void 0:t.type)||bh;if(e===xs){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function ma(t){return t.type===xs&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var hb=Object.defineProperty,wa=Object.getOwnPropertySymbols,lb=Object.prototype.hasOwnProperty,ub=Object.prototype.propertyIsEnumerable,ba=(t,e,s)=>e in t?hb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,va=(t,e)=>{for(var s in e||(e={}))lb.call(e,s)&&ba(t,s,e[s]);if(wa)for(var s of wa(e))ub.call(e,s)&&ba(t,s,e[s]);return t};const pb="ReactNative",cr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},db="js";function En(){return typeof Rt<"u"&&typeof Rt.versions<"u"&&typeof Rt.versions.node<"u"}function _h(){return!nn()&&!!br()&&navigator.product===pb}function Sn(){return!En()&&!!br()}function gb(){return _h()?cr.reactNative:En()?cr.node:Sn()?cr.browser:cr.unknown}function fb(t,e){let s=is.parse(t);return s=va(va({},s),e),t=is.stringify(s),t}function yb(){return cn()||{name:"",description:"",url:"",icons:[""]}}function mb(){const t=rn();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function wb(){var t;const e=gb();return e===cr.browser?[e,((t=on())==null?void 0:t.host)||"unknown"].join(":"):e}function bb(t,e,s){const r=mb(),i=wb();return[[t,e].join("-"),[db,s].join("-"),r,i].join("/")}function vb({protocol:t,version:e,relayUrl:s,sdkVersion:r,auth:i,projectId:n,useOnCloseEvent:c}){const a=s.split("?"),l=bb(t,e,r),d={auth:i,ua:l,projectId:n,useOnCloseEvent:c||void 0},g=fb(a[1]||"",d);return a[0]+"?"+g}function Es(t,e){return t.filter(s=>e.includes(s)).length===t.length}function Eh(t){return Object.fromEntries(t.entries())}function Sh(t){return new Map(Object.entries(t))}function Ms(t=K.FIVE_MINUTES,e){const s=K.toMiliseconds(t||K.FIVE_MINUTES);let r,i,n;return{resolve:c=>{n&&r&&(clearTimeout(n),r(c))},reject:c=>{n&&i&&(clearTimeout(n),i(c))},done:()=>new Promise((c,a)=>{n=setTimeout(()=>{a(new Error(e))},s),r=c,i=a})}}function si(t,e,s){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(new Error(s)),e);try{const c=await t;r(c)}catch(c){i(c)}clearTimeout(n)})}function Ih(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function _b(t){return Ih("topic",t)}function Eb(t){return Ih("id",t)}function Oh(t){const[e,s]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")r.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))r.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return r}function Gt(t,e){return K.fromMiliseconds(Date.now()+K.toMiliseconds(t))}function ls(t){return Date.now()>=K.toMiliseconds(t)}function Be(t,e){return`${t}${e?`:${e}`:""}`}const Sb="irn";function Gi(t){return(t==null?void 0:t.relay)||{protocol:Sb}}function Fr(t){const e=Uc[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Ib=Object.defineProperty,_a=Object.getOwnPropertySymbols,Ob=Object.prototype.hasOwnProperty,Nb=Object.prototype.propertyIsEnumerable,Ea=(t,e,s)=>e in t?Ib(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Pb=(t,e)=>{for(var s in e||(e={}))Ob.call(e,s)&&Ea(t,s,e[s]);if(_a)for(var s of _a(e))Nb.call(e,s)&&Ea(t,s,e[s]);return t};function xb(t,e="-"){const s={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){const n=i.replace(r,""),c=t[i];s[n]=c}}),s}function Rb(t){const e=t.indexOf(":"),s=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,s).split("@"),n=typeof s<"u"?t.substring(s):"",c=is.parse(n);return{protocol:r,topic:Tb(i[0]),version:parseInt(i[1],10),symKey:c.symKey,relay:xb(c)}}function Tb(t){return t.startsWith("//")?t.substring(2):t}function Ab(t,e="-"){const s="relay",r={};return Object.keys(t).forEach(i=>{const n=s+e+i;t[i]&&(r[n]=t[i])}),r}function Lb(t){return`${t.protocol}:${t.topic}@${t.version}?`+is.stringify(Pb({symKey:t.symKey},Ab(t.relay)))}function Ks(t){const e=[];return t.forEach(s=>{const[r,i]=s.split(":");e.push(`${r}:${i}`)}),e}function Cb(t){const e=[];return Object.values(t).forEach(s=>{e.push(...Ks(s.accounts))}),e}function Ub(t,e){const s=[];return Object.values(t).forEach(r=>{Ks(r.accounts).includes(e)&&s.push(...r.methods)}),s}function Mb(t,e){const s=[];return Object.values(t).forEach(r=>{Ks(r.accounts).includes(e)&&s.push(...r.events)}),s}function kb(t,e){const s=Br(t,e);if(s)throw new Error(s.message);const r={};for(const[i,n]of Object.entries(t))r[i]={methods:n.methods,events:n.events,chains:n.accounts.map(c=>`${c.split(":")[0]}:${c.split(":")[1]}`)};return r}const Db={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},jb={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function J(t,e){const{message:s,code:r}=jb[t];return{message:e?`${s} ${e}`:s,code:r}}function Qe(t,e){const{message:s,code:r}=Db[t];return{message:e?`${s} ${e}`:s,code:r}}function Nr(t,e){return!!Array.isArray(t)}function ur(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ot(t){return typeof t>"u"}function ct(t,e){return e&&Ot(t)?!0:typeof t=="string"&&!!t.trim().length}function In(t,e){return typeof t=="number"&&!isNaN(t)}function zb(t,e){const{requiredNamespaces:s}=e,r=Object.keys(t.namespaces),i=Object.keys(s);let n=!0;return Es(i,r)?(r.forEach(c=>{const{accounts:a,methods:l,events:d}=t.namespaces[c],g=Ks(a),m=s[c];(!Es(bn(c,m),g)||!Es(m.methods,l)||!Es(m.events,d))&&(n=!1)}),n):!1}function On(t){return ct(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function qb(t){if(ct(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const s=e[0]+":"+e[1];return!!e[2]&&On(s)}}return!1}function $b(t){if(ct(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Vb(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Kb(t){return t==null?void 0:t.topic}function Hb(t,e){let s=null;return ct(t==null?void 0:t.publicKey,!1)||(s=J("MISSING_OR_INVALID",`${e} controller public key should be a string`)),s}function Sa(t){let e=!0;return Nr(t)?t.length&&(e=t.every(s=>ct(s,!1))):e=!1,e}function Fb(t,e,s){let r=null;return Nr(e)?e.forEach(i=>{r||(!On(i)||!i.includes(t))&&(r=Qe("UNSUPPORTED_CHAINS",`${s}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):r=Qe("UNSUPPORTED_CHAINS",`${s}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),r}function Bb(t,e){let s=null;return Object.entries(t).forEach(([r,i])=>{if(s)return;const n=Fb(r,bn(r,i),`${e} requiredNamespace`);n&&(s=n)}),s}function Wb(t,e){let s=null;return Nr(t)?t.forEach(r=>{s||qb(r)||(s=Qe("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):s=Qe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s}function Gb(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;const i=Wb(r==null?void 0:r.accounts,`${e} namespace`);i&&(s=i)}),s}function Yb(t,e){let s=null;return Sa(t==null?void 0:t.methods)?Sa(t==null?void 0:t.events)||(s=Qe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):s=Qe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),s}function Nh(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;const i=Yb(r,`${e}, namespace`);i&&(s=i)}),s}function Jb(t,e,s){let r=null;if(t&&ur(t)){const i=Nh(t,e);i&&(r=i);const n=Bb(t,e);n&&(r=n)}else r=J("MISSING_OR_INVALID",`${e}, ${s} should be an object with data`);return r}function Br(t,e){let s=null;if(t&&ur(t)){const r=Nh(t,e);r&&(s=r);const i=Gb(t,e);i&&(s=i)}else s=J("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return s}function Ph(t){return ct(t.protocol,!0)}function Qb(t,e){let s=!1;return t?t&&Nr(t)&&t.length&&t.forEach(r=>{s=Ph(r)}):s=!0,s}function Xb(t){return typeof t=="number"}function St(t){return typeof t<"u"&&typeof t!==null}function Zb(t){return!(!t||typeof t!="object"||!t.code||!In(t.code)||!t.message||!ct(t.message,!1))}function ev(t){return!(Ot(t)||!ct(t.method,!1))}function tv(t){return!(Ot(t)||Ot(t.result)&&Ot(t.error)||!In(t.id)||!ct(t.jsonrpc,!1))}function sv(t){return!(Ot(t)||!ct(t.name,!1))}function Ia(t,e){return!(!On(e)||!Cb(t).includes(e))}function rv(t,e,s){return ct(s,!1)?Ub(t,e).includes(s):!1}function iv(t,e,s){return ct(s,!1)?Mb(t,e).includes(s):!1}function Oa(t,e,s){let r=null;const i=nv(t),n=ov(e),c=Object.keys(i),a=Object.keys(n),l=Na(Object.keys(t)),d=Na(Object.keys(e)),g=l.filter(m=>!d.includes(m));return g.length&&(r=J("NON_CONFORMING_NAMESPACES",`${s} namespaces keys don't satisfy requiredNamespaces.
      Required: ${g.toString()}
      Received: ${Object.keys(e).toString()}`)),Es(c,a)||(r=J("NON_CONFORMING_NAMESPACES",`${s} namespaces chains don't satisfy required namespaces.
      Required: ${c.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(m=>{if(!m.includes(":")||r)return;const A=Ks(e[m].accounts);A.includes(m)||(r=J("NON_CONFORMING_NAMESPACES",`${s} namespaces accounts don't satisfy namespace accounts for ${m}
        Required: ${m}
        Approved: ${A.toString()}`))}),c.forEach(m=>{r||(Es(i[m].methods,n[m].methods)?Es(i[m].events,n[m].events)||(r=J("NON_CONFORMING_NAMESPACES",`${s} namespaces events don't satisfy namespace events for ${m}`)):r=J("NON_CONFORMING_NAMESPACES",`${s} namespaces methods don't satisfy namespace methods for ${m}`))}),r}function nv(t){const e={};return Object.keys(t).forEach(s=>{var r;s.includes(":")?e[s]=t[s]:(r=t[s].chains)==null||r.forEach(i=>{e[i]={methods:t[s].methods,events:t[s].events}})}),e}function Na(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function ov(t){const e={};return Object.keys(t).forEach(s=>{var r;s.includes(":")?e[s]=t[s]:(r=Ks(t[s].accounts))==null||r.forEach(i=>{e[i]={accounts:t[s].accounts.filter(n=>n.includes(`${i}:`)),methods:t[s].methods,events:t[s].events}})}),e}function av(t,e){return In(t)&&t<=e.max&&t>=e.min}function cv(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),r=0;r<s.length;r++)s[r]=255;for(var i=0;i<t.length;i++){var n=t.charAt(i),c=n.charCodeAt(0);if(s[c]!==255)throw new TypeError(n+" is ambiguous");s[c]=i}var a=t.length,l=t.charAt(0),d=Math.log(a)/Math.log(256),g=Math.log(256)/Math.log(a);function m(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var x=0,k=0,F=0,S=I.length;F!==S&&I[F]===0;)F++,x++;for(var O=(S-F)*g+1>>>0,y=new Uint8Array(O);F!==S;){for(var v=I[F],p=0,o=O-1;(v!==0||p<k)&&o!==-1;o--,p++)v+=256*y[o]>>>0,y[o]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");k=p,F++}for(var u=O-k;u!==O&&y[u]===0;)u++;for(var D=l.repeat(x);u<O;++u)D+=t.charAt(y[u]);return D}function A(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var x=0;if(I[x]!==" "){for(var k=0,F=0;I[x]===l;)k++,x++;for(var S=(I.length-x)*d+1>>>0,O=new Uint8Array(S);I[x];){var y=s[I.charCodeAt(x)];if(y===255)return;for(var v=0,p=S-1;(y!==0||v<F)&&p!==-1;p--,v++)y+=a*O[p]>>>0,O[p]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");F=v,x++}if(I[x]!==" "){for(var o=S-F;o!==S&&O[o]===0;)o++;for(var u=new Uint8Array(k+(S-o)),D=k;o!==S;)u[D++]=O[o++];return u}}}function N(I){var x=A(I);if(x)return x;throw new Error(`Non-${e} character`)}return{encode:m,decodeUnsafe:A,decode:N}}var hv=cv,lv=hv;const xh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},uv=t=>new TextEncoder().encode(t),pv=t=>new TextDecoder().decode(t);class dv{constructor(e,s,r){this.name=e,this.prefix=s,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class gv{constructor(e,s,r){if(this.name=e,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Rh(this,e)}}class fv{constructor(e){this.decoders=e}or(e){return Rh(this,e)}decode(e){const s=e[0],r=this.decoders[s];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Rh=(t,e)=>new fv({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class yv{constructor(e,s,r,i){this.name=e,this.prefix=s,this.baseEncode=r,this.baseDecode=i,this.encoder=new dv(e,s,r),this.decoder=new gv(e,s,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const fi=({name:t,prefix:e,encode:s,decode:r})=>new yv(t,e,s,r),Pr=({prefix:t,name:e,alphabet:s})=>{const{encode:r,decode:i}=lv(s,e);return fi({prefix:t,name:e,encode:r,decode:n=>xh(i(n))})},mv=(t,e,s,r)=>{const i={};for(let g=0;g<e.length;++g)i[e[g]]=g;let n=t.length;for(;t[n-1]==="=";)--n;const c=new Uint8Array(n*s/8|0);let a=0,l=0,d=0;for(let g=0;g<n;++g){const m=i[t[g]];if(m===void 0)throw new SyntaxError(`Non-${r} character`);l=l<<s|m,a+=s,a>=8&&(a-=8,c[d++]=255&l>>a)}if(a>=s||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return c},wv=(t,e,s)=>{const r=e[e.length-1]==="=",i=(1<<s)-1;let n="",c=0,a=0;for(let l=0;l<t.length;++l)for(a=a<<8|t[l],c+=8;c>s;)c-=s,n+=e[i&a>>c];if(c&&(n+=e[i&a<<s-c]),r)for(;n.length*s&7;)n+="=";return n},dt=({name:t,prefix:e,bitsPerChar:s,alphabet:r})=>fi({prefix:e,name:t,encode(i){return wv(i,r,s)},decode(i){return mv(i,r,s,t)}}),bv=fi({prefix:"\0",name:"identity",encode:t=>pv(t),decode:t=>uv(t)});var vv=Object.freeze({__proto__:null,identity:bv});const _v=dt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ev=Object.freeze({__proto__:null,base2:_v});const Sv=dt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Iv=Object.freeze({__proto__:null,base8:Sv});const Ov=Pr({prefix:"9",name:"base10",alphabet:"0123456789"});var Nv=Object.freeze({__proto__:null,base10:Ov});const Pv=dt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xv=dt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Rv=Object.freeze({__proto__:null,base16:Pv,base16upper:xv});const Tv=dt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Av=dt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Lv=dt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Cv=dt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Uv=dt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Mv=dt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),kv=dt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Dv=dt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),jv=dt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var zv=Object.freeze({__proto__:null,base32:Tv,base32upper:Av,base32pad:Lv,base32padupper:Cv,base32hex:Uv,base32hexupper:Mv,base32hexpad:kv,base32hexpadupper:Dv,base32z:jv});const qv=Pr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),$v=Pr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Vv=Object.freeze({__proto__:null,base36:qv,base36upper:$v});const Kv=Pr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Hv=Pr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Fv=Object.freeze({__proto__:null,base58btc:Kv,base58flickr:Hv});const Bv=dt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wv=dt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Gv=dt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yv=dt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Jv=Object.freeze({__proto__:null,base64:Bv,base64pad:Wv,base64url:Gv,base64urlpad:Yv});const Th=Array.from(""),Qv=Th.reduce((t,e,s)=>(t[s]=e,t),[]),Xv=Th.reduce((t,e,s)=>(t[e.codePointAt(0)]=s,t),[]);function Zv(t){return t.reduce((e,s)=>(e+=Qv[s],e),"")}function e_(t){const e=[];for(const s of t){const r=Xv[s.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${s}`);e.push(r)}return new Uint8Array(e)}const t_=fi({prefix:"",name:"base256emoji",encode:Zv,decode:e_});var s_=Object.freeze({__proto__:null,base256emoji:t_}),r_=Ah,Pa=128,i_=127,n_=~i_,o_=Math.pow(2,31);function Ah(t,e,s){e=e||[],s=s||0;for(var r=s;t>=o_;)e[s++]=t&255|Pa,t/=128;for(;t&n_;)e[s++]=t&255|Pa,t>>>=7;return e[s]=t|0,Ah.bytes=s-r+1,e}var a_=Yi,c_=128,xa=127;function Yi(t,r){var s=0,r=r||0,i=0,n=r,c,a=t.length;do{if(n>=a)throw Yi.bytes=0,new RangeError("Could not decode varint");c=t[n++],s+=i<28?(c&xa)<<i:(c&xa)*Math.pow(2,i),i+=7}while(c>=c_);return Yi.bytes=n-r,s}var h_=Math.pow(2,7),l_=Math.pow(2,14),u_=Math.pow(2,21),p_=Math.pow(2,28),d_=Math.pow(2,35),g_=Math.pow(2,42),f_=Math.pow(2,49),y_=Math.pow(2,56),m_=Math.pow(2,63),w_=function(t){return t<h_?1:t<l_?2:t<u_?3:t<p_?4:t<d_?5:t<g_?6:t<f_?7:t<y_?8:t<m_?9:10},b_={encode:r_,decode:a_,encodingLength:w_},Lh=b_;const Ra=(t,e,s=0)=>(Lh.encode(t,e,s),e),Ta=t=>Lh.encodingLength(t),Ji=(t,e)=>{const s=e.byteLength,r=Ta(t),i=r+Ta(s),n=new Uint8Array(i+s);return Ra(t,n,0),Ra(s,n,r),n.set(e,i),new v_(t,s,e,n)};class v_{constructor(e,s,r,i){this.code=e,this.size=s,this.digest=r,this.bytes=i}}const Ch=({name:t,code:e,encode:s})=>new __(t,e,s);class __{constructor(e,s,r){this.name=e,this.code=s,this.encode=r}digest(e){if(e instanceof Uint8Array){const s=this.encode(e);return s instanceof Uint8Array?Ji(this.code,s):s.then(r=>Ji(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Uh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),E_=Ch({name:"sha2-256",code:18,encode:Uh("SHA-256")}),S_=Ch({name:"sha2-512",code:19,encode:Uh("SHA-512")});var I_=Object.freeze({__proto__:null,sha256:E_,sha512:S_});const Mh=0,O_="identity",kh=xh,N_=t=>Ji(Mh,kh(t)),P_={code:Mh,name:O_,encode:kh,digest:N_};var x_=Object.freeze({__proto__:null,identity:P_});new TextEncoder,new TextDecoder;const Aa={...vv,...Ev,...Iv,...Nv,...Rv,...zv,...Vv,...Fv,...Jv,...s_};({...I_,...x_});function Dh(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function R_(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Dh(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function jh(t,e,s,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:r}}}const La=jh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Pi=jh("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);const e=R_(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),T_={utf8:La,"utf-8":La,hex:Aa.base16,latin1:Pi,ascii:Pi,binary:Pi,...Aa};function A_(t,e="utf8"){const s=T_[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Dh(globalThis.Buffer.from(t,"utf-8")):s.decoder.decode(`${s.prefix}${t}`)}const zh="wc",L_=2,Nn="core",ps=`${zh}@2:${Nn}:`,C_={name:Nn,logger:"error"},U_={database:":memory:"},M_="crypto",Ca="client_ed25519_seed",k_=K.ONE_DAY,D_="keychain",j_="0.3",z_="messages",q_="0.3",$_=K.SIX_HOURS,V_="publisher",qh="irn",K_="error",$h="wss://relay.walletconnect.com",H_="relayer",We={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},F_="_subscription",rr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},B_=K.ONE_SECOND/2,W_="y",G_=1e4,Y_="0.3",Bt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},J_="subscription",Q_="0.3",X_=K.FIVE_SECONDS*1e3,Z_="pairing",e0="0.3",ir={wc_pairingDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:K.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:K.ONE_DAY,prompt:!1,tag:0},res:{ttl:K.ONE_DAY,prompt:!1,tag:0}}},Ht={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},t0="history",s0="0.3",r0="expirer",kt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},i0="0.3",xi="verify-api",Ua="https://verify.walletconnect.com";class n0{constructor(e,s){this.core=e,this.logger=s,this.keychain=new Map,this.name=D_,this.version=j_,this.initialized=!1,this.storagePrefix=ps,this.init=async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}},this.has=r=>(this.isInitialized(),this.keychain.has(r)),this.set=async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()},this.get=r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i},this.del=async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()},this.core=e,this.logger=ee.generateChildLogger(s,this.name)}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Eh(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Sh(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class o0{constructor(e,s,r){this.core=e,this.logger=s,this.name=M_,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=i=>(this.isInitialized(),this.keychain.has(i)),this.getClientId=async()=>{this.isInitialized();const i=await this.getClientSeed(),n=Jr(i);return tn(n.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const i=tb();return this.setPrivateKey(i.publicKey,i.privateKey)},this.signJWT=async i=>{this.isInitialized();const n=await this.getClientSeed(),c=Jr(n),a=Wi();return await Nc(a,i,k_,c)},this.generateSharedKey=(i,n,c)=>{this.isInitialized();const a=this.getPrivateKey(i),l=sb(a,n);return this.setSymKey(l,c)},this.setSymKey=async(i,n)=>{this.isInitialized();const c=n||rb(i);return await this.keychain.set(c,i),c},this.deleteKeyPair=async i=>{this.isInitialized(),await this.keychain.del(i)},this.deleteSymKey=async i=>{this.isInitialized(),await this.keychain.del(i)},this.encode=async(i,n,c)=>{this.isInitialized();const a=vh(c),l=oi(n);if(ma(a)){const A=a.senderPublicKey,N=a.receiverPublicKey;i=await this.generateSharedKey(A,N)}const d=this.getSymKey(i),{type:g,senderPublicKey:m}=a;return nb({type:g,symKey:d,message:l,senderPublicKey:m})},this.decode=async(i,n,c)=>{this.isInitialized();const a=cb(n,c);if(ma(a)){const g=a.receiverPublicKey,m=a.senderPublicKey;i=await this.generateSharedKey(g,m)}const l=this.getSymKey(i),d=ob({symKey:l,encoded:n});return Xi(d)},this.getPayloadType=i=>{const n=ti(i);return Or(n.type)},this.getPayloadSenderPublicKey=i=>{const n=ti(i);return n.senderPublicKey?xe(n.senderPublicKey,vt):void 0},this.core=e,this.logger=ee.generateChildLogger(s,this.name),this.keychain=r||new n0(this.core,this.logger)}get context(){return ee.getLoggerContext(this.logger)}async setPrivateKey(e,s){return await this.keychain.set(e,s),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ca)}catch{e=Wi(),await this.keychain.set(Ca,e)}return A_(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class a0 extends Dw{constructor(e,s){super(e,s),this.logger=e,this.core=s,this.messages=new Map,this.name=z_,this.version=q_,this.initialized=!1,this.storagePrefix=ps,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}},this.set=async(r,i)=>{this.isInitialized();const n=js(i);let c=this.messages.get(r);return typeof c>"u"&&(c={}),typeof c[n]<"u"||(c[n]=i,this.messages.set(r,c),await this.persist()),n},this.get=r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i},this.has=(r,i)=>{this.isInitialized();const n=this.get(r),c=js(i);return typeof n[c]<"u"},this.del=async r=>{this.isInitialized(),this.messages.delete(r),await this.persist()},this.logger=ee.generateChildLogger(e,this.name),this.core=s}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Eh(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Sh(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class c0 extends jw{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,this.events=new Ye.EventEmitter,this.name=V_,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(r,i,n)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:n}});try{const c=(n==null?void 0:n.ttl)||$_,a=Gi(n),l=(n==null?void 0:n.prompt)||!1,d=(n==null?void 0:n.tag)||0,g=(n==null?void 0:n.id)||fn().toString(),m={topic:r,message:i,opts:{ttl:c,relay:a,prompt:l,tag:d,id:g}};this.queue.set(g,m);try{await await si(this.rpcPublish(r,i,c,a,l,d,g),this.publishTimeout),this.relayer.events.emit(We.publish,m)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(We.connection_stalled);return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:n}})}catch(c){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(c),c}},this.on=(r,i)=>{this.events.on(r,i)},this.once=(r,i)=>{this.events.once(r,i)},this.off=(r,i)=>{this.events.off(r,i)},this.removeListener=(r,i)=>{this.events.removeListener(r,i)},this.relayer=e,this.logger=ee.generateChildLogger(s,this.name),this.registerEventListeners()}get context(){return ee.getLoggerContext(this.logger)}rpcPublish(e,s,r,i,n,c,a){var l,d,g,m;const A={method:Fr(i.protocol).publish,params:{topic:e,message:s,ttl:r,prompt:n,tag:c},id:a};return Ot((l=A.params)==null?void 0:l.prompt)&&((d=A.params)==null||delete d.prompt),Ot((g=A.params)==null?void 0:g.tag)&&((m=A.params)==null||delete m.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:A}),this.relayer.request(A)}onPublish(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:s,message:r,opts:i}=e;await this.publish(s,r,i)})}registerEventListeners(){this.relayer.core.heartbeat.on(Jt.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()}),this.relayer.on(We.message_ack,e=>{this.onPublish(e.id.toString())})}}class h0{constructor(){this.map=new Map,this.set=(e,s)=>{const r=this.get(e);this.exists(e,s)||this.map.set(e,[...r,s])},this.get=e=>this.map.get(e)||[],this.exists=(e,s)=>this.get(e).includes(s),this.delete=(e,s)=>{if(typeof s>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,s))return;const i=r.filter(n=>n!==s);if(!i.length){this.map.delete(e);return}this.map.set(e,i)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var l0=Object.defineProperty,u0=Object.defineProperties,p0=Object.getOwnPropertyDescriptors,Ma=Object.getOwnPropertySymbols,d0=Object.prototype.hasOwnProperty,g0=Object.prototype.propertyIsEnumerable,ka=(t,e,s)=>e in t?l0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,nr=(t,e)=>{for(var s in e||(e={}))d0.call(e,s)&&ka(t,s,e[s]);if(Ma)for(var s of Ma(e))g0.call(e,s)&&ka(t,s,e[s]);return t},Ri=(t,e)=>u0(t,p0(e));class f0 extends $w{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,this.subscriptions=new Map,this.topicMap=new h0,this.events=new Ye.EventEmitter,this.name=J_,this.version=Q_,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ps,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(r,i)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const n=Gi(i),c={topic:r,relay:n};this.pending.set(r,c);const a=await this.rpcSubscribe(r,n);return this.onSubscribe(a,c),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}}),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}},this.unsubscribe=async(r,i)=>{await this.restartToComplete(),this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)},this.isSubscribed=async r=>this.topics.includes(r)?!0:await new Promise((i,n)=>{const c=new K.Watch;c.start(this.pendingSubscriptionWatchLabel);const a=setInterval(()=>{!this.pending.has(r)&&this.topics.includes(r)&&(clearInterval(a),c.stop(this.pendingSubscriptionWatchLabel),i(!0)),c.elapsed(this.pendingSubscriptionWatchLabel)>=X_&&(clearInterval(a),c.stop(this.pendingSubscriptionWatchLabel),n(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(r,i)=>{this.events.on(r,i)},this.once=(r,i)=>{this.events.once(r,i)},this.off=(r,i)=>{this.events.off(r,i)},this.removeListener=(r,i)=>{this.events.removeListener(r,i)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=ee.generateChildLogger(s,this.name),this.clientId=""}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,s){let r=!1;try{r=this.getSubscription(e).topic===s}catch{}return r}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,s){const r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,s)))}async unsubscribeById(e,s,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:r}});try{const i=Gi(r);await this.rpcUnsubscribe(e,s,i);const n=Qe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,s,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,s){const r={method:Fr(s.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await si(this.relayer.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(We.connection_stalled)}return js(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const s=e[0].relay,r={method:Fr(s.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{return await await si(this.relayer.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(We.connection_stalled)}}rpcUnsubscribe(e,s,r){const i={method:Fr(r.protocol).unsubscribe,params:{topic:e,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,s){this.setSubscription(e,Ri(nr({},s),{id:e})),this.pending.delete(s.topic)}onBatchSubscribe(e){e.length&&e.forEach(s=>{this.setSubscription(s.id,nr({},s)),this.pending.delete(s.topic)})}async onUnsubscribe(e,s,r){this.events.removeAllListeners(s),this.hasSubscription(s,e)&&this.deleteSubscription(s,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,s){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:s}),this.addSubscription(e,s))}addSubscription(e,s){this.subscriptions.set(e,nr({},s)),this.topicMap.set(s.topic,e),this.events.emit(Bt.created,s)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const s=this.subscriptions.get(e);if(!s){const{message:r}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return s}deleteSubscription(e,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:s});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Bt.deleted,Ri(nr({},r),{reason:s}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Bt.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<e;s++){const r=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(r)}}this.events.emit(Bt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:s}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const s=await this.rpcBatchSubscribe(e);Nr(s)&&this.onBatchSubscribe(s.map((r,i)=>Ri(nr({},e[i]),{id:r})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(s=>{e.push(s)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Jt.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(We.connect,async()=>{await this.onConnect()}),this.relayer.on(We.disconnect,()=>{this.onDisconnect()}),this.events.on(Bt.created,async e=>{const s=Bt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),await this.persist()}),this.events.on(Bt.deleted,async e=>{const s=Bt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const s=setInterval(()=>{this.restartInProgress||(clearInterval(s),e())},this.pollingInterval)})}}var y0=Object.defineProperty,Da=Object.getOwnPropertySymbols,m0=Object.prototype.hasOwnProperty,w0=Object.prototype.propertyIsEnumerable,ja=(t,e,s)=>e in t?y0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,b0=(t,e)=>{for(var s in e||(e={}))m0.call(e,s)&&ja(t,s,e[s]);if(Da)for(var s of Da(e))w0.call(e,s)&&ja(t,s,e[s]);return t};class v0 extends zw{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Ye.EventEmitter,this.name=H_,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async s=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(s)}catch(r){throw this.logger.debug("Failed to Publish Request"),this.logger.error(r),r}},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?ee.generateChildLogger(e.logger,this.name):ee.pino(ee.getDefaultLoggerOptions({level:e.logger||K_})),this.messages=new a0(this.logger,e.core),this.subscriber=new f0(this,this.logger),this.publisher=new c0(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||$h,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribted to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},G_)}get context(){return ee.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,s,r){this.isInitialized(),await this.publisher.publish(e,s,r),await this.recordMessageEvent({topic:e,message:s,publishedAt:Date.now()})}async subscribe(e,s){this.isInitialized();let r="";return await Promise.all([new Promise(i=>{this.subscriber.once(Bt.created,n=>{n.topic===e&&i()})}),new Promise(async i=>{r=await this.subscriber.subscribe(e,s),i()})]),r}async unsubscribe(e,s){this.isInitialized(),await this.subscriber.unsubscribe(e,s)}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(We.transport_closed))}async transportOpen(e){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=e||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(s=>{this.initialized||s(),this.subscriber.once(Bt.resubscribed,()=>{s()})}),await Promise.race([new Promise(async(s,r)=>{await si(this.provider.connect(),5e3,"socket stalled").catch(i=>r(i)).then(()=>s()).finally(()=>this.removeListener(We.transport_closed,this.rejectTransportOpen))}),new Promise(s=>this.once(We.transport_closed,this.rejectTransportOpen))])])}catch(s){this.logger.error(s);const r=s;if(!this.isConnectionStalled(r.message))throw s;this.events.emit(We.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||(this.relayUrl=e||this.relayUrl,this.connected&&await Promise.all([new Promise(s=>{this.provider.once(rr.disconnect,()=>{s()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(e){return this.staleConnectionErrors.some(s=>e.includes(s))}rejectTransportOpen(){throw new Error("closeTransport called before connection was established")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new yn(new Jc(vb({sdkVersion:W_,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:s,message:r}=e;await this.messages.set(s,r)}async shouldIgnoreMessageEvent(e){const{topic:s,message:r}=e;return await this.subscriber.isSubscribed(s)?this.messages.has(s,r):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Vs(e)){if(!e.method.endsWith(F_))return;const s=e.params,{topic:r,message:i,publishedAt:n}=s.data,c={topic:r,message:i,publishedAt:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(b0({type:"event",event:s.id},c)),this.events.emit(s.id,c),await this.acknowledgePayload(e),await this.onMessageEvent(c)}else Ps(e)&&this.events.emit(We.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(We.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const s=Ns(e.id,!0);await this.provider.connection.send(s)}registerProviderListeners(){this.provider.on(rr.payload,e=>this.onProviderPayload(e)),this.provider.on(rr.connect,()=>{this.events.emit(We.connect)}),this.provider.on(rr.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(rr.error,e=>{this.logger.error(e),this.events.emit(We.error,e)})}registerEventListeners(){this.events.on(We.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(We.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},K.toMiliseconds(B_))}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(e=>{const s=setInterval(()=>{this.connected&&(clearInterval(s),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var _0=Object.defineProperty,za=Object.getOwnPropertySymbols,E0=Object.prototype.hasOwnProperty,S0=Object.prototype.propertyIsEnumerable,qa=(t,e,s)=>e in t?_0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,$a=(t,e)=>{for(var s in e||(e={}))E0.call(e,s)&&qa(t,s,e[s]);if(za)for(var s of za(e))S0.call(e,s)&&qa(t,s,e[s]);return t};class yi extends qw{constructor(e,s,r,i=ps,n=void 0){super(e,s,r,i),this.core=e,this.logger=s,this.name=r,this.map=new Map,this.version=Y_,this.cached=[],this.initialized=!1,this.storagePrefix=ps,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(c=>{this.getKey&&c!==null&&!Ot(c)?this.map.set(this.getKey(c),c):Vb(c)?this.map.set(c.id,c):Kb(c)&&this.map.set(c.topic,c)}),this.cached=[],this.initialized=!0)},this.set=async(c,a)=>{this.isInitialized(),this.map.has(c)?await this.update(c,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:c,value:a}),this.map.set(c,a),await this.persist())},this.get=c=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:c}),this.getData(c)),this.getAll=c=>(this.isInitialized(),c?this.values.filter(a=>Object.keys(c).every(l=>Qc(a[l],c[l]))):this.values),this.update=async(c,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:c,update:a});const l=$a($a({},this.getData(c)),a);this.map.set(c,l),await this.persist()},this.delete=async(c,a)=>{this.isInitialized(),this.map.has(c)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:c,reason:a}),this.map.delete(c),await this.persist())},this.logger=ee.generateChildLogger(s,this.name),this.storagePrefix=i,this.getKey=n}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const s=this.map.get(e);if(!s){const{message:r}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return s}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:s}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class I0{constructor(e,s){this.core=e,this.logger=s,this.name=Z_,this.version=e0,this.events=new ii,this.initialized=!1,this.storagePrefix=ps,this.ignoredPayloadTypes=[xs],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]},this.create=async()=>{this.isInitialized();const r=Wi(),i=await this.core.crypto.setSymKey(r),n=Gt(K.FIVE_MINUTES),c={protocol:qh},a={topic:i,expiry:n,relay:c,active:!1},l=Lb({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:r,relay:c});return await this.pairings.set(i,a),await this.core.relayer.subscribe(i),this.core.expirer.set(i,n),{topic:i,uri:l}},this.pair=async r=>{this.isInitialized(),this.isValidPair(r);const{topic:i,symKey:n,relay:c}=Rb(r.uri);if(this.pairings.keys.includes(i))throw new Error(`Pairing already exists: ${i}`);if(this.core.crypto.hasKeys(i))throw new Error(`Keychain already exists: ${i}`);const a=Gt(K.FIVE_MINUTES),l={topic:i,relay:c,expiry:a,active:!1};return await this.pairings.set(i,l),await this.core.crypto.setSymKey(n,i),await this.core.relayer.subscribe(i,{relay:c}),this.core.expirer.set(i,a),r.activatePairing&&await this.activate({topic:i}),l},this.activate=async({topic:r})=>{this.isInitialized();const i=Gt(K.THIRTY_DAYS);await this.pairings.update(r,{active:!0,expiry:i}),this.core.expirer.set(r,i)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.pairings.keys.includes(i)){const n=await this.sendRequest(i,"wc_pairingPing",{}),{done:c,resolve:a,reject:l}=Ms();this.events.once(Be("pairing_ping",n),({error:d})=>{d?l(d):a()}),await c()}},this.updateExpiry=async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})},this.updateMetadata=async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Qe("USER_DISCONNECTED")),await this.deletePairing(i))},this.sendRequest=async(r,i,n)=>{const c=rs(i,n),a=await this.core.crypto.encode(r,c),l=ir[i].req;return this.core.history.set(r,c),this.core.relayer.publish(r,a,l),c.id},this.sendResult=async(r,i,n)=>{const c=Ns(r,n),a=await this.core.crypto.encode(i,c),l=await this.core.history.get(i,r),d=ir[l.request.method].res;await this.core.relayer.publish(i,a,d),await this.core.history.resolve(c)},this.sendError=async(r,i,n)=>{const c=$s(r,n),a=await this.core.crypto.encode(i,c),l=await this.core.history.get(i,r),d=ir[l.request.method]?ir[l.request.method].res:ir.unregistered_method.res;await this.core.relayer.publish(i,a,d),await this.core.history.resolve(c)},this.deletePairing=async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Qe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])},this.cleanup=async()=>{const r=this.pairings.getAll().filter(i=>ls(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))},this.onRelayEventRequest=r=>{const{topic:i,payload:n}=r,c=n.method;if(this.pairings.keys.includes(i))switch(c){case"wc_pairingPing":return this.onPairingPingRequest(i,n);case"wc_pairingDelete":return this.onPairingDeleteRequest(i,n);default:return this.onUnknownRpcMethodRequest(i,n)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,c=(await this.core.history.get(i,n.id)).request.method;if(this.pairings.keys.includes(i))switch(c){case"wc_pairingPing":return this.onPairingPingResponse(i,n);default:return this.onUnknownRpcMethodResponse(c)}},this.onPairingPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.events.emit("pairing_ping",{id:n,topic:r})}catch(c){await this.sendError(n,r,c),this.logger.error(c)}},this.onPairingPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{lt(i)?this.events.emit(Be("pairing_ping",n),{}):Ge(i)&&this.events.emit(Be("pairing_ping",n),{error:i.error})},500)},this.onPairingDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit("pairing_delete",{id:n,topic:r})}catch(c){await this.sendError(n,r,c),this.logger.error(c)}},this.onUnknownRpcMethodRequest=async(r,i)=>{const{id:n,method:c}=i;try{if(this.registeredMethods.includes(c))return;const a=Qe("WC_METHOD_UNSUPPORTED",c);await this.sendError(n,r,a),this.logger.error(a)}catch(a){await this.sendError(n,r,a),this.logger.error(a)}},this.onUnknownRpcMethodResponse=r=>{this.registeredMethods.includes(r)||this.logger.error(Qe("WC_METHOD_UNSUPPORTED",r))},this.isValidPair=r=>{if(!St(r)){const{message:i}=J("MISSING_OR_INVALID",`pair() params: ${r}`);throw new Error(i)}if(!$b(r.uri)){const{message:i}=J("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw new Error(i)}},this.isValidPing=async r=>{if(!St(r)){const{message:n}=J("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidPairingTopic(i)},this.isValidDisconnect=async r=>{if(!St(r)){const{message:n}=J("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidPairingTopic(i)},this.isValidPairingTopic=async r=>{if(!ct(r,!1)){const{message:i}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(ls(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=J("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}},this.core=e,this.logger=ee.generateChildLogger(s,this.name),this.pairings=new yi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ee.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(We.message,async e=>{const{topic:s,message:r}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))return;const i=await this.core.crypto.decode(s,r);Vs(i)?(this.core.history.set(s,i),this.onRelayEventRequest({topic:s,payload:i})):Ps(i)&&(await this.core.history.resolve(i),this.onRelayEventResponse({topic:s,payload:i}))})}registerExpirerEvents(){this.core.expirer.on(kt.expired,async e=>{const{topic:s}=Oh(e.target);s&&this.pairings.keys.includes(s)&&(await this.deletePairing(s,!0),this.events.emit("pairing_expire",{topic:s}))})}}class O0 extends kw{constructor(e,s){super(e,s),this.core=e,this.logger=s,this.records=new Map,this.events=new Ye.EventEmitter,this.name=t0,this.version=s0,this.cached=[],this.initialized=!1,this.storagePrefix=ps,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(r,i,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:n}),this.records.has(i.id))return;const c={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:n};this.records.set(c.id,c),this.events.emit(Ht.created,c)},this.resolve=async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=Ge(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.events.emit(Ht.updated,i))},this.get=async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i)),this.delete=(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(n=>{if(n.topic===r){if(typeof i<"u"&&n.id!==i)return;this.records.delete(n.id),this.events.emit(Ht.deleted,n)}})},this.exists=async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1),this.on=(r,i)=>{this.events.on(r,i)},this.once=(r,i)=>{this.events.once(r,i)},this.off=(r,i)=>{this.events.off(r,i)},this.removeListener=(r,i)=>{this.events.removeListener(r,i)},this.logger=ee.generateChildLogger(s,this.name)}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;const r={topic:s.topic,request:rs(s.request.method,s.request.params,s.id),chainId:s.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const s=this.records.get(e);if(!s){const{message:r}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return s}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ht.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:s}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ht.created,e=>{const s=Ht.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e}),this.persist()}),this.events.on(Ht.updated,e=>{const s=Ht.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e}),this.persist()}),this.events.on(Ht.deleted,e=>{const s=Ht.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class N0 extends Vw{constructor(e,s){super(e,s),this.core=e,this.logger=s,this.expirations=new Map,this.events=new Ye.EventEmitter,this.name=r0,this.version=i0,this.cached=[],this.initialized=!1,this.storagePrefix=ps,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}},this.set=(r,i)=>{this.isInitialized();const n=this.formatTarget(r),c={target:n,expiry:i};this.expirations.set(n,c),this.checkExpiry(n,c),this.events.emit(kt.created,{target:n,expiration:c})},this.get=r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)},this.del=r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),n=this.getExpiration(i);this.expirations.delete(i),this.events.emit(kt.deleted,{target:i,expiration:n})}},this.on=(r,i)=>{this.events.on(r,i)},this.once=(r,i)=>{this.events.once(r,i)},this.off=(r,i)=>{this.events.off(r,i)},this.removeListener=(r,i)=>{this.events.removeListener(r,i)},this.logger=ee.generateChildLogger(s,this.name)}get context(){return ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return _b(e);if(typeof e=="number")return Eb(e);const{message:s}=J("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(s)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(kt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:s}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const s=this.expirations.get(e);if(!s){const{message:r}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return s}checkExpiry(e,s){const{expiry:r}=s;K.toMiliseconds(r)-Date.now()<=0&&this.expire(e,s)}expire(e,s){this.expirations.delete(e),this.events.emit(kt.expired,{target:e,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,s)=>this.checkExpiry(s,e))}registerEventListeners(){this.core.heartbeat.on(Jt.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(kt.created,e=>{const s=kt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(kt.expired,e=>{const s=kt.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(kt.deleted,e=>{const s=kt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class P0 extends Kw{constructor(e,s){super(e,s),this.projectId=e,this.logger=s,this.name=xi,this.initialized=!1,this.init=async r=>{_h()||!Sn()||(this.verifyUrl=(r==null?void 0:r.verifyUrl)||Ua,await this.createIframe())},this.register=async r=>{var i;this.initialized||await this.init(),this.iframe&&((i=this.iframe.contentWindow)==null||i.postMessage(r.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${r.attestationId} ${this.verifyUrl}`))},this.resolve=async r=>{var i;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${r.attestationId}`);const n=this.startAbortTimer(K.FIVE_SECONDS),c=await fetch(`${this.verifyUrl}/attestation/${r.attestationId}`,{signal:this.abortController.signal});return clearTimeout(n),c.status===200?(i=await c.json())==null?void 0:i.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((r,i)=>{if(document.getElementById(xi))return r();const n=document.createElement("iframe");n.setAttribute("id",xi),n.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),n.style.display="none",n.addEventListener("load",()=>{this.initialized=!0,r()}),n.addEventListener("error",c=>{i(c)}),document.body.append(n),this.iframe=n}),new Promise(r=>{setTimeout(()=>r("iframe load timeout"),K.toMiliseconds(K.ONE_SECOND/2))})])}catch(r){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(r)}},this.logger=ee.generateChildLogger(s,this.name),this.verifyUrl=Ua,this.abortController=new AbortController,this.isDevEnv=En()&&Ja.IS_VITEST}get context(){return ee.getLoggerContext(this.logger)}startAbortTimer(e){return setTimeout(()=>this.abortController.abort(),K.toMiliseconds(e))}}var x0=Object.defineProperty,Va=Object.getOwnPropertySymbols,R0=Object.prototype.hasOwnProperty,T0=Object.prototype.propertyIsEnumerable,Ka=(t,e,s)=>e in t?x0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ha=(t,e)=>{for(var s in e||(e={}))R0.call(e,s)&&Ka(t,s,e[s]);if(Va)for(var s of Va(e))T0.call(e,s)&&Ka(t,s,e[s]);return t};let A0=class Vh extends Mw{constructor(e){super(e),this.protocol=zh,this.version=L_,this.name=Nn,this.events=new Ye.EventEmitter,this.initialized=!1,this.on=(r,i)=>this.events.on(r,i),this.once=(r,i)=>this.events.once(r,i),this.off=(r,i)=>this.events.off(r,i),this.removeListener=(r,i)=>this.events.removeListener(r,i),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||$h;const s=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:ee.pino(ee.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||C_.logger}));this.logger=ee.generateChildLogger(s,this.name),this.heartbeat=new Jt.HeartBeat,this.crypto=new o0(this,this.logger,e==null?void 0:e.keychain),this.history=new O0(this,this.logger),this.expirer=new N0(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new ac(Ha(Ha({},U_),e==null?void 0:e.storageOptions)),this.relayer=new v0({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new I0(this,this.logger),this.verify=new P0(this.projectId||"",this.logger)}static async init(e){const s=new Vh(e);return await s.initialize(),s}get context(){return ee.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const L0=A0,Kh="wc",Hh=2,Fh="client",Pn=`${Kh}@${Hh}:${Fh}:`,Ti={name:Fh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},C0="proposal",U0="Proposal expired",M0="session",zr=K.SEVEN_DAYS,k0="engine",or={wc_sessionPropose:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1104},res:{ttl:K.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1106},res:{ttl:K.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1112},res:{ttl:K.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ai={min:K.FIVE_MINUTES,max:K.SEVEN_DAYS},D0="request",j0=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var z0=Object.defineProperty,q0=Object.defineProperties,$0=Object.getOwnPropertyDescriptors,Fa=Object.getOwnPropertySymbols,V0=Object.prototype.hasOwnProperty,K0=Object.prototype.propertyIsEnumerable,Ba=(t,e,s)=>e in t?z0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ut=(t,e)=>{for(var s in e||(e={}))V0.call(e,s)&&Ba(t,s,e[s]);if(Fa)for(var s of Fa(e))K0.call(e,s)&&Ba(t,s,e[s]);return t},Li=(t,e)=>q0(t,$0(e));class H0 extends Fw{constructor(e){super(e),this.name=k0,this.events=new ii,this.initialized=!1,this.ignoredPayloadTypes=[xs],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(or)}),this.initialized=!0)},this.connect=async s=>{this.isInitialized();const r=Li(Ut({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:c,sessionProperties:a,relays:l}=r;let d=i,g,m=!1;if(d&&(m=this.client.core.pairing.pairings.get(d).active),!d||!m){const{topic:O,uri:y}=await this.client.core.pairing.create();d=O,g=y}const A=await this.client.core.crypto.generateKeyPair(),N=Ut({requiredNamespaces:n,optionalNamespaces:c,relays:l??[{protocol:qh}],proposer:{publicKey:A,metadata:this.client.metadata}},a&&{sessionProperties:a}),{reject:I,resolve:x,done:k}=Ms(K.FIVE_MINUTES,U0);if(this.events.once(Be("session_connect"),async({error:O,session:y})=>{if(O)I(O);else if(y){y.self.publicKey=A;const v=Li(Ut({},y),{requiredNamespaces:y.requiredNamespaces,optionalNamespaces:y.optionalNamespaces});await this.client.session.set(y.topic,v),await this.setExpiry(y.topic,y.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:y.peer.metadata}),x(v)}}),!d){const{message:O}=J("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(O)}const F=await this.sendRequest(d,"wc_sessionPropose",N),S=Gt(K.FIVE_MINUTES);return await this.setProposal(F,Ut({id:F,expiry:S},N)),{uri:g,approval:k}},this.pair=async s=>(this.isInitialized(),await this.client.core.pairing.pair(s)),this.approve=async s=>{this.isInitialized(),await this.isValidApprove(s);const{id:r,relayProtocol:i,namespaces:n,sessionProperties:c}=s,a=this.client.proposal.get(r);let{pairingTopic:l,proposer:d,requiredNamespaces:g,optionalNamespaces:m}=a;l=l||"",ur(g)||(g=kb(n,"approve()"));const A=await this.client.core.crypto.generateKeyPair(),N=d.publicKey,I=await this.client.core.crypto.generateSharedKey(A,N);l&&r&&(await this.client.core.pairing.updateMetadata({topic:l,metadata:d.metadata}),await this.sendResult(r,l,{relay:{protocol:i??"irn"},responderPublicKey:A}),await this.client.proposal.delete(r,Qe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:l}));const x=Ut({relay:{protocol:i??"irn"},namespaces:n,requiredNamespaces:g,optionalNamespaces:m,pairingTopic:l,controller:{publicKey:A,metadata:this.client.metadata},expiry:Gt(zr)},c&&{sessionProperties:c});await this.client.core.relayer.subscribe(I),await this.sendRequest(I,"wc_sessionSettle",x);const k=Li(Ut({},x),{topic:I,pairingTopic:l,acknowledged:!1,self:x.controller,peer:{publicKey:d.publicKey,metadata:d.metadata},controller:A});return await this.client.session.set(I,k),await this.setExpiry(I,Gt(zr)),{topic:I,acknowledged:()=>new Promise(F=>setTimeout(()=>F(this.client.session.get(I)),500))}},this.reject=async s=>{this.isInitialized(),await this.isValidReject(s);const{id:r,reason:i}=s,{pairingTopic:n}=this.client.proposal.get(r);n&&(await this.sendError(r,n,i),await this.client.proposal.delete(r,Qe("USER_DISCONNECTED")))},this.update=async s=>{this.isInitialized(),await this.isValidUpdate(s);const{topic:r,namespaces:i}=s,n=await this.sendRequest(r,"wc_sessionUpdate",{namespaces:i}),{done:c,resolve:a,reject:l}=Ms();return this.events.once(Be("session_update",n),({error:d})=>{d?l(d):a()}),await this.client.session.update(r,{namespaces:i}),{acknowledged:c}},this.extend=async s=>{this.isInitialized(),await this.isValidExtend(s);const{topic:r}=s,i=await this.sendRequest(r,"wc_sessionExtend",{}),{done:n,resolve:c,reject:a}=Ms();return this.events.once(Be("session_extend",i),({error:l})=>{l?a(l):c()}),await this.setExpiry(r,Gt(zr)),{acknowledged:n}},this.request=async s=>{this.isInitialized(),await this.isValidRequest(s);const{chainId:r,request:i,topic:n,expiry:c}=s,a=await this.sendRequest(n,"wc_sessionRequest",{request:i,chainId:r},c),{done:l,resolve:d,reject:g}=Ms(c);return this.events.once(Be("session_request",a),({error:m,result:A})=>{m?g(m):d(A)}),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:r,id:a}),await l()},this.respond=async s=>{this.isInitialized(),await this.isValidRespond(s);const{topic:r,response:i}=s,{id:n}=i;lt(i)?await this.sendResult(n,r,i.result):Ge(i)&&await this.sendError(n,r,i.error),this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0})},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:r}=s;if(this.client.session.keys.includes(r)){const i=await this.sendRequest(r,"wc_sessionPing",{}),{done:n,resolve:c,reject:a}=Ms();this.events.once(Be("session_ping",i),({error:l})=>{l?a(l):c()}),await n()}else this.client.core.pairing.pairings.keys.includes(r)&&await this.client.core.pairing.ping({topic:r})},this.emit=async s=>{this.isInitialized(),await this.isValidEmit(s);const{topic:r,event:i,chainId:n}=s;await this.sendRequest(r,"wc_sessionEvent",{event:i,chainId:n})},this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:r}=s;this.client.session.keys.includes(r)?(await this.sendRequest(r,"wc_sessionDelete",Qe("USER_DISCONNECTED")),await this.deleteSession(r)):await this.client.core.pairing.disconnect({topic:r})},this.find=s=>(this.isInitialized(),this.client.session.getAll().filter(r=>zb(r,s))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async s=>{try{const r=this.client.core.pairing.pairings.get(s.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(n=>{var c,a;return((c=n.peerMetadata)==null?void 0:c.url)&&((a=n.peerMetadata)==null?void 0:a.url)===s.self.metadata.url&&n.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}},this.deleteSession=async(s,r)=>{const{self:i}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await Promise.all([this.client.session.delete(s,Qe("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(i.publicKey),this.client.core.crypto.deleteSymKey(s),r?Promise.resolve():this.client.core.expirer.del(s)])},this.deleteProposal=async(s,r)=>{await Promise.all([this.client.proposal.delete(s,Qe("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(s)])},this.deletePendingSessionRequest=async(s,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(s,r),i?Promise.resolve():this.client.core.expirer.del(s)])},this.setExpiry=async(s,r)=>{this.client.session.keys.includes(s)&&await this.client.session.update(s,{expiry:r}),this.client.core.expirer.set(s,r)},this.setProposal=async(s,r)=>{await this.client.proposal.set(s,r),this.client.core.expirer.set(s,r.expiry)},this.setPendingSessionRequest=async s=>{const r=or.wc_sessionRequest.req.ttl,{id:i,topic:n,params:c}=s;await this.client.pendingRequest.set(i,{id:i,topic:n,params:c}),r&&this.client.core.expirer.set(i,Gt(r))},this.sendRequest=async(s,r,i,n)=>{const c=rs(r,i);if(Sn()&&j0.includes(r)){const d=js(JSON.stringify(c));await this.client.core.verify.register({attestationId:d})}const a=await this.client.core.crypto.encode(s,c),l=or[r].req;return n&&(l.ttl=n),this.client.core.history.set(s,c),this.client.core.relayer.publish(s,a,l),c.id},this.sendResult=async(s,r,i)=>{const n=Ns(s,i),c=await this.client.core.crypto.encode(r,n),a=await this.client.core.history.get(r,s),l=or[a.request.method].res;this.client.core.relayer.publish(r,c,l),await this.client.core.history.resolve(n)},this.sendError=async(s,r,i)=>{const n=$s(s,i),c=await this.client.core.crypto.encode(r,n),a=await this.client.core.history.get(r,s),l=or[a.request.method].res;this.client.core.relayer.publish(r,c,l),await this.client.core.history.resolve(n)},this.cleanup=async()=>{const s=[],r=[];this.client.session.getAll().forEach(i=>{ls(i.expiry)&&s.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{ls(i.expiry)&&r.push(i.id)}),await Promise.all([...s.map(i=>this.deleteSession(i)),...r.map(i=>this.deleteProposal(i))])},this.onRelayEventRequest=s=>{const{topic:r,payload:i}=s,n=i.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeRequest(r,i);case"wc_sessionSettle":return this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return this.onSessionExtendRequest(r,i);case"wc_sessionPing":return this.onSessionPingRequest(r,i);case"wc_sessionDelete":return this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return this.onSessionRequest(r,i);case"wc_sessionEvent":return this.onSessionEventRequest(r,i);default:return this.client.logger.info(`Unsupported request method ${n}`)}},this.onRelayEventResponse=async s=>{const{topic:r,payload:i}=s,n=(await this.client.core.history.get(r,i.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${n}`)}},this.onSessionProposeRequest=async(s,r)=>{const{params:i,id:n}=r;try{this.isValidConnect(Ut({},r.params));const c=Gt(K.FIVE_MINUTES),a=Ut({id:n,pairingTopic:s,expiry:c},i);await this.setProposal(n,a);const l=js(JSON.stringify(r)),d=await this.getVerifyContext(l,a.proposer.metadata);this.client.events.emit("session_proposal",{id:n,params:a,verifyContext:d})}catch(c){await this.sendError(n,s,c),this.client.logger.error(c)}},this.onSessionProposeResponse=async(s,r)=>{const{id:i}=r;if(lt(r)){const{result:n}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});const c=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:c});const a=c.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});const l=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const d=await this.client.core.crypto.generateSharedKey(a,l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const g=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:g}),await this.client.core.pairing.activate({topic:s})}else Ge(r)&&(await this.client.proposal.delete(i,Qe("USER_DISCONNECTED")),this.events.emit(Be("session_connect"),{error:r.error}))},this.onSessionSettleRequest=async(s,r)=>{const{id:i,params:n}=r;try{this.isValidSessionSettleRequest(n);const{relay:c,controller:a,expiry:l,namespaces:d,requiredNamespaces:g,optionalNamespaces:m,sessionProperties:A,pairingTopic:N}=r.params,I=Ut({topic:s,relay:c,expiry:l,namespaces:d,acknowledged:!0,pairingTopic:N,requiredNamespaces:g,optionalNamespaces:m,controller:a.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},A&&{sessionProperties:A});await this.sendResult(r.id,s,!0),this.events.emit(Be("session_connect"),{session:I}),this.cleanupDuplicatePairings(I)}catch(c){await this.sendError(i,s,c),this.client.logger.error(c)}},this.onSessionSettleResponse=async(s,r)=>{const{id:i}=r;lt(r)?(await this.client.session.update(s,{acknowledged:!0}),this.events.emit(Be("session_approve",i),{})):Ge(r)&&(await this.client.session.delete(s,Qe("USER_DISCONNECTED")),this.events.emit(Be("session_approve",i),{error:r.error}))},this.onSessionUpdateRequest=async(s,r)=>{const{params:i,id:n}=r;try{this.isValidUpdate(Ut({topic:s},i)),await this.client.session.update(s,{namespaces:i.namespaces}),await this.sendResult(n,s,!0),this.client.events.emit("session_update",{id:n,topic:s,params:i})}catch(c){await this.sendError(n,s,c),this.client.logger.error(c)}},this.onSessionUpdateResponse=(s,r)=>{const{id:i}=r;lt(r)?this.events.emit(Be("session_update",i),{}):Ge(r)&&this.events.emit(Be("session_update",i),{error:r.error})},this.onSessionExtendRequest=async(s,r)=>{const{id:i}=r;try{this.isValidExtend({topic:s}),await this.setExpiry(s,Gt(zr)),await this.sendResult(i,s,!0),this.client.events.emit("session_extend",{id:i,topic:s})}catch(n){await this.sendError(i,s,n),this.client.logger.error(n)}},this.onSessionExtendResponse=(s,r)=>{const{id:i}=r;lt(r)?this.events.emit(Be("session_extend",i),{}):Ge(r)&&this.events.emit(Be("session_extend",i),{error:r.error})},this.onSessionPingRequest=async(s,r)=>{const{id:i}=r;try{this.isValidPing({topic:s}),await this.sendResult(i,s,!0),this.client.events.emit("session_ping",{id:i,topic:s})}catch(n){await this.sendError(i,s,n),this.client.logger.error(n)}},this.onSessionPingResponse=(s,r)=>{const{id:i}=r;setTimeout(()=>{lt(r)?this.events.emit(Be("session_ping",i),{}):Ge(r)&&this.events.emit(Be("session_ping",i),{error:r.error})},500)},this.onSessionDeleteRequest=async(s,r)=>{const{id:i}=r;try{this.isValidDisconnect({topic:s,reason:r.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(We.publish,async()=>{n(await this.deleteSession(s))})}),this.sendResult(i,s,!0)]),this.client.events.emit("session_delete",{id:i,topic:s})}catch(n){await this.sendError(i,s,n),this.client.logger.error(n)}},this.onSessionRequest=async(s,r)=>{const{id:i,params:n}=r;try{this.isValidRequest(Ut({topic:s},n)),await this.setPendingSessionRequest({id:i,topic:s,params:n});const c=js(JSON.stringify(r)),a=this.client.session.get(s),l=await this.getVerifyContext(c,a.peer.metadata);this.client.events.emit("session_request",{id:i,topic:s,params:n,verifyContext:l})}catch(c){await this.sendError(i,s,c),this.client.logger.error(c)}},this.onSessionRequestResponse=(s,r)=>{const{id:i}=r;lt(r)?this.events.emit(Be("session_request",i),{result:r.result}):Ge(r)&&this.events.emit(Be("session_request",i),{error:r.error})},this.onSessionEventRequest=async(s,r)=>{const{id:i,params:n}=r;try{this.isValidEmit(Ut({topic:s},n)),this.client.events.emit("session_event",{id:i,topic:s,params:n})}catch(c){await this.sendError(i,s,c),this.client.logger.error(c)}},this.isValidConnect=async s=>{if(!St(s)){const{message:l}=J("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(l)}const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:c,relays:a}=s;if(Ot(r)||await this.isValidPairingTopic(r),!Qb(a)){const{message:l}=J("MISSING_OR_INVALID",`connect() relays: ${a}`);throw new Error(l)}!Ot(i)&&ur(i)!==0&&this.validateNamespaces(i,"requiredNamespaces"),!Ot(n)&&ur(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Ot(c)||this.validateSessionProps(c,"sessionProperties")},this.validateNamespaces=(s,r)=>{const i=Jb(s,"connect()",r);if(i)throw new Error(i.message)},this.isValidApprove=async s=>{if(!St(s))throw new Error(J("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:r,namespaces:i,relayProtocol:n,sessionProperties:c}=s;await this.isValidProposalId(r);const a=this.client.proposal.get(r),l=Br(i,"approve()");if(l)throw new Error(l.message);const d=Oa(a.requiredNamespaces,i,"approve()");if(d)throw new Error(d.message);if(!ct(n,!0)){const{message:g}=J("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(g)}Ot(c)||this.validateSessionProps(c,"sessionProperties")},this.isValidReject=async s=>{if(!St(s)){const{message:n}=J("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(n)}const{id:r,reason:i}=s;if(await this.isValidProposalId(r),!Zb(i)){const{message:n}=J("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(n)}},this.isValidSessionSettleRequest=s=>{if(!St(s)){const{message:d}=J("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(d)}const{relay:r,controller:i,namespaces:n,expiry:c}=s;if(!Ph(r)){const{message:d}=J("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const a=Hb(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const l=Br(n,"onSessionSettleRequest()");if(l)throw new Error(l.message);if(ls(c)){const{message:d}=J("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async s=>{if(!St(s)){const{message:l}=J("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(l)}const{topic:r,namespaces:i}=s;await this.isValidSessionTopic(r);const n=this.client.session.get(r),c=Br(i,"update()");if(c)throw new Error(c.message);const a=Oa(n.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)},this.isValidExtend=async s=>{if(!St(s)){const{message:i}=J("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidSessionTopic(r)},this.isValidRequest=async s=>{if(!St(s)){const{message:l}=J("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(l)}const{topic:r,request:i,chainId:n,expiry:c}=s;await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!Ia(a,n)){const{message:l}=J("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(l)}if(!ev(i)){const{message:l}=J("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(l)}if(!rv(a,n,i.method)){const{message:l}=J("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(l)}if(c&&!av(c,Ai)){const{message:l}=J("MISSING_OR_INVALID",`request() expiry: ${c}. Expiry must be a number (in seconds) between ${Ai.min} and ${Ai.max}`);throw new Error(l)}},this.isValidRespond=async s=>{if(!St(s)){const{message:n}=J("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(n)}const{topic:r,response:i}=s;if(await this.isValidSessionTopic(r),!tv(i)){const{message:n}=J("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(n)}},this.isValidPing=async s=>{if(!St(s)){const{message:i}=J("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidSessionOrPairingTopic(r)},this.isValidEmit=async s=>{if(!St(s)){const{message:a}=J("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(a)}const{topic:r,event:i,chainId:n}=s;await this.isValidSessionTopic(r);const{namespaces:c}=this.client.session.get(r);if(!Ia(c,n)){const{message:a}=J("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!sv(i)){const{message:a}=J("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!iv(c,n,i.name)){const{message:a}=J("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}},this.isValidDisconnect=async s=>{if(!St(s)){const{message:i}=J("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidSessionOrPairingTopic(r)},this.getVerifyContext=async(s,r)=>{const i={verified:{verifyUrl:r.verifyUrl||"",validation:"UNKNOWN",origin:r.url||""}};try{const n=await this.client.core.verify.resolve({attestationId:s,verifyUrl:r.verifyUrl});n&&(i.verified.origin=n,i.verified.validation=n===r.url?"VALID":"INVALID")}catch(n){this.client.logger.error(n)}return this.client.logger.info(`Verify context: ${JSON.stringify(i)}`),i},this.validateSessionProps=(s,r)=>{Object.values(s).forEach(i=>{if(!ct(i,!1)){const{message:n}=J("MISSING_OR_INVALID",`${r} must be in Record<string, string> format. Received: ${JSON.stringify(i)}`);throw new Error(n)}})}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(We.message,async e=>{const{topic:s,message:r}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(r)))return;const i=await this.client.core.crypto.decode(s,r);Vs(i)?(this.client.core.history.set(s,i),this.onRelayEventRequest({topic:s,payload:i})):Ps(i)&&(await this.client.core.history.resolve(i),this.onRelayEventResponse({topic:s,payload:i}))})}registerExpirerEvents(){this.client.core.expirer.on(kt.expired,async e=>{const{topic:s,id:r}=Oh(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,J("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(await this.deleteSession(s,!0),this.client.events.emit("session_expire",{topic:s})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}isValidPairingTopic(e){if(!ct(e,!1)){const{message:s}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:s}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(s)}if(ls(this.client.core.pairing.pairings.get(e).expiry)){const{message:s}=J("EXPIRED",`pairing topic: ${e}`);throw new Error(s)}}async isValidSessionTopic(e){if(!ct(e,!1)){const{message:s}=J("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(s)}if(!this.client.session.keys.includes(e)){const{message:s}=J("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(s)}if(ls(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:s}=J("EXPIRED",`session topic: ${e}`);throw new Error(s)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ct(e,!1)){const{message:s}=J("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(s)}else{const{message:s}=J("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(s)}}async isValidProposalId(e){if(!Xb(e)){const{message:s}=J("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(s)}if(!this.client.proposal.keys.includes(e)){const{message:s}=J("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(s)}if(ls(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:s}=J("EXPIRED",`proposal id: ${e}`);throw new Error(s)}}}class F0 extends yi{constructor(e,s){super(e,s,C0,Pn),this.core=e,this.logger=s}}class B0 extends yi{constructor(e,s){super(e,s,M0,Pn),this.core=e,this.logger=s}}class W0 extends yi{constructor(e,s){super(e,s,D0,Pn,r=>r.id),this.core=e,this.logger=s}}class xn extends Hw{constructor(e){super(e),this.protocol=Kh,this.version=Hh,this.name=Ti.name,this.events=new Ye.EventEmitter,this.on=(r,i)=>this.events.on(r,i),this.once=(r,i)=>this.events.once(r,i),this.off=(r,i)=>this.events.off(r,i),this.removeListener=(r,i)=>this.events.removeListener(r,i),this.removeAllListeners=r=>this.events.removeAllListeners(r),this.connect=async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}},this.pair=async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}},this.approve=async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}},this.reject=async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}},this.update=async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}},this.extend=async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}},this.request=async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}},this.respond=async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}},this.ping=async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}},this.emit=async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}},this.disconnect=async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}},this.find=r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}},this.name=(e==null?void 0:e.name)||Ti.name,this.metadata=(e==null?void 0:e.metadata)||yb();const s=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:ee.pino(ee.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ti.logger}));this.core=(e==null?void 0:e.core)||new L0(e),this.logger=ee.generateChildLogger(s,this.name),this.session=new B0(this.core,this.logger),this.proposal=new F0(this.core,this.logger),this.pendingRequest=new W0(this.core,this.logger),this.engine=new H0(this)}static async init(e){const s=new xn(e);return await s.initialize(),s}get context(){return ee.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}function G0(t){return typeof t<"u"&&typeof t.context<"u"}const Yt={init:"signer_init",uri:"signer_uri",created:"signer_created",updated:"signer_updated",deleted:"signer_deleted",event:"signer_event"};class Y0 extends xf{constructor(e){super(),this.events=new Ye.EventEmitter,this.pending=!1,this.initializing=!1,this.requiredNamespaces=(e==null?void 0:e.requiredNamespaces)||{},this.opts=e==null?void 0:e.client}get connected(){return typeof this.session<"u"}get connecting(){return this.pending}get chains(){return this.session?Xw(this.session.namespaces):Zw(this.requiredNamespaces)}get accounts(){return this.session?Qw(this.session.namespaces):[]}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async open(){if(this.pending)return new Promise((e,s)=>{this.events.once("open",()=>{if(this.events.once("open_error",r=>{s(r)}),typeof this.client>"u")return s(new Error("Sign Client not initialized"));e()})});try{this.pending=!0;const e=await this.register(),s=e.find({requiredNamespaces:this.requiredNamespaces});if(s.length)return this.onOpen(s[0]);const{uri:r,approval:i}=await e.connect({requiredNamespaces:this.requiredNamespaces});this.events.emit(Yt.uri,{uri:r}),this.session=await i(),this.events.emit(Yt.created,this.session),this.onOpen()}catch(e){throw this.events.emit("open_error",e),e}}async close(){typeof this.session>"u"||(await(await this.register()).disconnect({topic:this.session.topic,reason:Qe("USER_DISCONNECTED")}),this.onClose())}async send(e,s){if(typeof this.client>"u"&&(this.client=await this.register(),this.connected||await this.open()),typeof this.session>"u")throw new Error("Signer connection is missing session");this.client.request({topic:this.session.topic,request:e,chainId:s==null?void 0:s.chainId}).then(r=>this.events.emit("payload",Ns(e.id,r))).catch(r=>this.events.emit("payload",$s(e.id,r.message)))}async register(e=this.opts){if(typeof this.client<"u")return this.client;if(this.initializing)return new Promise((s,r)=>{this.events.once("register_error",i=>{r(i)}),this.events.once(Yt.init,()=>{if(typeof this.client>"u")return r(new Error("Sign Client not initialized"));s(this.client)})});if(G0(e))return this.client=e,this.registerEventListeners(),this.client;try{return this.initializing=!0,this.client=await xn.init(e),this.initializing=!1,this.registerEventListeners(),this.events.emit(Yt.init),this.client}catch(s){throw this.events.emit("register_error",s),s}}onOpen(e){this.pending=!1,e&&(this.session=e),this.events.emit("open")}onClose(){this.pending=!1,this.client&&(this.client=void 0),this.events.emit("close")}registerEventListeners(){typeof this.client<"u"&&(this.client.on("session_event",e=>{var s;this.session&&((s=this.session)==null?void 0:s.topic)!==e.topic||this.events.emit(Yt.event,e.params)}),this.client.on("session_update",e=>{var s;typeof this.client<"u"&&(this.session&&((s=this.session)==null?void 0:s.topic)!==e.topic||(this.session=this.client.session.get(e.topic),this.events.emit(Yt.updated,this.session)))}),this.client.on("session_delete",e=>{var s;this.session&&(this.session&&((s=this.session)==null?void 0:s.topic)!==e.topic||(this.onClose(),this.events.emit(Yt.deleted,this.session),this.session=void 0))}))}}const Bh=":";function J0(t){const{namespace:e,reference:s}=t;return[e,s].join(Bh)}function Q0(t){const[e,s,r]=t.split(Bh);return{namespace:e,reference:s,address:r}}function X0(t,e){const s=[];return t.forEach(r=>{const i=e(r);s.includes(i)||s.push(i)}),s}function Z0(t){const{namespace:e,reference:s}=Q0(t);return J0({namespace:e,reference:s})}function e1(t){return X0(t,Z0)}function t1(t,e=[]){const s=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const i=t[r];s.push(...i.accounts)}),s}function s1(t,e=[]){const s=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const i=t[r];s.push(...e1(i.accounts))}),s}class r1{constructor(){_e(this,"accounts",[]),_e(this,"eventEmitter",new Ye.EventEmitter),_e(this,"updateSession",e=>{if(!this.isValidSession(e))throw console.warn("updateSession incompatible session",e,"for adapter",this.formatChainId(this.chainId)),new Error("Invalid session");this.session=e;const s=s1(e.namespaces,[this.namespace]);this.setChainIds(s);const r=t1(e.namespaces,[this.namespace]);this.setAccounts(r)}),_e(this,"isValidSession",({namespaces:e,requiredNamespaces:s})=>{var i,n,c;const r=this.formatChainId(this.chainId);return s?!!((n=(i=s[this.namespace])==null?void 0:i.chains)!=null&&n.includes(r)):!!((c=e==null?void 0:e[this.namespace])!=null&&c.accounts.some(a=>a.startsWith(r)))})}getRequiredNamespaces(){const e=[this.formatChainId(this.chainId)];return{[this.namespace]:{chains:e,methods:this.methods,events:this.events}}}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}setChainIds(e){const s=e.filter(r=>this.isCompatibleChainId(r)).map(r=>this.parseChainId(r)).filter(r=>r!==this.chainId);s.length&&(this.chainId=s[0],this.eventEmitter.emit("chainChanged",this.chainId))}setChainId(e){if(this.isCompatibleChainId(e)){const s=this.parseChainId(e);this.chainId=s,this.eventEmitter.emit("chainChanged",this.chainId)}}parseAccountId(e){const[s,r,i]=e.split(":");return{chainId:`${s}:${r}`,address:i}}getSignerConnection(e){return new Y0({requiredNamespaces:{[this.namespace]:{chains:this.rpc.chains,methods:this.rpc.methods,events:this.rpc.events}},client:e})}registerEventListeners(){this.rpcProvider.on("connect",()=>{const{chains:e,accounts:s}=this.signerConnection;e!=null&&e.length&&this.setChainIds(e),s!=null&&s.length&&this.setAccounts(s)}),this.signerConnection.on(Yt.created,this.updateSession),this.signerConnection.on(Yt.updated,this.updateSession),this.signerConnection.on(Yt.event,e=>{if(!this.rpc.chains.includes(e.chainId))return;const{event:s}=e;s.name==="accountsChanged"?(this.accounts=s.data,this.eventEmitter.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(s.data):this.eventEmitter.emit(s.name,s.data)}),this.rpcProvider.on("disconnect",()=>{this.eventEmitter.emit("disconnect")})}}class Wa extends kl{constructor(e,s,r,i){super(e,s,r),this.wallet=i}async execute(e,s=void 0,r={}){return e=Array.isArray(e)?e:[e],await this.wallet.starknet_requestAddInvokeTransaction({accountAddress:this.address,executionRequest:{calls:e,abis:s,invocationDetails:r}})}async declare(e,s){throw new Error("Not supported via Argent Login")}async deployAccount(e,s){throw new Error("Not supported via Argent Login")}}class i1{constructor(e){this.wallet=e}async getPubKey(){throw new Error("Not supported via Argent Login")}async signMessage(e,s){const{signature:r}=await this.wallet.starknet_signTypedData({accountAddress:s,typedData:e});return r}async signTransaction(e,s,r){throw new Error("Not supported via Argent Login")}async signDeployAccountTransaction(e){throw new Error("Not supported via Argent Login")}async signDeclareTransaction(e){throw new Error("Not supported via Argent Login")}}const n1=t=>t.replace(/^SN_/,"SN"),o1=t=>t.replace(/^SN/,"SN_");class a1 extends r1{constructor({client:e,chainId:s,rpcUrl:r,provider:i}){super(),_e(this,"id","argentMobile"),_e(this,"name","Argent Mobile"),_e(this,"version","0.1.0"),_e(this,"icon",""),_e(this,"provider"),_e(this,"signer"),_e(this,"account"),_e(this,"selectedAddress",""),_e(this,"namespace","starknet"),_e(this,"methods",["starknet_signTypedData","starknet_requestAddInvokeTransaction"]),_e(this,"events",["chainChanged","accountsChanged"]),_e(this,"remoteSigner"),_e(this,"signerConnection"),_e(this,"rpcProvider"),_e(this,"chainId"),_e(this,"client"),_e(this,"session"),_e(this,"rpc"),_e(this,"walletRpc"),_e(this,"on",(n,c)=>{this.eventEmitter.on(n,c)}),_e(this,"off",(n,c)=>{this.eventEmitter.off(n,c)}),this.chainId=String(s??qr.NetworkName.SN_MAIN),this.rpc={chains:s?[this.formatChainId(this.chainId)]:[],methods:this.methods,events:this.events},this.signerConnection=this.getSignerConnection(e),this.rpcProvider=new yn(this.signerConnection),this.client=e,this.registerEventListeners(),this.walletRpc=new Proxy({},{get:(n,c)=>a=>this.requestWallet({method:c,params:a})}),this.remoteSigner=new i1(this.walletRpc),this.provider=i||new Ml({nodeUrl:r}),this.account=new Wa(this.provider,"",this.remoteSigner,this.walletRpc)}getNetworkName(e){if(e==="SN_GOERLI")return qr.NetworkName.SN_GOERLI;if(e==="SN_MAIN")return qr.NetworkName.SN_MAIN;throw new Error(`Unknown starknet.js network name for chainId ${e}`)}async request(e){throw new Error("Not implemented: .request()")}async enable(){return await this.rpcProvider.connect(),this.accounts}get isConnected(){return!0}async isPreauthorized(){return!!this.client.session.getAll().find(this.isValidSession)}async requestWallet(e){if(!this.session)throw new Error("No session");try{const{topic:s}=this.session,r=this.formatChainId(this.chainId);Wt.showApprovalModal(e);const i=await this.client.request({topic:s,chainId:r,request:e});return Wt.closeModal("animateSuccess"),i}catch(s){throw Wt.closeModal(),s instanceof Error?new Error(s.message):new Error("Unknow error on requestWallet")}}get isConnecting(){return this.signerConnection.connecting}async disable(){await this.rpcProvider.disconnect()}get isWalletConnect(){return!0}registerEventListeners(){super.registerEventListeners(),this.eventEmitter.on("chainChanged",e=>{throw new Error("Not implemented: chainChanged")})}formatChainId(e){return`${this.namespace}:${n1(e)}`}parseChainId(e){return o1(e.split(":")[1])}setAccounts(e){this.accounts=e.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address);const{address:s}=this.parseAccountId(e[0]),r=s.startsWith("0x")?s:`0x${s}`;this.account=new Wa(this.provider,r,this.remoteSigner,this.walletRpc),this.eventEmitter.emit("accountsChanged",this.accounts),this.selectedAddress=r}}const h1=async t=>Lw(t,a1);export{h1 as getStarknetWindowObject};
